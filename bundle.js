(()=>{"use strict";var __webpack_modules__={306:(e,t,_)=>{_.d(t,{Ar:()=>m,Cd:()=>I,P1:()=>D,So:()=>p,VD:()=>y,Vc:()=>O,dZ:()=>h,kK:()=>v,qr:()=>d,sQ:()=>A,sz:()=>f,v0:()=>E});var o=_(197),n=_(921),a=_(876),i=_(746),r=_(250),s=_(795),l=_(958),c=_(636),u=_(578);function E(e,t,_){if((0,i.DQ)(t)){(0,a.C)(e),(0,a.Ko)(e,0);var o=0,r=setInterval((function(){o+=n.FI,(0,a.Ko)(e,o),o>1&&(clearInterval(r),_&&_())}),t)}else(0,a.C)(e)}function d(e,t,_){if((0,i.DQ)(t)){(0,a.Vx)(e),(0,a.Ko)(e,1);var o=1,r=setInterval((function(){o-=n.FI,(0,a.Ko)(e,o),o<0&&(clearInterval(r),_&&_())}),t)}else(0,a.Vx)(e)}var D=function(){this.background=null,this.globalAnimate=!1,this.twoTime=0,this.fourTime=0,this.boxTime=0,this.moveTime=0,this.speed=0};function p(){var e=function(e){e.status=0};o.Ay.twoAnimateObjs.forEach(e),o.Ay.fourAnimateObjs.forEach(e)}function y(e){p(),o.Ay.animateFrame.speed=e,o.Ay.animateFrame.globalAnimate=!0}function v(e,t,_,n,a){var i={x:t,y:_,status:0,loc:n,image:a};2!==e?4===e&&o.Ay.fourAnimateObjs.push(i):o.Ay.twoAnimateObjs.push(i)}function O(){o.Ay.twoAnimateObjs=[],o.Ay.fourAnimateObjs=[]}var P="animates",M={};function A(e){return M[e]}var g=["hand","sword","yongchang","levelup"];function h(){g.forEach((function(e){!function(e,t){if(e in M)return;console.log("load animate: ",e);var _=new XMLHttpRequest;_.open("GET","".concat(P,"/").concat(e,".animate"),!0),_.overrideMimeType("text/plain; charset=x-user-defined");_.onload=function(_){try{var o=JSON.parse(this.responseText);console.log("on load animate: ",e,o);var n={ratio:o.ratio,images:[],images_rev:[],frame:o.frame_max,frames:[]};o.bitmaps.forEach((function(e){if((0,i.DQ)(e)&&""!==e)try{var t=new Image;t.src=e,n.images.push(t)}catch(e){n.images.push(null)}else n.images.push(null)})),o.frames.forEach((function(e){var t=[];e.forEach((function(e){t.push({index:e[0],x:e[1],y:e[2],zoom:e[3],opacity:e[4],mirror:e[5]||0,angle:e[6]||0})})),n.frames.push(t)})),M[e]=n}catch(e){console.log(e)}(0,i.DQ)(t)&&t()},_.ontimeout=function(e){console.log(e),(0,i.DQ)(t)&&t()},_.onerror=function(e){console.log(e),(0,i.DQ)(t)&&t()},_.send()}(e)}))}function f(e,t,_,u,E,d){var D;void 0===u&&(u=500),console.log("move block animate: ",e,t,_,u,E),(0,r.e0)("animate"),(0,r.qO)("animate");var p=(0,r.gd)(e,t,o.Ay.floorId,!1);(0,i.DQ)(p)||(0,i.DQ)(d)&&d(),console.log("remove block","x:",e," y:",t),(0,s.wC)(e,t),(0,r.qO)("ui"),(0,r.X9)("ui",1);var y=p.block;console.log("block: ",y);var v=l.P[y.event.cls][y.event.id],O=c.zC[y.event.cls],P=1;(0,a.Ko)("animate",P);var M=(0,r.Yc)("animate"),A=[];_.forEach((function(e){if("string"==typeof e)A.push(e);else if((0,i.DQ)(e.value))for(var t=0;t<e.value;t++)A.push(e.direction);else A.push(e.direction)})),console.log("move steps: ",A);var g=32*e,h=32*t,f=0,m={up:{x:0,y:-1},left:{x:-1,y:0},down:{x:0,y:1},right:{x:1,y:0}},I=(null===(D=y.event)||void 0===D?void 0:D.animate)||1,C=0,R=0,T=setInterval((function(){(R+=u/n.uE)>=2*o.Ay.animateFrame.speed/I&&(C++,R=0,C>=I&&(C=0)),0==A.length?(E?P=0:P-=2*n.FI,(0,a.Ko)("animate",P),(0,r.qO)("animate",g,h,32,32),M.drawImage(O,32*C,32*v,32,32,g,h,32,32),P<=0&&(clearInterval(T),(0,r.vZ)("animate"),(0,r.qO)("animate"),(0,a.Ko)("animate",1),(0,i.DQ)(d)&&d())):(f++,g+=2*m[A[0]].x,h+=2*m[A[0]].y,(0,r.qO)("animate",g-32,h-32,96,96),M.drawImage(O,32*C,32*v,32,32,g,h,32,32),16==f&&(f=0,A.shift()))}),u/n.uE)}function m(e,t,_){_=_||o.Ay.floorId;var n=(0,r.gd)(e,t,_,!1);if((0,i.DQ)(n)){var a=n.block;if((0,i.DQ)(a.enable)&&!a.enable){if(a.enable=!0,_==o.Ay.floorId&&(0,i.DQ)(a.event)){var s=a.event,E=l.P[s.cls][s.id],d=c.zC[s.cls];(0,r.Yc)("event").drawImage(d,0,32*E,32,32,32*a.x,32*a.y,32,32),v(s.animate,32*a.x,32*a.y,E,d),p()}u.A.syncPlayerStatus()}}}function I(e,t,_,s){void 0===_&&(_=500),"hide"!=t&&(t="show"),(0,r.e0)("animate"),(0,r.qO)("animate");var u=[];u="number"==typeof e[0]&&"number"==typeof e[1]?[e]:e;var E=[];u.forEach((function(e){var t=(0,r.gd)(e[0],e[1],o.Ay.floorId,!1);if((0,i.DQ)(t)){var _=t.block.event;E.push({x:e[0],y:e[1],blockIcon:l.P[_.cls][_.id],blockImage:c.zC[_.cls]})}})),0==E.length&&(0,i.DQ)(s)&&s();var d=function(){E.forEach((function(e){(0,r.Yc)("animate").drawImage(e.blockImage,0,32*e.blockIcon,32,32,32*e.x,32*e.y,32,32)}))},D=0;"hide"==t&&(D=1),(0,a.Ko)("animate",D),d();var p=setInterval((function(){"show"==t?D+=3*n.FI:D-=50*n.FI,(0,a.Ko)("animate",D),(0,r.qO)("animate"),d(),(D>=1||D<=0)&&(clearInterval(p),(0,r.vZ)("animate"),(0,r.qO)("animate"),(0,a.Ko)("animate",1),(0,i.DQ)(s)&&s())}),_/10)}},600:(e,t,_)=>{_.d(t,{Di:()=>D,Jc:()=>d,iF:()=>y,kJ:()=>u,pD:()=>c,u9:()=>p});var o=_(746),n=_(250),a=_(197),i=_(795),r=_(462),s=_(224),l=_(28),c=function(){this.enabled=!1,this.step=0,this.movedSteps=0,this.destStep=0,this.destX=0,this.destY=0,this.routes=[],this.remainingRoute=[],this.lastDirection="",this.cursorX=0,this.cursorY=0,this.moveDirectly=!1};function u(e,t){var _;(0,o.DQ)(a.Ay.event)&&(0,o.DQ)(null===(_=a.Ay.event)||void 0===_?void 0:_.id)||(0,n.Yc)("ui").clearRect(32*e+5,32*t+5,27,27)}var E=null;function d(e,t,_){if(console.log("setAutoRoute",e,t,_),a.Ay.started&&!a.Ay.locked){if(a.Ay.autoRoute.enabled){console.log("setAutoRoute: already in auto route");var c=a.Ay.autoRoute.destX,u=a.Ay.autoRoute.destY;return D(),void(c==e&&u==t&&(a.Ay.autoRoute.moveDirectly=!0,setTimeout((function(){a.Ay.autoRoute.moveDirectly&&(0,r.UQ)(e,t)&&((0,n.qO)("player"),a.Ay.playerData.loc.x=e,a.Ay.playerData.loc.y=t,(0,n.ut)((0,n.Yf)().direction,(0,n.Yf)().x,(0,n.Yf)().y,"stop"),a.Ay.route.push("move:"+e+":"+t)),a.Ay.autoRoute.moveDirectly=!1}),100)))}if(e!=a.Ay.playerData.loc.x||t!=a.Ay.playerData.loc.y||0!=_.length){var d=0,p=null,y=void 0,v=(0,n.Yc)("ui");if(!(0,o.DQ)(y=function(e,t){var _,i=(0,n.Yf)().x,s=(0,n.Yf)().y,c={up:{x:0,y:-1},left:{x:-1,y:0},down:{x:0,y:1},right:{x:1,y:0}},u=[],E=0,d=[],D=[];if(e!=i||t!=s){for(u.push(13*i+s),u.push(-1),d[13*i+s]="";1!=u.length;){var p=u.shift();if(-1!==p)if(~~(p/169)===E){p%=169;var y=(0,o.RI)(p/13),v=p%13;for(var O in c)if((0,r.de)(y,v,O)){var P=y+c[O].x,M=v+c[O].y;if(!(P<0||P>12||M<0||M>12)){var A=13*P+M;if(!(0,o.DQ)(d[A])){var g=1,h=void 0,f=(0,n.gd)(P,M);if((0,o.DQ)(f)&&("light"==(h=f.block.event.id)&&(g=100),"Net"==h.substring(h.length-3)&&(g=l.Z4.lavaDamage),"Potion"==h.substring(h.length-6)&&(g=20),"changeFloor"==(null===(_=f.block.event)||void 0===_?void 0:_.trigger)&&(g=10)),a.Ay.blockingCtx.damage[A]>0&&(g=a.Ay.blockingCtx.damage[A]),P==e&&M==t){d[A]=O;break}(0,n.dd)(P,M)||(d[A]=O,u.push(169*(E+g)+A))}}}if((0,o.DQ)(d[13*e+t]))break}else u.push(p);else E+=1,u.push(-1)}if((0,o.DQ)(d[13*e+t])){for(var m=e,I=t;m!=i||I!=s;){var C=d[13*m+I];D.push({direction:C,x:m,y:I}),m-=c[C].x,I-=c[C].y}return D.reverse(),D}}}(e,t))){if(e!=a.Ay.playerData.loc.x||t!=a.Ay.playerData.loc.y)return void(0,n.qO)("ui");y=[]}y=y.concat(_),a.Ay.autoRoute.destX=e,a.Ay.autoRoute.destY=t,(0,n.e0)("ui"),(0,n.qO)("ui"),(0,n.xL)("ui","#00ff11"),(0,n.k$)("ui","#00ff11"),(0,n.Hm)("ui",4);for(var O=0;O<y.length;O++)if(null==p?(d++,p=y[O].direction):p==y[O].direction?d++:(a.Ay.autoRoute.routes.push({direction:p,step:d}),d=1,p=y[O].direction),O==y.length-1)a.Ay.autoRoute.routes.push({direction:p,step:d}),(0,n.tN)("ui",32*y[O].x+16,32*y[O].y+16,5,12,6);else{if(v.beginPath(),(0,o.DQ)(y[O+1])&&p!=y[O+1].direction){"up"==p&&"left"==y[O+1].direction||"right"==p&&"down"==y[O+1].direction?(v.moveTo(32*y[O].x+5,32*y[O].y+16),v.lineTo(32*y[O].x+16,32*y[O].y+16),v.lineTo(32*y[O].x+16,32*y[O].y+27)):"up"==p&&"right"==y[O+1].direction||"left"==p&&"down"==y[O+1].direction?(v.moveTo(32*y[O].x+27,32*y[O].y+16),v.lineTo(32*y[O].x+16,32*y[O].y+16),v.lineTo(32*y[O].x+16,32*y[O].y+27)):"left"==p&&"up"==y[O+1].direction||"down"==p&&"right"==y[O+1].direction?(v.moveTo(32*y[O].x+27,32*y[O].y+16),v.lineTo(32*y[O].x+16,32*y[O].y+16),v.lineTo(32*y[O].x+16,32*y[O].y+5)):("right"==p&&"up"==y[O+1].direction||"down"==p&&"left"==y[O+1].direction)&&(v.moveTo(32*y[O].x+5,32*y[O].y+16),v.lineTo(32*y[O].x+16,32*y[O].y+16),v.lineTo(32*y[O].x+16,32*y[O].y+5)),v.stroke();continue}switch(p){case"up":case"down":v.beginPath(),v.moveTo(32*y[O].x+16,32*y[O].y+5),v.lineTo(32*y[O].x+16,32*y[O].y+27),v.stroke();break;case"left":case"right":v.beginPath(),v.moveTo(32*y[O].x+5,32*y[O].y+16),v.lineTo(32*y[O].x+27,32*y[O].y+16),v.stroke()}}v.restore(),(0,n.qg)()}else(0,o.DQ)(E)?(clearTimeout(E),E=null,(0,s.H9)()):E=setTimeout((function(){(0,i.X9)(),clearTimeout(E),E=null}),250)}else console.log("setAutoRoute: locked or not started")}function D(){a.Ay.started&&(a.Ay.autoRoute.enabled=!1,a.Ay.autoRoute.step=0,a.Ay.autoRoute.movedSteps=0,a.Ay.autoRoute.destStep=0,a.Ay.autoRoute.destX=0,a.Ay.autoRoute.destY=0,a.Ay.autoRoute.routes=[],a.Ay.autoRoute.remainingRoute=[],a.Ay.autoRoute.lastDirection="",a.Ay.playerStop=!0,0==a.Ay.autoRoute.remainingRoute.length&&(0,n.qO)("ui"))}function p(){(0,n.qO)("ui"),a.Ay.autoRoute.remainingRoute=[]}function y(){var e=a.Ay.autoRoute.remainingRoute;0===e.length||1===e.length&&1===e[0].step?a.Ay.autoRoute.remainingRoute=[]:(0,n.qg)(e)}},45:(e,t,_)=>{_.d(t,{L:()=>o});var o=function(){function e(e,t,_){void 0===e&&(e={}),void 0===t&&(t={}),void 0===_&&(_={}),this.damage={},this.map={},this.hasBlock={},this.damage=e,this.map=t,this.hasBlock=_}return e.prototype.reset=function(){this.damage={},this.map={},this.hasBlock={}},e}()},250:(e,t,_)=>{_.d(t,{Ce:()=>Oe,EB:()=>Ce,GZ:()=>B,H_:()=>Pe,Hm:()=>x,IC:()=>fe,Jg:()=>q,ME:()=>De,Pe:()=>z,Pg:()=>pe,QX:()=>me,Qx:()=>te,SE:()=>ve,SM:()=>j,T$:()=>_e,T1:()=>re,U4:()=>Ee,UC:()=>ce,UD:()=>m,Uc:()=>H,X9:()=>W,XQ:()=>C,Yc:()=>R,Yf:()=>Z,ap:()=>le,dd:()=>ae,e0:()=>Q,gd:()=>ne,iH:()=>he,k$:()=>k,kQ:()=>Le,kX:()=>Ie,ln:()=>Y,m:()=>G,nH:()=>X,nL:()=>Ae,pZ:()=>U,q9:()=>F,qO:()=>K,qg:()=>se,rw:()=>Me,sD:()=>ge,sV:()=>ue,tN:()=>Ke,tW:()=>Be,ut:()=>$,vZ:()=>N,vf:()=>Re,vz:()=>oe,xL:()=>T,xz:()=>Te});var o=_(28),n=_(306),a=_(876),i=_(197),r=_(958),s=_(636),l=_(600),c=_(746),u=_(571),E=_(921),d=_(795),D=_(137),p=_(462),y=_(578),v=_(883),O=_(916),P=_(505),M=_(224),A=void 0,g=void 0,h=void 0,f=void 0;function m(){clearInterval(f),clearInterval(A),clearInterval(g),clearInterval(h)}var I={};function C(){Array.from((0,a.Fe)("gameCanvas")).forEach((function(e){var t=e.id,_=document.getElementById(t);I[t]=_.getContext("2d")}))}function R(e){return I[e]}function T(e,t){R(e).fillStyle=t}function L(e,t,_,o,n,a){"number"==typeof t&&(t=t.toString()),(0,c.DQ)(n)&&T(e,n),(0,c.DQ)(a)&&F(e,a),console.log("fillText: ",t,_,o,n,a),R(e).fillText(t,_,o)}function B(e,t,_,o,n,a){void 0===t&&(t=0),void 0===_&&(_=0),void 0===o&&(o=416),void 0===n&&(n=416),a&&T(e,a),R(e).fillRect(t,_,o,n)}function K(e,t,_,o,n){void 0===t&&(t=0),void 0===_&&(_=0),void 0===o&&(o=416),void 0===n&&(n=416),R(e).clearRect(t,_,o,n)}function b(e,t,_,o,n,a,i){(0,c.DQ)(a)&&k(e,a),(0,c.DQ)(i)&&x(e,i);var r=R(e);r.beginPath(),r.moveTo(t,_),r.lineTo(o,n),r.closePath(),r.stroke()}function U(){Object.keys(I).forEach((function(e){K(e)}))}function W(e,t){R(e).globalAlpha=t}function k(e,t){R(e).strokeStyle=t}function x(e,t){R(e).lineWidth=t}function w(e,t,_,o,n,a,i){(0,c.DQ)(a)&&k(e,a),(0,c.DQ)(i)&&x(e,i),R(e).strokeRect(t,_,o,n)}function F(e,t){R(e).font=t}function S(e,t,_,o){(0,c.DQ)(o)&&F(e,o);for(var n=[],a=0,i=0;i<t.length;i++){var r=t.charAt(i);if("\n"==r)n.push(t.substring(a,i)),a=i+1;else if("\\"==r&&"n"==t.charAt(i+1))n.push(t.substring(a,i)),a=i+2;else{var s=t.substring(a,i+1);R(e).measureText(s).width>_&&(n.push(t.substring(a,i)),a=i)}}return n.push(t.substring(a)),n}function Q(e){R(e).save()}function N(e){R(e).restore()}function V(e,t){R(e).canvas.style.opacity=t.toString()}function q(e,t){for(var _=0;_<i.Ay.twoAnimateObjs.length;_++)if(i.Ay.twoAnimateObjs[_].x==32*e&&i.Ay.twoAnimateObjs[_].y==32*t)return void i.Ay.twoAnimateObjs.splice(_,1);for(_=0;_<i.Ay.fourAnimateObjs.length;_++)if(i.Ay.fourAnimateObjs[_].x==32*e&&i.Ay.fourAnimateObjs[_].y==32*t)return void i.Ay.fourAnimateObjs.splice(_,1)}function H(){i.Ay.twoAnimateObjs=[],i.Ay.fourAnimateObjs=[]}function j(e){B("ui",32*e.x+12,32*e.y+12,8,8,"#bfbfbf")}function Z(){return i.Ay.playerData.loc}function z(){console.log("set requestAnimationFrame"),function(){for(var e=0,t=["webkit","moz"],_=0;_<t.length&&!window.requestAnimationFrame;++_)window.requestAnimationFrame=window[t[_]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[_]+"CancelAnimationFrame"]||window[t[_]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var _=(new Date).getTime(),o=Math.max(0,16.7-(_-e)),n=window.setTimeout((function(){t(_+o)}),o);return e=_+o,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),i.Ay.animateFrame.speed=o.Z4.animateSpeed;var e=R("event"),t=s.zC.ground;console.log("ground image: ",t),i.Ay.animateFrame.background=R("ui").createPattern(t,"repeat");var _={up:{x:0,y:-1},left:{x:-1,y:0},down:{x:0,y:1},right:{x:1,y:0}},n=function(t){if(i.Ay.animateFrame.twoTime=i.Ay.animateFrame.twoTime||t,i.Ay.animateFrame.fourTime=i.Ay.animateFrame.fourTime||t,i.Ay.animateFrame.boxTime=i.Ay.animateFrame.boxTime||t,i.Ay.animateFrame.moveTime=i.Ay.animateFrame.moveTime||t,i.Ay.animateFrame.globalAnimate&&i.Ay.started&&(t-i.Ay.animateFrame.twoTime>i.Ay.animateFrame.speed&&(0,c.DQ)(i.Ay.twoAnimateObjs)&&(i.Ay.twoAnimateObjs.forEach((function(t){t.status=(t.status+1)%2,K("event",t.x,t.y,32,32),e.drawImage(t.image,32*t.status,32*t.loc,32,32,t.x,t.y,32,32)})),i.Ay.animateFrame.twoTime=t),t-i.Ay.animateFrame.fourTime>i.Ay.animateFrame.speed/2&&(0,c.DQ)(i.Ay.fourAnimateObjs)&&(i.Ay.fourAnimateObjs.forEach((function(t){t.status=(t.status+1)%4,K("event",t.x,t.y,32,32),e.drawImage(t.image,32*t.status,32*t.loc,32,32,t.x,t.y,32,32)})),i.Ay.animateFrame.fourTime=t)),t-i.Ay.animateFrame.boxTime>i.Ay.animateFrame.speed&&(0,c.DQ)(i.Ay.boxAnimateObjs)&&i.Ay.boxAnimateObjs.length>0&&(J(),i.Ay.animateFrame.boxTime=t),t-i.Ay.animateFrame.moveTime>16&&(0,c.DQ)(i.Ay.playerMovingStep)&&i.Ay.playerMovingStep>0){var o=Z().x,a=Z().y,r=Z().direction,s=4*i.Ay.playerMovingStep;i.Ay.playerMovingStep<=4?$(r,o,a,"leftFoot",s*_[r].x,s*_[r].y):i.Ay.playerMovingStep<=8&&$(r,o,a,"rightFoot",s*_[r].x,s*_[r].y),i.Ay.animateFrame.moveTime=t}window.requestAnimationFrame(n)};window.requestAnimationFrame(n)}function $(e,t,_,o,n,a){void 0===n&&(n=0),void 0===a&&(a=0);var c=0==n?0:n/Math.abs(n),u=0==a?0:a/Math.abs(a);(0,l.kJ)(t+c,_+u);var E=r.P.player[e];K("player",(t*=32)-32,(_*=32)-32,96,96);var d=i.Ay.playerHeight,D=s.zC.player;R("player").drawImage(D,32*E[o],E.loc*d,32,d,t+n,_+a+32-d,32,d)}function G(e,t){var _;if((0,c.DQ)(e)){if(console.log("draw text: ",e),(0,c.DQ)(i.Ay.event)&&"action"==i.Ay.event.id)return void(0,d.qB)(e,void 0,void 0,t);var o=[];return o="string"==typeof e?[e]:e,i.Ay.event={id:"text",data:{list:o},callback:t},console.log("lock here1\n"),i.Ay.locked=!0,(0,l.Di)(),void setTimeout((function(){console.log("time out in drawText"),G()}),30)}if(0==(null===(_=i.Ay.event.data)||void 0===_?void 0:_.list.length)){console.log("text arg empty now");var n=i.Ay.event.callback;return X(),void((0,c.DQ)(n)&&(console.log("call callback for drawText"),n()))}console.log("event data list length: ",i.Ay.event.data.list.length),console.log("event id: ",i.Ay.event.id);var a=i.Ay.event.data.list.shift();console.log("draw text: ",a),console.log("event data list length: ",i.Ay.event.data.list.length),_e(a)}function J(){for(var e=0;e<i.Ay.boxAnimateObjs.length;e++){var t=i.Ay.boxAnimateObjs[e];t.status=((t.status||0)+1)%2,K("ui",t.bgx,t.bgy,t.bgheight,t.bgwidth),B("ui",t.bgx,t.bgy,t.bgheight,t.bgwidth,i.Ay.animateFrame.background),R("ui").drawImage(t.image,32*t.status,32*t.icon,32,32,t.x,t.y,32,32)}}function Y(e){(0,l.Di)(),(0,l.u9)(),(0,c.DQ)(e)&&(console.log("lock here2\n"),i.Ay.locked=!0,i.Ay.autoRoute.moveDirectly=!1,setTimeout((function(){var t=Z();$(t.direction,t.x,t.y,"stop"),e()}),30))}function X(){i.Ay.boxAnimateObjs=[],K("ui"),W("ui",1),console.log("unlock here1\n"),i.Ay.locked=!1,i.Ay.event=null}function ee(e,t,_,n){if(!(i.Ay.playerMoving>0)){i.Ay.playerMoving=1;var a={up:{x:0,y:-1},left:{x:-1,y:0},down:{x:0,y:1},right:{x:1,y:0}};A=setInterval((function(){if(i.Ay.playerMoving++,8==i.Ay.playerMoving){i.Ay.playerData.loc.x=t+a[e].x,i.Ay.playerData.loc.y=_+a[e].y,function(){if(i.Ay.playerData.steps++,i.Ay.getFlag("poison")){if(i.Ay.playerData.hp-=(0,c.RI)(o.Z4.poisonDamage),i.Ay.playerData.hp<=0)return i.Ay.playerData.hp=0,y.A.syncPlayerStatus(),void(0,d.JP)("poison");y.A.syncPlayerStatus()}}(),K("player",0,0,416,416);var r=Z();$(e,r.x,r.y,"stop"),clearInterval(A),i.Ay.playerMoving=0,(0,c.DQ)(n)&&n()}}),12.5)}}function te(e,t){console.log("draw tip: ",e);var _=R("data"),o=0;clearInterval(g),F("data",E.GR),Q("data"),V("data",0),_.textAlign="left";var n=16,a=30,i=n+_.measureText(e).width+16;(0,c.DQ)(t)&&(n+=28,a+=4,i+=12);var r=!1,l=null,u=R("data");g=setInterval((function(){if(r?o-=.1:o+=.1,V("data",o),K("data",5,5,400,42),B("data",5,5,i,42,"#000"),(0,c.DQ)(t)&&u.drawImage(s.zC.items,0,32*t,32,32,15,12,32,32),L("data",e,n,a,"#FFF"),o>.6||o<0){if(r)return N("data"),K("data",5,5,400,42),V("data",1),void clearInterval(g);(0,c.DQ)(l)||(l=setTimeout((function(){r=!0,l=null}),750),V("data",o=.6))}}),30)}function _e(e){console.log("draw text box: ",e);var t=null,_=null,n=null,a=null;if((e.startsWith("\t[")||e.startsWith("\\t["))&&(p=e.indexOf("]"))>=0){var l=e.substring(2,p);if(e.startsWith("\\t[")&&(l=e.substring(3,p)),e=e.substring(p+1),1===(x=l.split(",")).length){if("player"!==(t=x[0])){var d=(0,u.DD)(t);(0,c.DQ)(d)?(_=d.name,n=s.zC.enemys,a=r.P.enemys[t]):"leina"!==t&&"jay"!==t?(_=t,t="npc",n=null,a=null):(_=t,n=null,a=null)}}else"leina"!=x[1]&&"jay"!==x[1]?(t="npc",_=x[0],n=s.zC.npcs,a=r.P.npcs[x[1]]):(t=x[1],_=x[0],n=s.zC[t],a=r.P[t][t])}var p,y=i.Ay.textAttribute||o.Z4.textAttribute,O=y.position,P=null,M=null,A=0;if((e.startsWith("\b[")||e.startsWith("\\b["))&&(p=e.indexOf("]"))>=0){var g=e.substring(2,p);e.startsWith("\\b[")&&(g=e.substring(3,p)),e=e.substring(p+1);var h=g.split(",");if(["up","center","down"].includes(h[0])&&(O=h[0],"action"===i.Ay.event.id&&(P=i.Ay.event.data.x,M=i.Ay.event.data.y),h.length>=2))if("player"===h[1]){var f=Z();P=f.x,M=f.y,A=i.Ay.playerHeight-32}else h.length>=3&&(P=parseInt(h[1]),M=parseInt(h[2]))}e=i.Ay.replaceText(e),console.log("content: ",e);var m=R("ui").createPattern(s.zC.ground,"repeat");i.Ay.boxAnimateObjs=[],K("ui");var I=10,C=35;("player"===t||(0,c.DQ)(a))&&(C=73);var U=396-(C-I)-13;if("player"==t||(0,c.DQ)(_)){var x="";if((0,c.DQ)(_)){var F=D.Ay.getFloorById(i.Ay.floorId);x=v.A.t(F.title)+" - "+_}else x=o.Z4.name;i.Ay.addNote(x,e)}var Q=S("ui",e,U,E.Hp);console.log("contents: ",Q);var N=20+21*(Q.length+1)+("player"===t?i.Ay.playerHeight-10:(0,c.DQ)(_)?22:0);console.log("height: ",N),console.log("position: ",O);var V,q=22;"center"===O?V=(416-N)/2:"up"===O?V=null===P||null===M?5:32*M-N-A-q:"down"===O&&(V=null===P||null===M?416-N-5:32*M+32+q),W("ui",y.background[3]),T("ui",(0,c.iq)(y.background)),k("ui","#FFFFFF"),B("ui",I,V,396,N),w("ui",9,V-1,397,N+1,"#FFFFFF",2);var H=R("ui");console.log("ui: ",H),"up"===O&&(0,c.DQ)(P)&&(0,c.DQ)(M)&&(K("ui",32*P+6,V+N-1,20,2),H.beginPath(),H.moveTo(32*P+6-1,V+N-1),H.lineTo(32*P+16,V+N+q-2),H.lineTo(32*P+32-6+1,V+N-1),H.moveTo(32*P+6-1,V+N-1),H.closePath(),H.fill(),b("ui",32*P+6,V+N,32*P+16,V+N+q-2),b("ui",32*P+32-6,V+N,32*P+16,V+N+q-2)),"down"===O&&(0,c.DQ)(P)&&(0,c.DQ)(M)&&(K("ui",32*P+6,V-2,20,3),H.beginPath(),H.moveTo(32*P+6-1,V+1),H.lineTo(32*P+16-1,V-q+2),H.lineTo(32*P+32-6-1,V+1),H.moveTo(32*P+6-1,V+1),H.closePath(),H.fill(),b("ui",32*P+6,V,32*P+16,V-q+2),b("ui",32*P+32-6,V,32*P+16,V-q+2)),H.textAlign="left";var j=V+35;if((0,c.DQ)(t))if(console.log("id: ",t),j=V+57,W("ui",y.title[3]),T("ui",(0,c.iq)(y.title)),k("ui",(0,c.iq)(y.title)),"player"===t){var z=i.Ay.playerHeight;w("ui",24,V+40-1,34,z+2,void 0,2),L("ui",o.Z4.name,C,V+30,void 0,"bold 22px Verdana"),K("ui",25,V+40,32,z),B("ui",25,V+40,32,z,m);var $=r.P.player.down;H.drawImage(s.zC.player,32*$.stop,$.loc*z,32,z,25,V+40,32,z)}else L("ui",_,C,V+30,void 0,E.pg),(0,c.DQ)(a)&&(w("ui",24,V+40-1,34,34,void 0,2),i.Ay.boxAnimateObjs=[],i.Ay.boxAnimateObjs.push({bgx:25,bgy:V+40,bgheight:(0,c.DQ)(_)&&["leina","jay"].includes(_)?64:32,bgwidth:32,image:n,x:25,y:V+40,icon:a}),J());W("ui",y.text[3]),T("ui",(0,c.iq)(y.text));for(var G=0,Y=Q;G<Y.length;G++){L("ui",Y[G],C,j,void 0,E.Hp),j+=21}}function oe(e,t){var _,n,a;void 0===t&&(t=[]),console.log("draw choices: ",e,t),console.log("draw choices event: ",i.Ay.event);var l=R("ui"),d=l.createPattern(s.zC.ground,"repeat");K("ui"),W("ui",1),T("ui",d),i.Ay.event.ui={text:e,choices:t};var D=t.length,p=85,y=246,v=32*(D+2),O=208+v/2;D%2==0&&(O+=16);var P=O-v+56,M=null,A=null,g=null,h=null,f=null,m=100;if((0,c.DQ)(e)){if(0==e.indexOf("\t[")){var I=e.indexOf("]");if(I>=0){var C=e.substring(2,I);e=e.substring(I+1);var b=C.split(",");if(1==b.length){if("player"!=(M=b[0])){var U=(0,u.DD)(M);(0,c.DQ)(U)?(A=U.name,g=s.zC.enemys,h=r.P.enemys[M]):"leina"!=M&&"jay"!==M?(A=M,M="npc",g=null,h=null):(A=M,g=null,h=null)}}else"leina"!=b[1]&&"jay"!==b[1]?(M="npc",A=b[0],g=s.zC.npcs,h=r.P.npcs[b[1]]):(M=b[1],A=b[0],g=s.zC[b[1]],h=r.P[b[1]][b[1]])}}e=i.Ay.replaceText(e),("player"==M||(0,c.DQ)(h))&&(m=145),f=S("ui",e,y-(m-p)-10,E.Cq);var k=0;(0,c.DQ)(A)&&(k+=25),v+=k+=20*f.length}var x=O-v;if(B("ui",p,x,y,v,d),w("ui",84,x-1,247,v+1,"#FFFFFF",2),(0,c.DQ)(f)){var F=x+35;if((0,c.DQ)(M)){l.textAlign="center",F=x+55;var Q=208;if(("player"==M||(0,c.DQ)(h))&&(Q+=22),"player"==M){var N=i.Ay.playerHeight;w("ui",99,x+30-1,34,N+2,"#DDDDDD",2),L("ui",o.Z4.name,Q,x+27,"#FFD700","bold 19px Verdana"),K("ui",100,x+30,32,N),B("ui",100,x+30,32,N,d);var V=r.P.player.down;l.drawImage(s.zC.player,32*V.stop,V.loc*N,32,N,100,x+30,32,N)}else L("ui",A,Q,x+27,"#FFD700","bold 19px Verdana"),(0,c.DQ)(h)&&(w("ui",99,x+30-1,34,34,"#DDDDDD",2),i.Ay.boxAnimateObjs=[],i.Ay.boxAnimateObjs.push({bgx:100,bgy:x+30,bgwidth:32,bgheight:32,image:g,x:100,y:x+30,icon:h}),J())}l.textAlign="left";for(var q=0;q<f.length;q++)L("ui",f[q],m,F,"#FFFFFF",E.Cq),F+=20}l.textAlign="center";for(q=0;q<t.length;q++){var H="";H=(0,c.DQ)(t[q].text)?t[q].text:t[q],L("ui",i.Ay.replaceText(H),208,P+32*q,"#FFFFFF","bold 17px Verdana")}if(t.length>0){(0,c.DQ)(null===(_=i.Ay.event)||void 0===_?void 0:_.selection)||(console.log("set selection to 0 here2\n"),i.Ay.event.selection=0),(null===(n=i.Ay.event)||void 0===n?void 0:n.selection)<0&&(console.log("set selection to 0 here3\n"),i.Ay.event.selection=0),(null===(a=i.Ay.event)||void 0===a?void 0:a.selection)>=t.length&&(console.log("set selection to choices.length - 1 here",t.length-1),i.Ay.event.selection=t.length-1);var j=t[i.Ay.event.selection];H="";H=(0,c.DQ)(j.text)?j.text:j;var Z=l.measureText(i.Ay.replaceText(H)).width;w("ui",208-Z/2-5,P+32*i.Ay.event.selection-20,Z+10,28,"#FFD700",2)}}function ne(e,t,_,o){void 0===o&&(o=!0),(0,c.DQ)(_)||(_=i.Ay.floorId);for(var n=(0,p.Vv)(_).blocks,a=0;a<n.length;a++)if(n[a].x==e&&n[a].y==t&&(0,c.DQ)(n[a].event))return o&&(0,c.DQ)(n[a].enable)&&!n[a].enable?null:{index:a,block:n[a]};return null}function ae(e,t,_){var o=ne(e,t,_);return(0,c.DQ)(o)&&(0,c.DQ)(o.block.event.noPass)&&o.block.event.noPass}function ie(e){var t;if(!((0,c.DQ)(h)||i.Ay.playerMoving>0)){var _={up:{x:0,y:-1},left:{x:-1,y:0},down:{x:0,y:1},right:{x:1,y:0}},o=Z(),n=o.direction,a=o.x,r=o.y,s=function(e,t){return e<0||e>12||t<0||t>12||ae(e,t)}(a+_[n].x,r+_[n].y),u=(0,p.de)();if(console.log("noPass:",s," canMove:",u),s||!u)"ski"!=(null===(t=i.Ay.event)||void 0===t?void 0:t.id)&&i.Ay.route.push(n),i.Ay.autoRoute.remainingRoute=[],u&&(0,d.n9)(a+_[n].x,r+_[n].y),console.log("stop player at ",n," (",a,",",r,")"),$(n,a,r,"stop"),0==i.Ay.autoRoute.remainingRoute.length&&((0,l.u9)(),(0,l.Di)()),(0,c.DQ)(e)&&e();else{ee(n,a,r,(function(){var t,_=Z();i.Ay.autoRoute.enabled?(i.Ay.autoRoute.movedSteps++,i.Ay.autoRoute.lastDirection=_.direction,i.Ay.autoRoute.destStep==i.Ay.autoRoute.movedSteps&&(i.Ay.autoRoute.step==i.Ay.autoRoute.routes.length?((0,l.u9)(),(0,l.Di)()):(i.Ay.autoRoute.movedSteps=0,i.Ay.autoRoute.destStep=i.Ay.autoRoute.routes[i.Ay.autoRoute.step].step,i.Ay.playerData.loc.direction=i.Ay.autoRoute.routes[i.Ay.autoRoute.step].direction,i.Ay.autoRoute.step++))):i.Ay.playerStop&&$(_.direction,_.x,_.y,"stop"),"ski"!=(null===(t=i.Ay.event)||void 0===t?void 0:t.id)&&i.Ay.route.push(n),(0,d.n9)(Z().x,Z().y),(0,d.Px)(),(0,c.DQ)(e)&&e()}))}}}function re(e,t){if(console.log("movePlayer: ",e),!(i.Ay.playerMoving>0))if(i.Ay.playerData.loc.direction=e,(0,c.DQ)(t))ie((function(){t()}));else{i.Ay.playerStop=!1,i.Ay.autoRoute.moveDirectly=!1;var _=function(){i.Ay.playerStop?i.Ay.playerStop=!0:(ie(),setTimeout(_,50))};_()}}function se(e){0!=(e=e||i.Ay.autoRoute.routes).length&&(i.Ay.autoRoute.routes=e,i.Ay.autoRoute.enabled=!0,i.Ay.autoRoute.step=1,i.Ay.autoRoute.destStep=e[0].step,re(e[0].direction))}function le(e,t,_,o){console.log("drawAnimate:",e,t,_);var a=(0,n.sQ)(e);clearInterval(f),K("animate");var i=a.ratio,r=32*t+16,s=32*_+16,l=0,u=function(e){K("animate"),a.frames[e].forEach((function(e){var t=a.images[e.index];if((0,c.DQ)(t)){var _=t.width*i*e.zoom/100,o=t.height*i*e.zoom/100;W("animate",e.opacity/255);var n=r+e.x,l=s+e.y,u=R("animate");e.mirror||e.angle?(Q("animate"),u.translate(n,l),e.angle&&u.rotate(-e.angle*Math.PI/180),e.mirror&&u.scale(-1,1),u.drawImage(t,-_/2,-o/2,_,o),N("animate")):u.drawImage(t,n-_/2,l-o/2,_,o)}}))};u(l++),f=setInterval((function(){if(l==a.frames.length)return clearInterval(f),K("animate"),W("animate",1),void((0,c.DQ)(o)&&o());u(l++)}),50)}function ce(e,t,_,o,n){var a,r,l,u;console.log("drawConfirmBox:",e,t,_),console.log("core status event:",i.Ay.event),console.log("lock here4\n"),i.Ay.locked=!0;var d={id:"confirmBox",ui:e,data:{list:[],yes:t,no:_}};i.Ay.insertOrUpdateEvent(d),console.log("core status event after update:",i.Ay.event),console.log("!isset(coreStatus.event?.selection)",!(0,c.DQ)(null===(a=i.Ay.event)||void 0===a?void 0:a.selection)),console.log("coreStatus.event!.selection",i.Ay.event.selection),(!(0,c.DQ)(null===(r=i.Ay.event)||void 0===r?void 0:r.selection)||i.Ay.event.selection>1)&&(console.log("set selection to 1 here3\n"),i.Ay.event.selection=1),i.Ay.event.selection<0&&(console.log("set selection to 0 here3\n"),i.Ay.event.selection=0);var D=R("ui"),p=D.createPattern(s.zC.ground,"repeat");K("ui"),W("ui",1),T("ui",p),F("ui",E.s2);for(var y=e.split("\n"),O=y.length,P=0,M=0;M<y.length;M++)P=Math.max(P,D.measureText(y[M]).width);var A=Math.min(168-P/2,100),g=140-30*(O-1),h=416-2*A,f=276-g;i.Ay.started&&(B("ui",A,g,h,f,p),w("ui",A-1,g-1,h+1,f+1,"#FFFFFF",2)),D.textAlign="center";for(M=0;M<y.length;M++)L("ui",y[M],208,g+50+30*M,"#FFFFFF");(0,c.DQ)(o)||(o="yes"),o=v.A.t(o),(0,c.DQ)(n)||(n="no"),n=v.A.t(n),L("ui",o,170,g+f-35,"#FFFFFF",E.v7),L("ui",n,246,g+f-35);var m=D.measureText(o).width,I=D.measureText(n).width;0==(null===(l=i.Ay.event)||void 0===l?void 0:l.selection)&&w("ui",170-m/2-5,g+f-35-20,m+10,28,"#FFD700",2),1==(null===(u=i.Ay.event)||void 0===u?void 0:u.selection)&&w("ui",246-I/2-5,g+f-35-20,I+10,28,"#FFD700",2)}function ue(e,t){var _;i.Ay.locked=!0,(0,c.DQ)(null===(_=i.Ay.event)||void 0===_?void 0:_.id)||(i.Ay.event={id:"battle"});var n=i.Ay.playerData.hp,l=i.Ay.playerData.attack,E=i.Ay.playerData.defense,D=(0,u.DD)(e),p=D.hp,y=D.atk,P=D.def,M=D.money,A=D.experience,h=D.special,f=0;if((0,u.MD)(h,11)){var m=(0,c.RI)(n*D.value);D.add&&(p+=m),f+=m}(0,u.MD)(h,10)&&(y=l,P=E),(0,u.MD)(h,2)&&(E=0),(0,u.MD)(h,3)&&P<l&&(P=l-1);var I=0;(0,u.MD)(h,1)&&(I=1);var C=2;(0,u.MD)(h,4)?C=3:(0,u.MD)(h,5)?C=4:(0,u.MD)(h,6)&&(C=1+(D.n||4)),(0,u.MD)(h,7)&&(f+=(0,c.RI)(o.Z4.breakArmor*E));var T=(0,u.R2)(e),U=R("ui"),k=R("data"),x=U.createPattern(s.zC.ground,"repeat");K("ui");var F=10,S=396,Q=60,N=33;W("ui",.85),B("ui",F,N,S,350,"#000000"),W("ui",1),w("ui",9,32,397,351,"#FFFFFF",2),K("data"),clearInterval(g),W("data",1),(0,a.Ko)("data",1),i.Ay.boxAnimateObjs=[];var V=40,q=i.Ay.playerHeight;w("ui",44,67,42,q+V-32+2,"#FFD700",2),w("ui",330,67,42,42),U.textAlign="center",L("ui",o.Z4.name,65,68+q+40,"#FFD700","bold 22px Verdana"),L("ui",v.A.t("monster"),351,140);for(var H=0,j=0;H<T.length;H++)""!=T[H]&&L("ui",T[H],351,144+20*++j,"#FF6A6A","15px Verdana");if((n-=f)<=0)return n=0,void(0,d.JP)("battle");K("ui",45,68,V,q+V-32),B("ui",45,68,V,q+V-32,x);var Z=r.P.player.down;U.drawImage(s.zC.player,32*Z.stop,Z.loc*q,32,q,49,72,32,q),i.Ay.boxAnimateObjs=[],i.Ay.boxAnimateObjs.push({bgx:331,bgy:68,bgwidth:V,bgheight:V,image:s.zC.enemys,x:335,y:72,icon:r.P.enemys[e]}),J();var z=95,$=175,G=321,Y=241;U.textAlign="left";var X=78;L("ui","生命值",z,X,"#DDDDDD","16px Verdana"),b("ui",z,X+8,$,X+8,"#FFFFFF",2),k.textAlign="right",L("data",n.toString(),$,X+26,"#DDDDDD","bold 16px Verdana"),X+=Q,U.textAlign="left",L("ui","攻击",z,X,"#DDDDDD","16px Verdana"),b("ui",z,X+8,$,X+8,"#FFFFFF",2),U.textAlign="right",L("ui",l.toString(),$,X+26,"#DDDDDD","bold 16px Verdana"),X+=Q,U.textAlign="left",L("ui","防御",z,X,"#DDDDDD","16px Verdana"),b("ui",z,X+8,$,X+8,"#FFFFFF",2),U.textAlign="right",L("ui",E.toString(),$,X+26,"#DDDDDD","bold 16px Verdana"),U.textAlign="right",L("ui","生命值",G,X=78,"#DDDDDD","16px Verdana"),b("ui",Y,X+8,G,X+8,"#FFFFFF",2),k.textAlign="left",L("data",p.toString(),Y,X+26,"#DDDDDD","bold 16px Verdana"),X+=Q,U.textAlign="right",L("ui","攻击",G,X,"#DDDDDD","16px Verdana"),b("ui",Y,X+8,G,X+8,"#FFFFFF",2),U.textAlign="left",L("ui",y.toString(),Y,X+26,"#DDDDDD","bold 16px Verdana"),X+=Q,U.textAlign="right",L("ui","防御",G,X,"#DDDDDD","16px Verdana"),b("ui",Y,X+8,G,X+8,"#FFFFFF",2),U.textAlign="left",L("ui",P.toString(),Y,X+26,"#DDDDDD","bold 16px Verdana"),X+=Q,U.textAlign="right",L("ui",v.A.t("money"),G,X,"#DDDDDD","16px Verdana"),b("ui",Y,X+8,G,X+8,"#FFFFFF",2),U.textAlign="left",L("ui",M.toString(),Y,X+26,"#DDDDDD","bold 16px Verdana"),X+=Q,U.textAlign="right",L("ui",v.A.t("exp"),G,X,"#DDDDDD","16px Verdana"),b("ui",Y,X+8,G,X+8,"#FFFFFF",2),U.textAlign="left",L("ui",A.toString(),Y,X+26,"#DDDDDD","bold 16px Verdana"),U.textAlign="left",L("ui","V",183,193,"#FFFFFF","italic bold 40px Verdana"),U.textAlign="right",L("ui","S",233,223,"#FFFFFF","italic bold 40px Verdana");var ee=setInterval((function(){var e;if(O.A.play("attack.ogg"),0==I)b("data",337,102,365,74,"#FF0000",4),setTimeout((function(){K("data",331,68,V,V)}),250),l-P>0&&(p-=(0,c.RI)(l-P)),p<0&&(p=0),K("data",Y,78,80,40),k.textAlign="left",L("data",p.toString(),Y,104,"#DDDDDD","bold 16px Verdana");else{b("data",51,68+q+8-6,79,74,"#FF0000",4),setTimeout((function(){K("data",45,68,V,q+V-32)}),250);var _=y-E;_<0&&(_=0),K("data",z,78,80,40),k.textAlign="right",L("data",n.toString(),$,104,"#DDDDDD","bold 16px Verdana")}if(++I>=C&&(I=0),n<=0||p<=0)return clearInterval(ee),i.Ay.boxAnimateObjs=[],K("ui",0,0,416,416),W("ui",1),K("data",0,0,416,416),"battle"==(null===(e=i.Ay.event)||void 0===e?void 0:e.id)&&(i.Ay.locked=!1,i.Ay.event.id=void 0),void((0,c.DQ)(t)&&t())}),500)}function Ee(){i.Ay.event.id="selectShop";for(var e=P.uP,t=Object.keys(e),_=[],o=0;o<t.length;o++)_.push(e[t[o]].textInFastList);_.push(v.A.t("return")),oe(void 0,_)}function de(e,t){var _=R("ui");F("ui",E.yP),T("ui","#DDDDDD");var o=_.measureText(e+" / "+e).width;_.textAlign="left",L("ui",e+" / "+t,(416-o)/2,403),_.textAlign="center",e>1&&L("ui",v.A.t("last_page"),128,403),e<t&&L("ui",v.A.t("next_page"),288,403),L("ui",v.A.t("return"),370,403)}function De(e){var t=R("ui"),_=(0,u.jX)(i.Ay.event.selection),o=t.createPattern(s.zC.ground,"repeat");if(clearInterval(g),K("data"),(0,a.Ko)("data",1),K("ui"),W("ui",1),T("ui",o),B("ui"),W("ui",.6),T("ui","#000000"),B("ui"),W("ui",1),t.textAlign="left",F("ui",E.yP),0==_.length)return L("ui",v.A.t("no_enemy"),83,222,"#999999","bold 50px Verdana"),t.textAlign="center",void L("ui",v.A.t("return"),370,403,"#DDDDDD",E.yP);e=Math.max(e,0),e=Math.min(e,_.length-1);var n=(0,c.RI)(e/6)+1,l=(0,c.RI)((_.length-1)/6)+1;(0,c.DQ)(i.Ay.event.data)?i.Ay.event.data.index=e:i.Ay.event.data={list:[],index:e};var d=6*(n-1),D=Math.min(6*n,_.length);_=_.slice(d,D),i.Ay.boxAnimateObjs=[];for(var p=0;p<_.length;p++){var y=_[p];w("ui",22,62*p+22,42,42,"#DDDDDD",2),i.Ay.boxAnimateObjs.push({bgx:22,bgy:62*p+22,bgwidth:42,bgheight:42,image:s.zC.enemys,x:27,y:62*p+27,icon:r.P.enemys[y.id]}),t.textAlign="center",""==y.special?L("ui",y.name,115,62*p+47,"#DDDDDD","bold 17px Verdana"):(L("ui",y.name,115,62*p+40,"#DDDDDD","bold 17px Verdana"),L("ui",y.special,115,62*p+62,"#FF6A6A","bold 15px Verdana")),t.textAlign="left",L("ui",v.A.t("hp"),165,62*p+32,"#DDDDDD","13px Verdana"),L("ui",y.hp,195,62*p+32,"#DDDDDD","bold 13px Verdana"),L("ui",v.A.t("attack"),255,62*p+32,"#DDDDDD","13px Verdana"),L("ui",y.attack,285,62*p+32,"#DDDDDD","bold 13px Verdana"),L("ui",v.A.t("defense"),335,62*p+32,"#DDDDDD","13px Verdana"),L("ui",y.defense,365,62*p+32,"#DDDDDD","bold 13px Verdana");L("ui",v.A.t("money"),165,62*p+50,"#DDDDDD","13px Verdana"),L("ui",y.money,195,62*p+50,"#DDDDDD","bold 13px Verdana"),t.textAlign="left",L("ui","经验",255,62*p+50,"#DDDDDD","13px Verdana"),L("ui",y.experience,285,62*p+50,"#DDDDDD","bold 13px Verdana");t.textAlign="center";var O=y.damage,P=O.toString(),M="#FFFF00";O>=i.Ay.playerData.hp&&(M="#FF0000"),O<=0&&(M="#00FF00"),O>=999999999&&(P="无法战斗"),L("ui",P,361,62*p+50,M,"bold 13px Verdana"),t.textAlign="left",e==d+p&&w("ui",10,62*p+13,396,62,"#FFD700")}J(),de(n,l)}function pe(e){var t=(0,u.jX)(i.Ay.event.selection);if(0!=t.length){e=Math.max(e,0);var _=t[e=Math.min(e,t.length-1)],o=_.id,n=(0,u.bC)((0,u.DD)(o));if(0!=n.length){var r=n.join("\n");i.Ay.event.id="book-detail",clearInterval(g),K("data"),(0,a.Ko)("data",1);var s=S("data",r,358,"16px Verdana"),l=406-Math.min(416-24*(s.length+1)-65,250),c=(416-l)/2,E=l,d=R("data");W("data",.9),B("data",10,c,396,E,"#000000"),W("data",1),w("data",9,c-1,397,E+1,"#FFFFFF",2),d.textAlign="left",L("data",_.name,35,c+30,"#FFD700","bold 22px Verdana");for(var D=c+57,p=0;p<s.length;p++){var y=s[p],O=y.indexOf("：");if(O>=0){var P=y.substring(0,O+1);L("data",P,35,D,"#FF6A6A","bold 16px Verdana");var M=d.measureText(P).width;L("data",y.substring(O+1),35+M,D,"#FFFFFF","16px Verdana")}else L("data",s[p],35,D,"#FFFFFF","16px Verdana");D+=24}L("data","<".concat(v.A.t("click_anywhere_to_continue"),">"),270,c+l-13,"#CCCCCC","13px Verdana")}else te(v.A.t("no_special"))}}function ye(e,t,_,o,n,a,l){K(t,o,n,a,a);var u=D.Ay.getFloorById(e),E=(0,c.DQ)(u.defaultGround)?u.defaultGround:"ground",d=r.P.terrains[E],y=s.zC.terrains;E.indexOf("ground")>=0&&(d=0,y=s.zC[E]);for(var v=a/13,O=R(t),P=0;P<13;P++)for(var M=0;M<13;M++)O.drawImage(y,0,32*d,32,32,o+P*v,n+M*v,v,v);for((0,p.Cg)(_),P=0;P<_.length;P++){var A=_[P];if((0,c.DQ)(A.event)&&(!(0,c.DQ)(A.enable)||A.enable)&&"none"!=A.event.id){var g=r.P[A.event.cls][A.event.id],h=s.zC[A.event.cls];O.drawImage(h,0,32*g,32,32,o+A.x*v,n+A.y*v,v,v)}}if((0,c.DQ)(l)){var f=r.P.player[l.direction],m=i.Ay.playerHeight,I=v*m/32;O.drawImage(s.zC.player,32*f.stop,f.loc*m,32,m,o+v*l.x,n+v*l.y+v-I,v,I)}}function ve(e){(0,c.DQ)(e)||(e=i.Ay.floorId),e=Math.max(e,0),e=Math.min(e,D.Ay.getAllFloorIds().length-1),i.Ay.locked=!0,console.log("lock here11\n"),i.Ay.event={id:"viewMaps",data:{list:[],index:e}},clearTimeout(g),K("ui"),W("ui",1),ye(e,"ui",(0,p.Vv)(e).blocks,0,0,416);var t=R("data");K("data"),(0,a.Ko)("data",.2),t.textAlign="left",F("data","16px Arial");var _=v.A.t(D.Ay.getFloorById(e).title);B("data",5,5,16+t.measureText(_).width+16,42,"#000"),(0,a.Ko)("data",.5),L("data",_,21,33,"#fff")}function Oe(e){var t;void 0===e&&(e=!1);var _=null===(t=i.Ay.event)||void 0===t?void 0:t.id;if(console.log("open book",_),"book"==_&&(0,c.DQ)(i.Ay.event.selection))return i.Ay.boxAnimateObjs=[],void ve(i.Ay.event.selection);"viewMaps"==_&&(e=!1,i.Ay.event.selection=i.Ay.event.data.index),i.Ay.checkStatusSatisfiedAndSetEventId("book",e,!0)&&(0,M.H)("book")}function Pe(e,t){t.sort((function(e,t){return t-e})).forEach((function(t){!function(e,t){var _=(0,p.Vv)(t).blocks,o=_[e].x,n=_[e].y,a=D.Ay.getFloorById(t),i=void 0,r=o+","+n;if((0,c.DQ)(a.nonFirstArriveEvents)){var s=a.nonFirstArriveEvents,l=a.switchFloorEvent;r in s?i=s[r]:r in l&&(i=a.switchFloorEvent[r])}(0,c.DQ)(i)?_[e].enable=!1:_.splice(e,1)}(t,e)}))}function Me(e){if(console.log("showBattleAnimateConfirm",e),o.Z4.showBattleAnimateConfirm){i.Ay.event={selection:o.Z4.showBattleAnimate?0:1};var t=function(t){console.log("showBattleAnimate",t),o.Z4.showBattleAnimate=t,(0,c.ZB)("battleAnimate",t),X(),(0,c.DQ)(e)&&e()};ce(v.A.t("show_battle_animate_confirm"),(function(){return t(!0)}),(function(){return t(!1)}))}}function Ae(e){console.log("showSexChoose",e),i.Ay.event={selection:0};var t=function(t){console.log("showSexChoose is man",t),o.Z4.isMan=t,(0,c.ZB)("isMan",t),X(),(0,c.DQ)(e)&&e()};ce(v.A.t("show_sex_confirm"),(function(){return t(!0)}),(function(){return t(!1)}))}function ge(e){var t;console.log("draw fly",e),e=Math.max(e,0),e=Math.min(e,i.Ay.playerData.flyRange.length-1),(0,c.DQ)(null===(t=i.Ay.event)||void 0===t?void 0:t.data)?i.Ay.event.data.page=e:i.Ay.event.data={list:[],page:e};var _=i.Ay.playerData.flyRange[e],o=(0,p.Vv)(_),n=v.A.t(o.title),a=R("ui");K("ui"),W("ui",.85),B("ui",0,0,416,416,"#000000"),W("ui",1),a.textAlign="center",L("ui",v.A.t("transport_floor"),208,60,"#FFFFFF","bold 28px Verdana"),L("ui",v.A.t("return"),208,403,"#FFFFFF","bold 15px Verdana"),L("ui",n,356,247,"#FFFFFF","bold 19px Verdana"),e<i.Ay.playerData.flyRange.length-1&&L("ui","▲",356,183,"#FFFFFF","17px Verdana"),e>0&&L("ui","▼",356,311,"#FFFFFF","17px Verdana"),w("ui",20,100,273,273,"#FFFFFF",2),ye(_,"ui",o.blocks,20,100,273)}function he(e){var t,_=Object.keys(i.Ay.playerData.items.tools).sort(),o=Object.keys(i.Ay.playerData.items.constants).sort();(0,c.DQ)(e)||(e=_.length>0?0:o.length>0?100:0),i.Ay.event.selection=e;var n=void 0;n=e<100?_[e]:o[e-100],i.Ay.hasItem(n)||(n=void 0),(0,c.DQ)(null===(t=i.Ay.event)||void 0===t?void 0:t.data)?i.Ay.event.data.id=n:i.Ay.event.data={list:[],id:n};var a=R("ui");if(K("ui"),W("ui",.85),B("ui",0,0,416,416,"#000000"),W("ui",1),T("ui","#DDDDDD"),k("ui","#DDDDDD"),a.lineWidth=2,a.beginPath(),a.moveTo(0,130),a.lineTo(416,130),a.stroke(),a.beginPath(),a.moveTo(0,129),a.lineTo(0,105),a.lineTo(72,105),a.lineTo(102,129),a.fill(),a.beginPath(),a.moveTo(0,290),a.lineTo(416,290),a.stroke(),a.beginPath(),a.moveTo(0,289),a.lineTo(0,265),a.lineTo(72,265),a.lineTo(102,289),a.fill(),a.textAlign="left",L("ui","消耗道具",5,124,"#333333","bold 16px Verdana"),L("ui","永久道具",5,284),(0,c.DQ)(n)){var l=(0,M.gt)(n);L("ui",l.name,10,32,"#FFD700","bold 20px Verdana"),L("ui",l.text,10,62,"#FFFFFF","17px Verdana"),L("ui","<继续点击该道具即可进行使用>",10,89,"#CCCCCC","14px Verdana")}a.textAlign="right";for(var u=s.zC.items,E=0;E<_.length;E++){var d=_[E],D=r.P.items[d];E<6?(a.drawImage(u,0,32*D,32,32,16*(4*E+1)+5,149,32,32),L("ui",i.Ay.getItemCount(d),16*(4*E+1)+40,182,"#FFFFFF","bold 14px Verdana"),n==d&&w("ui",16*(4*E+1)+1,145,40,40,"#FFD700")):(a.drawImage(u,0,32*D,32,32,16*(4*(E-6)+1)+5,213,32,32),L("ui",i.Ay.getItemCount(d),16*(4*(E-6)+1)+40,246,"#FFFFFF","bold 14px Verdana"),n==d&&w("ui",16*(4*(E-6)+1)+1,209,40,40,"#FFD700"))}for(E=0;E<o.length;E++){var p=o[E];D=r.P.items[p];E<6?(a.drawImage(u,0,32*D,32,32,16*(4*E+1)+5,309,32,32),n==p&&w("ui",16*(4*E+1)+1,305,40,40,"#FFD700")):(a.drawImage(u,0,32*D,32,32,16*(4*(E-6)+1)+5,373,32,32),n==p&&w("ui",16*(4*(E-6)+1)+1,369,40,40,"#FFD700"))}a.textAlign="center",L("ui",v.A.t("remove_item"),370,32,"#DDDDDD","bold 15px Verdana"),L("ui",v.A.t("return"),370,403,"#DDDDDD","bold 15px Verdana")}function fe(){i.Ay.insertOrUpdateEvent({id:"settings"}),oe(void 0,["系统设置","快捷商店","浏览地图","同步存档","重新开始","数据统计","操作帮助","关于本塔","返回游戏"])}function me(){i.Ay.insertOrUpdateEvent({id:"switchs"}),oe(void 0,["背景音效："+(o.Z4.soundEnabled?"[ON]":"[OFF]"),"战斗动画： "+(o.Z4.showBattleAnimate?"[ON]":"[OFF]"),"怪物显伤： "+(o.Z4.displayEnemyDamage?"[ON]":"[OFF]"),"领域显伤： "+(o.Z4.displayExtraDamage?"[ON]":"[OFF]"),"返回主菜单"])}function Ie(){G(["\t[键盘快捷键列表][CTRL] 跳过对话\n[X] 打开/关闭怪物手册\n[G] 打开/关闭楼层传送器\n[A] 读取自动存档（回退）\n[S/D] 打开/关闭存/读档页面\n[K] 打开/关闭快捷商店选择列表\n[T] 打开/关闭工具栏\n[ESC] 打开/关闭系统菜单\n[E] 显示光标\n[H] 打开帮助页面\n\t[鼠标操作]点状态栏中图标： 进行对应的操作\n点任意块： 寻路并移动\n点任意块并拖动： 指定寻路路线\n单击勇士： 转向\n双击勇士： 轻按（仅在轻按开关打开时有效）\n"])}function Ce(){console.log("draw about"),i.Ay.started||(i.Ay.event={id:void 0,data:void 0},(0,a.Vx)("menuBox")),console.log("lock here 15\n"),i.Ay.locked=!0,i.Ay.event.id="about";var e=R("ui");K("ui");var t=36;W("ui",.85),B("ui",48,t,320,344,"#000000"),W("ui",1),w("ui",47,35,321,345,"#FFFFFF",2);e.textAlign="left",L("ui","致可尼：祝你玩得开心！",72,71,"#FFD700","bold 22px Verdana"),L("ui","版本"+o.Z4.version,72,116,"#FFFFFF","bold 17px Verdana"),L("ui","灵感来源于魔塔",72,148,"#FFFFFF","bold 17px Verdana")}function Re(){i.Ay.event={id:"syncSave"},oe(void 0,["本地存档","本地读档",v.A.t("return")])}function Te(){i.Ay.event={id:"localSaveSelect"},oe(void 0,["下载所有存档","只下载最新单存档","返回上级菜单"])}function Le(e){var t;console.log("draw sl panel",e),(0,c.DQ)(e)||(e=1);var _=(0,c.RI)(e/10),o=e%10;_>=30&&(_=29),o>5&&(o=5),e=10*_+o,console.log("draw sl panel event",i.Ay.event),(0,c.DQ)(null===(t=i.Ay.event)||void 0===t?void 0:t.data)?i.Ay.event.data.index=e:i.Ay.event.data={index:e,list:[]};var n=R("ui");K("ui"),W("ui",.85),B("ui",0,0,416,416,"#000000"),W("ui",1),n.textAlign="center";for(var a=416/6,r=117,s="save"==i.Ay.event.id?"存档":"读档",l=0;l<6;l++){var u=5*_+l,E=(0,c.Lg)(0==l?"autoSave":"save"+u);console.log("sl data id",E),l<3?(L("ui",0==l?"自动存档":s+u,(2*l+1)*a,35,"#FFFFFF","bold 17px Verdana"),w("ui",(2*l+1)*a-58.5,50,r,r,l==o?"#FFD700":"#FFFFFF",l==o?6:2),(0,c.DQ)(E)&&(0,c.DQ)(E.floorId)?(ye(E.floorId,"ui",(0,p.LF)(E.maps,E.floorId).blocks,(2*l+1)*a-58.5,50,r,E.playerData.loc),L("ui",(0,c.Yq)(new Date(E.time)),(2*l+1)*a,182,"#FFFFFF","10px Verdana")):(B("ui",(2*l+1)*a-58.5,50,r,r,"#333333"),L("ui",v.A.t("empty"),(2*l+1)*a,117,"#FFFFFF","bold 30px Verdana"))):(L("ui",s+u,(2*l-5)*a,230,"#FFFFFF","bold 17px Verdana"),w("ui",(2*l-5)*a-58.5,245,r,r,l==o?"#FFD700":"#FFFFFF",l==o?6:2),(0,c.DQ)(E)&&(0,c.DQ)(E.floorId)?(ye(E.floorId,"ui",(0,p.LF)(E.maps,E.floorId).blocks,(2*l-5)*a-58.5,245,r,E.playerData.loc),L("ui",(0,c.Yq)(new Date(E.time)),(2*l-5)*a,377,"#FFFFFF","10px Verdana")):(B("ui",(2*l-5)*a-58.5,245,r,r,"#333333"),L("ui",v.A.t("empty"),(2*l-5)*a,315,"#FFFFFF","bold 30px Verdana")))}de(_+1,30)}function Be(){(0,c.DQ)(i.Ay.autoRoute.cursorX)||(i.Ay.autoRoute.cursorX=Z().x),i.Ay.autoRoute.cursorX<0&&(i.Ay.autoRoute.cursorX=0),i.Ay.autoRoute.cursorX>12&&(i.Ay.autoRoute.cursorX=12),(0,c.DQ)(i.Ay.autoRoute.cursorY)||(i.Ay.autoRoute.cursorY=Z().y),i.Ay.autoRoute.cursorY<0&&(i.Ay.autoRoute.cursorY=0),i.Ay.autoRoute.cursorY>12&&(i.Ay.autoRoute.cursorY=12),(0,c.DQ)(i.Ay.event)?i.Ay.event.id="cursor":i.Ay.event={id:"cursor"},i.Ay.locked=!0,K("ui"),W("ui",1);w("ui",32*i.Ay.autoRoute.cursorX+2,32*i.Ay.autoRoute.cursorY+2,28,28,"#FFD700",4)}function Ke(e,t,_,o,n,a){var i=Math.PI/2*3,r=t,s=_,l=Math.PI/o,c=R(e);c.beginPath(),c.moveTo(t,_-n);for(var u=0;u<o;u++)r=t+Math.cos(i)*n,s=_+Math.sin(i)*n,c.lineTo(r,s),i+=l,r=t+Math.cos(i)*a,s=_+Math.sin(i)*a,c.lineTo(r,s),i+=l;c.lineTo(t,_-n),c.closePath(),c.fill()}},28:(e,t,_)=>{_.d(t,{Ht:()=>c,R1:()=>l,UO:()=>s,Z4:()=>i,cW:()=>r,oX:()=>n});var o=_(746);function n(e){return"level:".concat(e.level,",hp:").concat(e.hp,",attack:").concat(e.attack,",defense:").concat(e.defense,",money:").concat(e.money,",exp:").concat(e.exp,",loc:").concat((_=e.loc,"".concat(_.direction,"(").concat(_.x,",").concat(_.y,")")),",items:").concat((t=e.items,"yellowKey:".concat(t.keys.yellowKey,",blueKey:").concat(t.keys.blueKey,",redKey:").concat(t.keys.redKey,",greenKey:").concat(t.keys.greenKey,",tools:").concat(JSON.stringify(t.tools))));var t,_}var a={version:"0.0.1",startText:["欢迎来到终结塔！写给我宝贝的游戏，请多指教！希望你玩的开心！","故事背景:\n\n    铁达尼号王国是一个充满魔法与奇幻的国家。某天国王告知你：铁达尼号王国的公主——艾达突然失踪了，并拜托你营救公主。目击者声称：一个神秘的魔王带走了公主，并进入了有着“终结(End)”之称的塔。\n    此塔是一个诅咒之地，任何试图靠近的人都会被一种神秘的力量阻挡。你与公主有着深厚的情感联系，就算不是国王的请求，你也会毫不犹豫地前往“终结塔”救人。\n    而当你正靠近塔时，一股强大的魔力使你失去了意识...","注意:\n    玩家有血条、攻击、防御、金币（用于购物）、经验值（用于升级），想要打败敌人，玩家的攻击值至少要大于对方的防御值。塔里有各种颜色的门，可以通过不同颜色的钥匙打开。另外塔内还有各种道具可以获取。暂时打不过的敌人或许可以之后再尝试！祝你玩得愉快！"],initFloorID:0,name:"可尼",isMan:!0,player:{level:1,hp:1,attack:1,defense:1,money:1,exp:1,loc:{direction:"up",x:6,y:8},items:{keys:{yellowKey:0,blueKey:0,redKey:0,greenKey:0},constants:{},tools:{}},flyRange:[],steps:0},soundEnabled:!0,animateSpeed:500,textAttribute:{position:"center",title:[255,215,0,1],background:[0,0,0,.85],text:[255,255,255,1],bold:!1},lavaDamage:100,posionDamage:10,weakenDamage:20,weakValue:10,redJewel:3,blueJewel:3,greenJewel:5,redPotion:200,bluePotion:200,yellowPotion:500,greenPotion:800,sword0:0,shield0:0,sword1:10,shield1:10,sword2:20,shield2:20,sword3:70,shield3:85,sword4:80,shield4:80,sword5:150,shield5:190,moneyPocket:300,breakArmor:.9,counterAttack:.1,purify:3,hatred:2,bigKeyIsBox:!0,pickaxeFourDirections:!1,bombFourDirections:!1,equipmentDirectly:!0,poisonDamage:10,displayExtraDamage:!1,displayEnemyDamage:!0,showBattleAnimateConfirm:!0,showBattleAnimate:!1,flyNearStair:!1,enableViewMaps:!0},i=(0,o.o8)(a);function r(){i=(0,o.o8)(a)}var s={level:1,hp:9999,attack:9999,defense:9999,money:0,exp:0,loc:{direction:"up",x:6,y:10},items:{keys:{yellowKey:2,blueKey:1,redKey:0,greenKey:0},constants:{},tools:{}},flyRange:[],steps:0},l={level:1,hp:1e3,attack:10,defense:10,money:0,exp:0,loc:{direction:"up",x:6,y:10},items:{keys:{yellowKey:1,blueKey:1,redKey:0,greenKey:0},constants:{},tools:{}},flyRange:[],steps:0},c={level:1,hp:1e3,attack:9,defense:9,money:0,exp:0,loc:{direction:"up",x:6,y:10},items:{keys:{yellowKey:1,blueKey:0,redKey:0,greenKey:0},constants:{},tools:{}},flyRange:[],steps:0}},921:(e,t,_)=>{_.d(t,{A3:()=>a,AN:()=>n,BY:()=>u,Cq:()=>v,F3:()=>r,FI:()=>d,GR:()=>D,Hp:()=>p,XS:()=>i,gI:()=>c,o$:()=>s,p5:()=>o,pg:()=>y,s2:()=>P,t6:()=>l,u7:()=>E,uE:()=>A,v7:()=>M,yP:()=>O});var o="px",n=422,a=422,i=132,r=n+i,s=32,l=3,c=16,u="3px #fff solid",E="0.5px #fff solid",d=.03,D="16px Arial",p="16px Verdana",y="bold 22px Verdana",v="bold 15px Verdana",O="bold 15px Verdana",P="bold 20px Verdana",M="bold 17px Verdana",A=20},197:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ay:()=>__WEBPACK_DEFAULT_EXPORT__,Jt:()=>GameLevel,sx:()=>parseGameLevel});var _animates__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(306),_config__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(28),_images__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(636),_autoroute__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(600),_util__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(746),_items__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(224),_blocking_context__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(45),_canvas__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(250),_i18n__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(883),_map__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(462),_window__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(654),GameLevel;function parseGameLevel(e){switch(e.toLowerCase()){case GameLevel.Easy:return GameLevel.Easy;case GameLevel.Normal:return GameLevel.Normal;case GameLevel.Hard:return GameLevel.Hard;default:return null}}!function(e){e.Easy="easy",e.Normal="normal",e.Hard="hard"}(GameLevel||(GameLevel={}));var CoreStatus=function(){function CoreStatus(){if(this.started=!1,this.level=GameLevel.Normal,this.locked=!1,this.playerHeight=0,this.playerMoving=0,this.playerStop=!1,this.twoAnimateObjs=[],this.fourAnimateObjs=[],this.boxAnimateObjs=[],this.playerMovingStep=0,this.event=null,this.floorId=0,this.mapData=null,this.route=[],this.textAttribute=null,this.usingCenterFly=!1,this.downTime=null,this.stepPostFix=[],this.holdingKeys=[],this.saveIndex=null,this.notes={},CoreStatus.instance)throw new Error("CoreStatus is a singleton!");CoreStatus.instance=this,this.init()}return CoreStatus.getInstance=function(){return CoreStatus.instance||(CoreStatus.instance=new CoreStatus),CoreStatus.instance},CoreStatus.prototype.reset=function(e,t,_,o,n,a,i){console.log("reset",t,_,o,a),(0,_canvas__WEBPACK_IMPORTED_MODULE_7__.UD)(),_config__WEBPACK_IMPORTED_MODULE_1__.Z4.isMan=e,e?(0,_images__WEBPACK_IMPORTED_MODULE_2__.BT)():(0,_images__WEBPACK_IMPORTED_MODULE_2__.Px)(),coreStatus.started=!0,coreStatus.floorId=o,coreStatus.playerData=(0,_util__WEBPACK_IMPORTED_MODULE_4__.o8)(t),coreStatus.level=_,(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(n)&&(coreStatus.flags=(0,_util__WEBPACK_IMPORTED_MODULE_4__.o8)(n)),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(a)&&(coreStatus.route=(0,_util__WEBPACK_IMPORTED_MODULE_4__.o8)(a)),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(i)&&(coreStatus.notes=(0,_util__WEBPACK_IMPORTED_MODULE_4__.o8)(i)),coreStatus.saveIndex=(0,_util__WEBPACK_IMPORTED_MODULE_4__.Lg)("saveIndex2",1),_window__WEBPACK_IMPORTED_MODULE_10__.A.resize()},CoreStatus.prototype.init=function(){this.started=!1,this.level=GameLevel.Normal,this.locked=!1,this.playerHeight=0,this.playerMoving=0,this.playerStop=!0,this.playerData=(0,_util__WEBPACK_IMPORTED_MODULE_4__.o8)(_config__WEBPACK_IMPORTED_MODULE_1__.Z4.player),this.animateFrame=new _animates__WEBPACK_IMPORTED_MODULE_0__.P1,this.twoAnimateObjs=[],this.fourAnimateObjs=[],this.boxAnimateObjs=[],this.playerMovingStep=0,this.event=null,this.floorId=0,this.mapData=null,this.route=[],this.autoRoute=new _autoroute__WEBPACK_IMPORTED_MODULE_3__.pD,this.textAttribute=null,this.usingCenterFly=!1,this.downTime=null,this.stepPostFix=[],this.holdingKeys=[],this.blockingCtx=new _blocking_context__WEBPACK_IMPORTED_MODULE_6__.L,this.shopVisited={},this.saveIndex=null,this.notes={},this.flags={}},CoreStatus.prototype.getPlayerProperty=function(e){return coreStatus.playerData[e]},CoreStatus.prototype.hasItem=function(e){return this.getItemCount(e)>0},CoreStatus.prototype.getItemCount=function(e){if(console.log("getItemCount",e),!(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(e)||!(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)((0,_items__WEBPACK_IMPORTED_MODULE_5__.gt)(e)))return 0;var t=(0,_items__WEBPACK_IMPORTED_MODULE_5__.gt)(e).cls;if(console.log("itemCls",t),"items"===t)return 0;var _=coreStatus.playerData.items;if(!(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(_[t]))return 0;var o=_[t];if("yellowKey"===e)return o.yellowKey;if("blueKey"===e)return o.blueKey;if("redKey"===e)return o.redKey;if("greenKey"==e)return o.greenKey;var n=o;return console.log("playeItemForClzNotKeys",n),e in n?n[e]:0},CoreStatus.prototype.getFlag=function(e,t){return void 0===t&&(t=void 0),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(this.flags[e])?this.flags[e]:t},CoreStatus.prototype.hasFlag=function(e){return e in this.flags&&this.flags[e]>0},CoreStatus.prototype.setFlag=function(e,t){this.flags[e]=t},CoreStatus.prototype.shopVisitedBefore=function(e){return e in this.shopVisited&&this.shopVisited[e]},CoreStatus.prototype.setShopVisited=function(e){this.shopVisited[e]=!0},CoreStatus.prototype.evalValue=function(value){return value=value.replace(/status:([\w\d_]+)/g,"this.getPlayerProperty('$1')"),value=value.replace(/item:([\w\d_]+)/g,"this.getItemCount('$1')"),value=value.replace(/flag:([\w\d_]+)/g,"this.getFlag('$1', false)"),eval(value)},CoreStatus.prototype.replaceText=function(e){var t=this;return console.log("replaceText",e),(e=e.replace(/{player\}/g,_config__WEBPACK_IMPORTED_MODULE_1__.Z4.name)).replace(/\${([^}]+)}/g,(function(e,_){return t.evalValue(_)}))},CoreStatus.prototype.nextX=function(){return(0,_canvas__WEBPACK_IMPORTED_MODULE_7__.Yf)().x+{up:{x:0,y:-1},left:{x:-1,y:0},down:{x:0,y:1},right:{x:1,y:0}}[(0,_canvas__WEBPACK_IMPORTED_MODULE_7__.Yf)().direction].x},CoreStatus.prototype.nextY=function(){return(0,_canvas__WEBPACK_IMPORTED_MODULE_7__.Yf)().y+{up:{x:0,y:-1},left:{x:-1,y:0},down:{x:0,y:1},right:{x:1,y:0}}[(0,_canvas__WEBPACK_IMPORTED_MODULE_7__.Yf)().direction].y},CoreStatus.prototype.checkStatusSatisfiedAndSetEventId=function(e,t,_){var o;if(console.log("checkStatusSatisfiedAndSetEventId",e,t,_),console.log("checkStatusSatisfiedAndSetEventId event",coreStatus.event),t&&(null===(o=this.event)||void 0===o?void 0:o.id)==e)return(0,_canvas__WEBPACK_IMPORTED_MODULE_7__.nH)(),!1;if(t&&this.locked)return!1;if((0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(_)&&_&&!this.hasItem(e))return(0,_canvas__WEBPACK_IMPORTED_MODULE_7__.Qx)("".concat(_i18n__WEBPACK_IMPORTED_MODULE_8__.A.t("have_no")).concat((0,_items__WEBPACK_IMPORTED_MODULE_5__.gt)(e).name)),!1;if(!this.playerStop)return(0,_canvas__WEBPACK_IMPORTED_MODULE_7__.Qx)(_i18n__WEBPACK_IMPORTED_MODULE_8__.A.t("stop_move")),!1;coreStatus.locked=!0,console.log("lock here12\n");var n={id:e};return this.insertOrUpdateEvent(n),!0},CoreStatus.prototype.insertOrUpdateEvent=function(e){if(console.log("insertOrUpdateEvent",e),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(this.event))for(var t in e)e.hasOwnProperty(t)&&(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(e[t])&&(console.log("update event",t,e[t]),this.event[t]=e[t]);else this.event=e},CoreStatus.prototype.isNearStair=function(){var e=(0,_canvas__WEBPACK_IMPORTED_MODULE_7__.Yf)().x,t=(0,_canvas__WEBPACK_IMPORTED_MODULE_7__.Yf)().y;return(0,_map__WEBPACK_IMPORTED_MODULE_9__.Kb)(e,t)||(0,_map__WEBPACK_IMPORTED_MODULE_9__.Kb)(e-1,t)||(0,_map__WEBPACK_IMPORTED_MODULE_9__.Kb)(e,t-1)||(0,_map__WEBPACK_IMPORTED_MODULE_9__.Kb)(e+1,t)||(0,_map__WEBPACK_IMPORTED_MODULE_9__.Kb)(e,t+1)},CoreStatus.prototype.setStatus=function(e,t){console.log("setStatus",e,t),this.playerData[e]=t},CoreStatus.prototype.addNote=function(e,t){console.log("addNote",e,t),e in this.notes?this.notes[e].push(t):this.notes[e]=[t]},CoreStatus}(),coreStatus=CoreStatus.getInstance();const __WEBPACK_DEFAULT_EXPORT__=coreStatus},876:(e,t,_)=>{function o(e){return document.getElementById(e)}function n(e){return document.getElementsByClassName(e)}function a(e){o(e).style.display="block"}function i(e){o(e).style.display="none"}function r(e,t){o(e).style.opacity=t.toString()}function s(e){r(e,1)}function l(e,t){o(e).style.background=t}function c(e,t){o(e).innerHTML=t}_.d(t,{AL:()=>c,C:()=>a,Fe:()=>n,J6:()=>o,Ko:()=>r,Vx:()=>i,WF:()=>l,lW:()=>s})},571:(e,t,_)=>{_.d(t,{DD:()=>l,MD:()=>u,R2:()=>E,Ug:()=>c,bC:()=>D,jX:()=>d,mn:()=>s});var o=_(746),n=_(28),a=_(197),i=_(462),r={};function s(){r={greenSlime:{name:"绿头怪",hp:50,atk:20,def:1,money:1,experience:1,special:0},redSlime:{name:"红头怪",hp:70,atk:15,def:2,money:2,experience:2,special:0},blackSlime:{name:"青头怪",hp:200,atk:35,def:10,money:5,experience:5,special:0},slimelord:{name:"怪王",hp:700,atk:250,def:125,money:32,experience:30,special:0},bat:{name:"小蝙蝠",hp:100,atk:20,def:5,money:3,experience:3,special:0},bigBat:{name:"大蝙蝠",hp:150,atk:65,def:30,money:10,experience:8,special:0},redBat:{name:"红蝙蝠",hp:550,atk:160,def:90,money:25,experience:20,special:0},vampire:{name:"冥灵魔王",hp:3e4,atk:1700,def:1500,money:250,experience:220,special:0},vampire2:{name:"冥灵魔王",hp:45e3,atk:2550,def:2250,money:312,experience:275,special:0},vampire3:{name:"冥灵魔王",hp:6e4,atk:3400,def:3e3,money:390,experience:343,special:0},skeleton:{name:"骷髅人",hp:110,atk:25,def:5,money:5,experience:4,special:0},skeletonSoilder:{name:"骷髅士兵",hp:150,atk:40,def:20,money:8,experience:6,special:0},skeletonCaptain:{name:"骷髅队长",hp:400,atk:90,def:50,money:15,experience:12,special:0},ghostSkeleton:{name:"冥队长",hp:2500,atk:900,def:850,money:84,experience:75,special:0},zombie:{name:"兽人",hp:300,atk:75,def:45,money:13,experience:10,special:0},zombieKnight:{name:"兽人武士",hp:900,atk:450,def:330,money:50,experience:50,special:0},rock:{name:"石头人",hp:500,atk:115,def:65,money:15,experience:15,special:0},slimeMan:{name:"影子战士",hp:3100,atk:1150,def:1050,money:92,experience:80,special:0},bluePriest:{name:"初级法师",hp:125,atk:50,def:25,money:10,experience:7,special:0},redPriest:{name:"高级法师",hp:100,atk:200,def:110,money:30,experience:25,special:0},brownWizard:{name:"麻衣法师",hp:250,atk:120,def:70,money:20,experience:17,special:22,damage:100},redWizard:{name:"红衣法师",hp:500,atk:400,def:260,money:47,experience:45,special:22,damage:300},yellowGuard:{name:"初级卫兵",hp:450,atk:150,def:90,money:22,experience:19,special:0},blueGuard:{name:"中级卫兵",hp:1250,atk:500,def:400,money:55,experience:55,special:0},redGuard:{name:"高级卫兵",hp:1500,atk:560,def:460,money:60,experience:60,special:0},swordsman:{name:"双手剑士",hp:1200,atk:620,def:520,money:65,experience:75,special:0},soldier:{name:"冥战士",hp:2e3,atk:680,def:590,money:70,experience:65,special:0},yellowKnight:{name:"金骑士",hp:850,atk:350,def:200,money:45,experience:40,special:0},redKnight:{name:"金队长",hp:900,atk:750,def:650,money:77,experience:70,special:0},darkKnight:{name:"灵武士",hp:1200,atk:980,def:900,money:88,experience:75,special:0},blackKing:{name:"黑衣魔王",hp:1e3,atk:500,def:0,money:1e3,experience:1e3,special:0,bomb:!1},yellowKing:{name:"黄衣魔王",hp:0,atk:0,def:0,money:0,experience:0,special:0},greenKing:{name:"青衣武士",hp:0,atk:0,def:0,money:0,experience:0,special:0},blueKnight:{name:"蓝骑士",hp:100,atk:120,def:0,money:9,experience:0,special:8},goldSlime:{name:"黄头怪",hp:0,atk:0,def:0,money:0,experience:0,special:0},poisonSkeleton:{name:"紫骷髅",hp:0,atk:0,def:0,money:0,experience:0,special:0},poisonBat:{name:"紫蝙蝠",hp:100,atk:120,def:0,money:14,experience:0,special:13},steelRock:{name:"铁面人",hp:0,atk:0,def:0,money:0,experience:0,special:0},skeletonPriest:{name:"骷髅法师",hp:100,atk:100,def:0,money:0,experience:0,special:18,value:20},skeletonKing:{name:"骷髅王",hp:0,atk:0,def:0,money:0,experience:0,special:0},skeletonWizard:{name:"骷髅巫师",hp:0,atk:0,def:0,money:0,experience:0,special:0},redSkeletonCaption:{name:"骷髅武士",hp:0,atk:0,def:0,money:0,experience:0,special:0},badHero:{name:"迷失勇者",hp:0,atk:0,def:0,money:0,experience:0,special:0},demon:{name:"魔神武士",hp:0,atk:0,def:0,money:0,experience:0,special:0},demonPriest:{name:"魔神法师",hp:0,atk:0,def:0,money:0,experience:0,special:0},goldHornSlime:{name:"金角怪",hp:0,atk:0,def:0,money:0,experience:0,special:0},redKing:{name:"红衣魔王",hp:15e3,atk:1e3,def:1e3,money:100,experience:100,special:0},redKing2:{name:"红衣魔王",hp:2e4,atk:1333,def:1333,money:133,experience:133,special:0},whiteKing:{name:"白衣武士",hp:1300,atk:300,def:150,money:40,experience:35,special:11,value:1/4},blackMagician:{name:"灵法师",hp:1500,atk:830,def:730,money:80,experience:70,special:11,value:1/3},silverSlime:{name:"银头怪",hp:100,atk:120,def:0,money:15,experience:0,special:14},swordEmperor:{name:"剑圣",hp:0,atk:0,def:0,money:0,experience:0,special:0},whiteHornSlime:{name:"尖角怪",hp:0,atk:0,def:0,money:0,experience:0,special:0},badPrincess:{name:"痛苦魔女",hp:0,atk:0,def:0,money:0,experience:0,special:0},badFairy:{name:"黑暗小精灵",hp:0,atk:0,def:0,money:0,experience:0,special:0},grayPriest:{name:"中级法师",hp:0,atk:0,def:0,money:0,experience:0,special:0},redSwordsman:{name:"剑王",hp:100,atk:120,def:0,money:7,experience:0,special:6,n:8},whiteGhost:{name:"水银战士",hp:0,atk:0,def:0,money:0,experience:0,special:0},poisonZombie:{name:"绿兽人",hp:100,atk:120,def:0,money:13,experience:0,special:12},magicDragon:{name:"END",hp:5e4,atk:4e3,def:3500,money:0,experience:0,special:0},octopus:{name:"血影",hp:99999,atk:5e3,def:4e3,money:0,experience:0,special:0},darkFairy:{name:"小精灵",hp:0,atk:0,def:0,money:0,experience:0,special:0},greenKnight:{name:"强盾骑士",hp:0,atk:0,def:0,money:0,experience:0,special:0}}}function l(e){return r[e]}function c(e){var t=r[e],_=a.Ay.playerData,i=function(e,t,_,i){console.log("cal damage",e,t,_,i);var r=e.hp,s=e.atk,l=e.def,c=e.special;if(u(c,20)&&!a.Ay.hasItem("cross"))return 999999999;var E=0;if(u(c,11)){var d=(0,o.RI)(t*e.value);e.add&&(r+=d),E+=d}if(u(c,10)&&(s=_,l=i),u(c,2)&&(i=0),u(c,3)&&l<_-1&&(l=_-1),_<=l)return 999999999;var D=s-i;D<0&&(D=0),u(c,4)&&(D*=2),u(c,5)&&(D*=3),u(c,6)&&(D*=e.n||4);var p=0;u(c,8)&&(p+=n.Z4.counterAttack*_),u(c,1)&&(E+=D),u(c,7)&&(E+=n.Z4.breakArmor*i);var y=(0,o.RI)((r-1)/(_-l));return Math.max(0,E+y*D+(y+1)*p)}(t,_.hp,_.attack,_.defense);return i+function(e){var t=0;return u(e.special,17)&&(t+=a.Ay.getFlag("hatred",0)),u(e.special,22)&&(t+=e.damage||0),t}(t)}function u(e,t){return e instanceof Array?e.indexOf(t)>=0:"number"==typeof e&&(0!=e&&(e%100==t||u(e/100,t)))}function E(e){if(!(0,o.DQ)(e))return[];var t=r[e],_=t.special,n=[];return u(_,1)&&n.push("先攻"),u(_,2)&&n.push("魔攻"),u(_,3)&&n.push("坚固"),u(_,4)&&n.push("2连击"),u(_,5)&&n.push("3连击"),u(_,6)&&n.push((t.n||4)+"连击"),u(_,7)&&n.push("破甲"),u(_,8)&&n.push("反击"),u(_,9)&&n.push("净化"),u(_,10)&&n.push("模仿"),u(_,11)&&n.push("吸血"),u(_,12)&&n.push("中毒"),u(_,13)&&n.push("衰弱"),u(_,14)&&n.push("诅咒"),u(_,15)&&n.push("领域"),u(_,16)&&n.push("夹击"),u(_,17)&&n.push("仇恨"),u(_,18)&&n.push("阻击"),u(_,19)&&n.push("自爆"),u(_,20)&&n.push("无敌"),u(_,21)&&n.push("退化"),u(_,22)&&n.push("固伤"),n}function d(e){var t;e=e||a.Ay.floorId;for(var _=[],n={},r=(0,i.Vv)(e).blocks,s=0;s<r.length;s++){var d=r[s];if((0,o.DQ)(d.event)&&(!(0,o.DQ)(d.enable)||d.enable)&&"enemys"==(null===(t=d.event)||void 0===t?void 0:t.cls)){var D=d.event.id;if(D in n)continue;var p=l(D),y=p.hp,v=p.atk,O=p.def;u(p.special,3)&&O<a.Ay.playerData.attack-1&&(O=a.Ay.playerData.attack-1),u(p.special,10)&&(v=a.Ay.playerData.attack,O=a.Ay.playerData.defense);var P=E(D),M="";M=P.length>=3?"多属性...":P.join("  "),_.push({id:D,name:p.name,hp:y,attack:v,defense:O,money:p.money,experience:p.experience,point:p.point||0,special:M,damage:c(D)}),n[D]=!0}}return _.sort((function(e,t){return e.damage==t.damage?e.money-t.money:e.damage-t.damage})),_}function D(e,t){if(!(0,o.DQ)(t)){for(var _=[],a=1;a<100;a++)if(u(e.special,a)){var i=D(e,a);""!=i&&_.push(i)}return _}switch(t){case 1:return"先攻：怪物首先攻击";case 2:return"魔攻：怪物无视勇士的防御";case 3:return"坚固：勇士每回合最多只能对怪物造成1点伤害";case 4:return"2连击：怪物每回合攻击2次";case 5:return"3连击：怪物每回合攻击3次";case 6:return(e.n||4)+"连击： 怪物每回合攻击"+(e.n||4)+"次";case 7:return"破甲：战斗前，怪物附加角色防御的"+(0,o.RI)(100*n.Z4.breakArmor)+"%作为伤害";case 8:return"反击：战斗时，怪物每回合附加角色攻击的"+(0,o.RI)(100*n.Z4.counterAttack)+"%作为伤害，无视角色防御";case 9:return"净化：战斗前，怪物附加勇士魔防的"+n.Z4.purify+"倍作为伤害";case 10:return"模仿：怪物的攻防和勇士攻防相等";case 11:return"吸血：战斗前，怪物首先吸取角色的"+(0,o.RI)(100*e.value)+"%生命作为伤害"+(e.add?"，并把伤害数值加到自身生命上":"");case 12:return"中毒：战斗后，勇士陷入中毒状态，每一步损失生命"+n.Z4.poisonDamage+"点";case 13:return"衰弱：战斗后，勇士陷入衰弱状态，攻防暂时下降"+n.Z4.weakValue+"点";case 14:return"诅咒：战斗后，勇士陷入诅咒状态，战斗无法获得金币和经验";case 15:return"领域：经过怪物周围"+(e.range||1)+"格时自动减生命"+(e.value||0)+"点";case 16:return"夹击：经过两只相同的怪物中间，勇士生命值变成一半";case 18:return"阻击：经过怪物的十字领域时自动减生命"+(e.value||0)+"点，同时怪物后退一格";case 19:return"自爆：战斗后勇士的生命值变成1";case 20:return"无敌：勇士无法打败怪物，除非拥有十字架";case 21:return"退化：战斗后勇士永久下降"+(e.atkValue||0)+"点攻击和"+(e.defValue||0)+"点防御";case 22:return"固伤：战斗前，怪物对勇士造成"+(e.damage||0)+"点固定伤害，无视勇士魔防。"}return""}},795:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{BV:()=>canUseQuickShop,Eo:()=>doAction,GG:()=>restartHandler,H8:()=>updateFg,JP:()=>handleGameover,Px:()=>checkAndHandleBlockEvent,SP:()=>initEvents,T:()=>loadImageOnClickHandler,X4:()=>doSL,X9:()=>turnPlayerHandler,YL:()=>openQuickShopHandler,Yx:()=>saveImageOnClickHandler,_c:()=>openToolboxHandler,co:()=>saveGameHandler,n9:()=>triggerPointEvent,pi:()=>readFileHandler,qB:()=>doOrInsertAction,qY:()=>transporterOnClickHandler,sZ:()=>getItemHandler,tW:()=>handlePostSwitchFloor,wC:()=>removeBlock,x3:()=>handleClickStartGameButtonEvent,xq:()=>hanleStartGameEvent,yj:()=>tryUseToolBarTransporter,zO:()=>openShopHandler,zz:()=>loadGameHandler});var _config__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(28),_core__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(197),_dom__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(876),_menu__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(417),_floor__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(530),_util__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(746),_canvas__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(250),_i18n__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(883),_floors__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(137),_autoroute__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(600),_items__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(224),_enemys__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(571),_sound__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(916),_status_bar__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(578),_icons__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(958),_images__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(636),_animates__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(306),_map__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(462),_shops__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(505),_constants__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(921),Event=function(e,t,_,o,n,a,i){this.id=e,this.data=t,this.callback=_,this.selection=o,this.ui=n,this.yes=a,this.no=i},events;function initEvents(){events={battle:function(e,t){var _,o=null===(_=e.event)||void 0===_?void 0:_.id;console.log("trigger battle event:",e,o),battleHandler(o,e.x,e.y),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(t)&&t()},getItem:function(e,t){var _;console.log("trigger get item:",e);var o=null===(_=e.event)||void 0===_?void 0:_.id;console.log("item event id: ",o),getItemHandler(o,1,e.x,e.y),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(t)&&t()},openDoor:function(e,t){var _;console.log("trigger openDoor event:",e),openDoorHandler(null===(_=e.event)||void 0===_?void 0:_.id,e.x,e.y,!0),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(t)&&t()},switchFloor:function(e,t){var _,o,n;console.log("trigger switch event:",e),console.log("switch floor event data:",e.event.data);var a=(null===(_=e.event)||void 0===_?void 0:_.data)instanceof Array?null===(o=e.event)||void 0===o?void 0:o.data[0]:null===(n=e.event)||void 0===n?void 0:n.data,i=(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Yf)();(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(null==a?void 0:a.loc)&&(i.x=a.loc[0],i.y=a.loc[1]),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(null==a?void 0:a.direction)&&(i.direction=a.direction),_floor__WEBPACK_IMPORTED_MODULE_3__.Ay.switchFloor(a.floorId,(0,_floor__WEBPACK_IMPORTED_MODULE_3__.$x)(null==a?void 0:a.stairDirection),i,a.interval,(function(){(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(t)&&t()}))},passNet:function(e,t){(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(t)&&t()},changeLight:function(e,t){(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(t)&&t()},ski:function(e,t){(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(t)&&t()},pushBox:function(e,t){(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(t)&&t()},action:function(e,t){doEvents(e.event.data,e.x,e.y),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(t)&&t()}}}function selectPlayerData(e){switch(e){case _core__WEBPACK_IMPORTED_MODULE_1__.Jt.Easy:return _config__WEBPACK_IMPORTED_MODULE_0__.UO;case _core__WEBPACK_IMPORTED_MODULE_1__.Jt.Normal:return _config__WEBPACK_IMPORTED_MODULE_0__.R1;case _core__WEBPACK_IMPORTED_MODULE_1__.Jt.Hard:return _config__WEBPACK_IMPORTED_MODULE_0__.Ht;default:return console.error("Invalid level: ",e),_config__WEBPACK_IMPORTED_MODULE_0__.R1}}function hanleStartGameEvent(e){var t=(0,_core__WEBPACK_IMPORTED_MODULE_1__.sx)(e);if(null!==t){_core__WEBPACK_IMPORTED_MODULE_1__.Ay.level=t,console.log("start game level: ".concat(e)),_menu__WEBPACK_IMPORTED_MODULE_2__.A.hideMenu();var _=(0,_dom__WEBPACK_IMPORTED_MODULE_19__.J6)("nameInput"),o=(0,_dom__WEBPACK_IMPORTED_MODULE_19__.J6)("submitName");(0,_dom__WEBPACK_IMPORTED_MODULE_19__.C)("nameInput"),(0,_dom__WEBPACK_IMPORTED_MODULE_19__.C)("submitName"),_.placeholder=_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("input_name_tip"),_.style.transform="translate()";var n=function(){var e=_.value.trim();if(e.length>0){(0,_dom__WEBPACK_IMPORTED_MODULE_19__.Vx)("nameInput"),(0,_dom__WEBPACK_IMPORTED_MODULE_19__.Vx)("submitName"),_config__WEBPACK_IMPORTED_MODULE_0__.Z4.name=e,console.log("player name: ",_config__WEBPACK_IMPORTED_MODULE_0__.Z4.name),console.log("start text: ",_config__WEBPACK_IMPORTED_MODULE_0__.Z4.startText);var o=function(){(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.rw)((function(){_floor__WEBPACK_IMPORTED_MODULE_3__.Ay.switchFloor(_config__WEBPACK_IMPORTED_MODULE_0__.Z4.initFloorID,void 0,_config__WEBPACK_IMPORTED_MODULE_0__.Z4.player.loc)}))};(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.m)(_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("choose_sex"),(function(){(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.nL)((function(){_core__WEBPACK_IMPORTED_MODULE_1__.Ay.reset(_config__WEBPACK_IMPORTED_MODULE_0__.Z4.isMan,selectPlayerData(t),t,_config__WEBPACK_IMPORTED_MODULE_0__.Z4.initFloorID),console.log("player data: ",_config__WEBPACK_IMPORTED_MODULE_0__.Z4.player),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.m)(_config__WEBPACK_IMPORTED_MODULE_0__.Z4.startText,o)}))}))}else alert("Please input your name!")};o.addEventListener("click",n),o.addEventListener("touchend",n),_.addEventListener("keypress",(function(e){"Enter"===e.key&&n()}))}else console.error("Invalid level: ".concat(t))}function handleClickStartGameButtonEvent(){(0,_dom__WEBPACK_IMPORTED_MODULE_19__.Vx)("menuButtons"),(0,_dom__WEBPACK_IMPORTED_MODULE_19__.C)("levelButtons")}function doAction(){var e,t,_,o,n;if(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.boxAnimateObjs=[],(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.qO)("ui"),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.X9)("ui",1),!(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(null===(t=null===(e=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event)||void 0===e?void 0:e.data)||void 0===t?void 0:t.list)||0===(null===(o=null===(_=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event)||void 0===_?void 0:_.data)||void 0===o?void 0:o.list.length))return(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(null===(n=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event)||void 0===n?void 0:n.callback)&&_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.callback(),void(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.nH)();var a=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.data.list.shift();console.log("shift elem:",a),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.data.current=a;var i=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.data.x,r=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.data.y;if("string"==typeof a)return _core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.data.type="text",void(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.T$)(a);var s=a;switch(console.log("data:",s),console.log("data.type:",s.type),s.type){case"text":(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.T$)(s.data);break;case"setText":var l=s.position;["up","down","center"].includes(l)&&(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.textAttribute.position=l),["background","title","text"].forEach((function(e){(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(s[e])&&s[e]instanceof Array&&s[e].length>=3&&(3==s[e].length&&s[e].push(1),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.textAttribute.t=s[e])})),doAction();break;case"move":(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(s.loc)&&(i=s.loc[0],r=s.loc[1]),(0,_animates__WEBPACK_IMPORTED_MODULE_15__.sz)(i,r,s.steps,s.time,s.immediateHide,(function(){doAction()}));break;case"show":console.log("show action data:",s),"number"==typeof s.loc[0]&&"number"==typeof s.loc[1]&&(s.loc=[s.loc]),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(s.time)&&s.time>0&&(!(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(s.floorId)||(s.floorId,_core__WEBPACK_IMPORTED_MODULE_1__.Ay.floorId)),s.loc.forEach((function(e){(0,_animates__WEBPACK_IMPORTED_MODULE_15__.Ar)(e[0],e[1],s.floorId)})),doAction();break;case"hide":(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(s.loc)||(s.loc=[i,r]),"number"==typeof s.loc[0]&&"number"==typeof s.loc[1]&&(s.loc=[s.loc]),s.loc.forEach((function(e){removeBlock(e[0],e[1],s.floorId)})),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(s.time)&&s.time>0&&(!(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(s.floorId)||s.floorId==_core__WEBPACK_IMPORTED_MODULE_1__.Ay.floorId)?(0,_animates__WEBPACK_IMPORTED_MODULE_15__.Cd)(s.loc,"hide",s.time,doAction):doAction();break;case"setValue":console.log("setValue data:",s);var c=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.evalValue(s.value);if(console.log("setValue:",c),s.name.startsWith("status:")){var u=(0,_util__WEBPACK_IMPORTED_MODULE_4__.RI)(c);_core__WEBPACK_IMPORTED_MODULE_1__.Ay.setStatus(s.name.substring(7),u)}if(s.name.startsWith("item:")){var E=s.name.slice(5);console.log("setItem ",E,": ",c),(0,_items__WEBPACK_IMPORTED_MODULE_9__.SO)(E,c)}if(0==s.name.indexOf("flag:")&&_core__WEBPACK_IMPORTED_MODULE_1__.Ay.setFlag(s.name.substring(5),c),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.hp<=0)return _core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.hp=0,_status_bar__WEBPACK_IMPORTED_MODULE_12__.A.syncPlayerStatus(),void handleGameover("damaged");_status_bar__WEBPACK_IMPORTED_MODULE_12__.A.syncPlayerStatus(),doAction();break;case"if":console.log("if data:",s);var d=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.evalValue(s.condition);console.log("condition:",d),doOrInsertAction(d?s.true:s.false),doAction();break;case"switchFloor":console.log("doaction switchFloor data:",s);var D={x:s.loc[0],y:s.loc[1],direction:s.direction};_floor__WEBPACK_IMPORTED_MODULE_3__.Ay.switchFloor(s.floorId||_core__WEBPACK_IMPORTED_MODULE_1__.Ay.floorId,void 0,D,s.time,(function(){console.log("lock here6\n"),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.locked=!0,doAction()}));break;case"setBlock":(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(s.loc)&&(i=s.loc[0],r=s.loc[1]);var p=s.floorId||_core__WEBPACK_IMPORTED_MODULE_1__.Ay.floorId,y=_floors__WEBPACK_IMPORTED_MODULE_7__.Ay.getFloorById(p),v=(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.gd)(i,r,p,!1),O=(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.gd)(i,r,s.number).block;if((0,_floors__WEBPACK_IMPORTED_MODULE_7__.m6)(O),(0,_floors__WEBPACK_IMPORTED_MODULE_7__.W2)(O,i,r,y.nonFirstArriveEvents[i+","+r]),(0,_floors__WEBPACK_IMPORTED_MODULE_7__.MI)(p,O,i,r,y.switchFloorEvent[i+","+r]),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(O.event)&&((0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(v)?(v.block.id=s.number,v.block.event=O.event):(0,_map__WEBPACK_IMPORTED_MODULE_16__.xO)(p,O),p==_core__WEBPACK_IMPORTED_MODULE_1__.Ay.floorId)){(0,_map__WEBPACK_IMPORTED_MODULE_16__.J5)(p);var P=(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Yf)();(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.ut)(P.direction,P.x,P.y,"stop"),_status_bar__WEBPACK_IMPORTED_MODULE_12__.A.syncPlayerStatus()}doAction();break;case"openShop":console.log("doaction openShop data:",s),openShopHandler(s.id);break;case"win":console.log("doaction win data:",s),win(s.reason,(function(){doAction()}));case"openDoor":var M=s.floorId||_core__WEBPACK_IMPORTED_MODULE_1__.Ay.floorId,A=(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.gd)(s.loc[0],s.loc[1],M);if((0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(A)){M==_core__WEBPACK_IMPORTED_MODULE_1__.Ay.floorId?openDoorHandler(A.block.event.id,A.block.x,A.block.y,!1,(function(){doAction()})):(removeBlock(A.block.x,A.block.y,M),doAction());break}doAction();break;case"animate":(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(s.loc)&&("player"==s.loc?(i=(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Yf)().x,r=(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Yf)().y):s.loc instanceof Array&&(i=s.loc[0],r=s.loc[1])),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.ap)(s.name,i,r,(function(){doAction()}));break;case"choices":(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.vz)(s.text,s.choices);break;case"revisit":var g=(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.gd)(i,r);if((0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(g)){var h=g.block;(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(h.event)&&"action"==h.event.trigger&&(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.data.list=(0,_util__WEBPACK_IMPORTED_MODULE_4__.o8)(h.event.data))}doAction();break;case"exit":_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.data.list=[],doAction();break;default:_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.data.type="text",(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.T$)("\t[警告]出错啦！\n"+s.type+" 事件不被支持...")}}function doEvents(e,t,_,o){console.log("do events: ",e," at",t,",",_,"callback:",o);var n=e;e instanceof Array||(n=[e]);(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.ln)((function(){console.log("lock here3\n"),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.locked=!0,console.log("on player stop action list: ",n),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event={id:"action",data:{list:(0,_util__WEBPACK_IMPORTED_MODULE_4__.o8)(n),x:t,y:_},callback:o},console.log("now event: ",_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event),doAction()}))}function triggerPointEvent(e,t){console.log("trigger pointer event cur floorid: ",_core__WEBPACK_IMPORTED_MODULE_1__.Ay.floorId);var _=(0,_map__WEBPACK_IMPORTED_MODULE_16__.Vv)(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.floorId).blocks;console.log("trigger pointer event, cur mapblocks:",_);for(var o=0;o<_.length;o++){var n=_[o];if(n.x==e&&n.y==t&&(!(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(n.enable)||n.enable)&&(n.event&&n.event.noPass&&(0,_autoroute__WEBPACK_IMPORTED_MODULE_8__.kJ)(e,t),console.log("trigger event at",e,",",t,"event:",n.event),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(n.event)&&(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(n.event.trigger))){var a=n.event.trigger;console.log("event trigger:",a),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.autoRoute.moveDirectly=!1,(0,events[a])(n)}}}function doOrInsertAction(e,t,_,o){if(console.log("do or insert action event",_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event),!(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event)||!(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.id))return console.log("do event here:",e," at",t,",",_,"callback:",o),void doEvents(e,t,_,o);console.log("insert action: ",e," at",t,",",_,"callback:",o),(0,_util__WEBPACK_IMPORTED_MODULE_4__.qP)(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.data.list,e),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(t)&&(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.data.x=t),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(_)&&(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.data.y=_),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(o)&&(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.callback=o)}function handlePostSwitchFloor(e){var t,_;if((0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(null===(t=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event)||void 0===t?void 0:t.id))console.log("handle post switch floor event exist id",null===(_=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event)||void 0===_?void 0:_.id);else{var o="visited"+e;if(!_core__WEBPACK_IMPORTED_MODULE_1__.Ay.hasFlag(o)){var n=_floors__WEBPACK_IMPORTED_MODULE_7__.Ay.getFloorById(e);(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(n.firstArriveEvents)&&(console.log("first arrive events: ",n.firstArriveEvents),doEvents(n.firstArriveEvents)),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.flags[o]=!0}}}function waitPlayerToStop(e){(0,_autoroute__WEBPACK_IMPORTED_MODULE_8__.Di)(),(0,_autoroute__WEBPACK_IMPORTED_MODULE_8__.u9)(),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(e)&&(console.log("lock here7\n"),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.locked=!0,_core__WEBPACK_IMPORTED_MODULE_1__.Ay.autoRoute.moveDirectly=!1,setTimeout((function(){var t=(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Yf)();(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.ut)(t.direction,t.x,t.y,"stop"),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(e)&&e()}),30))}function handleGameover(e,t){void 0===t&&(t=!1),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.nH)(),waitPlayerToStop((function(){(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.m)([t?"\t".concat(_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("gameover_ending2"),"\n").concat(_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t(e)):"\t".concat(_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("gameover_ending1"),"\n").concat(_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t(e))],(function(){_menu__WEBPACK_IMPORTED_MODULE_2__.A.show()}))}))}function removeBlockById(e,t){var _=(0,_map__WEBPACK_IMPORTED_MODULE_16__.Vv)(t).blocks,o=_[e].x,n=_[e].y,a=_floors__WEBPACK_IMPORTED_MODULE_7__.Ay.getFloorById(t),i=o+","+n,r=void 0;i in a.nonFirstArriveEvents?r=a.nonFirstArriveEvents[i]:i in a.switchFloorEvent&&(r=a.switchFloorEvent[i]),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(r)?_[e].enable=!1:_.splice(e,1)}function updateFg(){var e;if(console.log("update fg"),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.mapData)&&(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.mapData.blocks)){var t=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.mapData.blocks;if((0,_canvas__WEBPACK_IMPORTED_MODULE_5__.qO)("fg"),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.hasItem("book")){console.log("has book");var _=(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Yc)("fg");(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.q9)("fg","bold 11px Arial");var o=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.hp;if(_config__WEBPACK_IMPORTED_MODULE_0__.Z4.displayEnemyDamage){_.textAlign="left";for(var n=0;n<t.length;n++){var a=t[n],i=a.x,r=a.y;if((0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(a.event)&&"enemys"==(null===(e=a.event)||void 0===e?void 0:e.cls)&&(!(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(a.enable)||a.enable)){if("battle"!=a.event.trigger){var s=_floors__WEBPACK_IMPORTED_MODULE_7__.Ay.getFloorById(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.floorId).nonFirstArriveEvents,l=i+","+r;if(l in s){var c=s[l];if(!(c instanceof Array)&&(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(c.displayDamage)&&!c.displayDamage)continue}}var u=a.event.id,E="#000000";E=(D=(0,_enemys__WEBPACK_IMPORTED_MODULE_10__.Ug)(u))<=0?"#00FF00":D<o/3?"#FFFFFF":D<2*o/3?"#FFFF00":D<o?"#FF7F00":"#FF0000";var d=D.toString();D>=999999999?d="???":D>1e5&&(d=(D/1e4).toFixed(1)+"w"),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.xL)("fg","#000000"),_.fillText(d,32*i+2,32*(r+1)-2),_.fillText(d,32*i,32*(r+1)-2),_.fillText(d,32*i+2,32*(r+1)),_.fillText(d,32*i,32*(r+1)),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.xL)("fg",E),_.fillText(d,32*i+1,32*(r+1)-1)}}}if(_config__WEBPACK_IMPORTED_MODULE_0__.Z4.displayExtraDamage){_.textAlign="center";for(i=0;i<13;i++)for(r=0;r<13;r++){var D;if((D=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.blockingCtx.damage[13*i+r])>0){d=D.toString();(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.xL)("fg","#000000"),_.fillText(d,32*i+17,32*(r+1)-13),_.fillText(d,32*i+15,32*(r+1)-15),_.fillText(d,32*i+17,32*(r+1)-15),_.fillText(d,32*i+15,32*(r+1)-13),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.xL)("fg","#FF7F00"),_.fillText(d,32*i+16,32*(r+1)-14)}}}}else console.log("no book")}}function removeBlock(e,t,_){_=_||_core__WEBPACK_IMPORTED_MODULE_1__.Ay.floorId;var o=(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.gd)(e,t,_,!1);if((0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(o)){var n=o.index;_==_core__WEBPACK_IMPORTED_MODULE_1__.Ay.floorId&&((0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Jg)(e,t),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.qO)("event",32*e,32*t,32,32)),removeBlockById(n,_),updateFg()}}function handleSnipe(e){var t={up:{x:0,y:-1},left:{x:-1,y:0},down:{x:0,y:1},right:{x:1,y:0}};e.forEach((function(e){var _=e.x,o=e.y;e.direction;e.nx=_+t[e.direction].x,e.ny=o+t[e.direction].y,(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Jg)(_,o);var n=(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.gd)(_,o).block,a=_icons__WEBPACK_IMPORTED_MODULE_13__.P[n.event.cls];e.blockIcon=a[n.event.id],e.blockImage=_images__WEBPACK_IMPORTED_MODULE_14__.zC[n.event.cls];var i=(0,_enemys__WEBPACK_IMPORTED_MODULE_10__.Ug)(n.event.id),r=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.hp,s="#000000";s=i<=0?"#00FF00":i<r/3?"#FFFFFF":i<2*r/3?"#FFFF00":i<r?"#FF7F00":"#FF0000";var l=i.toString();i>=999999999?l="???":i>1e5&&(l=(i/1e4).toFixed(1)+"w"),e.damage=l,e.color=s,e.block=(0,_util__WEBPACK_IMPORTED_MODULE_4__.o8)(n)}));waitPlayerToStop((function(){console.log("lock here8\n"),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.locked=!0;var _=0,o=0,n=0,a=(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Yc)("fg");a.textAlign="left";var i=setInterval((function(){_++,(n+=500/_constants__WEBPACK_IMPORTED_MODULE_18__.uE)>=2*_config__WEBPACK_IMPORTED_MODULE_0__.Z4.animateSpeed/2&&(o++,n=0,o>=2&&(o=0)),e.forEach((function(e){var n=e.x,i=e.y,r=e.direction,s=32*n+2*t[r].x*_,l=32*i+2*t[r].y*_;(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.qO)("event",s-2*t[r].x,l-2*t[r].y,32,32),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.qO)("fg",s-2*t[r].x,l-2*t[r].y,32,32),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Yc)("event").drawImage(e.blockImage,32*o,32*e.blockIcon,32,32,s,l,32,32),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.hasItem("book")&&((0,_canvas__WEBPACK_IMPORTED_MODULE_5__.xL)("fg","#000000"),a.fillText(e.damage,s+2,l+30),a.fillText(e.damage,s,l+30),a.fillText(e.damage,s+2,l+32),a.fillText(e.damage,s,l+32),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.xL)("fg",e.color),a.fillText(e.damage,s+1,l+31))})),16==_&&(clearInterval(i),e.forEach((function(e){removeBlock(e.x,e.y);var t=(0,_util__WEBPACK_IMPORTED_MODULE_4__.o8)(e.block);t.x=e.nx,t.y=e.ny,_core__WEBPACK_IMPORTED_MODULE_1__.Ay.mapData.blocks.push(t),(0,_animates__WEBPACK_IMPORTED_MODULE_15__.kK)(2,32*e.nx,32*e.ny,e.blockIcon,e.blockImage),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Yc)("event").drawImage(e.blockImage,0,32*e.blockIcon,32,32,32*e.nx,32*e.ny,32,32)})),(0,_animates__WEBPACK_IMPORTED_MODULE_15__.So)(),_status_bar__WEBPACK_IMPORTED_MODULE_12__.A.syncPlayerStatus(),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.id)||(console.log("unlock here2\n"),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.locked=!1))}),31.25)}))}function checkAndHandleBlockEvent(){var e=(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Yf)(),t=e.x,_=e.y,o=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.blockingCtx.damage[13*t+_];if(o>0){_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.hp-=o;var n=[],a={up:{x:0,y:-1},left:{x:-1,y:0},down:{x:0,y:1},right:{x:1,y:0}};for(var i in a){var r=t+a[i].x,s=_+a[i].y;if(!(r<0||r>12||s<0||s>12)){var l=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.blockingCtx.map[13*r+s];if((0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(l)){var c=(0,_enemys__WEBPACK_IMPORTED_MODULE_10__.DD)(l);(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(c)&&(0,_enemys__WEBPACK_IMPORTED_MODULE_10__.MD)(c.special,18)&&n.push({direction:i,x:r,y:s})}}}if(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.blockingCtx.hasBlock[13*t+_]&&o>0?(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Qx)(_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("blocking_attack_half_hp")):n.length>0&&o>0?(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Qx)("".concat(_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("blocking_attack"),": ").concat(o)):o>0&&(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Qx)("".concat(_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("zone_attack"),": ").concat(o)),_sound__WEBPACK_IMPORTED_MODULE_11__.A.play("zone.ogg"),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.ap)("zone",t,_),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.hp<=0)return _core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.hp=0,_status_bar__WEBPACK_IMPORTED_MODULE_12__.A.syncPlayerStatus(),void handleGameover("zone");n=n.filter((function(e){var t=e.x,_=e.y,o=e.direction,n=t+a[o].x,i=_+a[o].y;return n>=0&&n<=12&&i>=0&&i<=12&&!(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)((0,_canvas__WEBPACK_IMPORTED_MODULE_5__.gd)(n,i,_core__WEBPACK_IMPORTED_MODULE_1__.Ay.floorId,!1))})),_status_bar__WEBPACK_IMPORTED_MODULE_12__.A.syncPlayerStatus(),n.length>0&&handleSnipe(n)}}var openDoorInterval=null;function openDoorHandler(e,t,_,o,n){if(void 0===o&&(o=!0),console.log("open door handler:",e,t,_,o,n),!(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(openDoorInterval))if((0,_map__WEBPACK_IMPORTED_MODULE_16__.nV)(t,_,e)){0==_core__WEBPACK_IMPORTED_MODULE_1__.Ay.autoRoute.remainingRoute.length&&(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.autoRoute.remainingRoute=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.autoRoute.routes.slice(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.autoRoute.step-1,_core__WEBPACK_IMPORTED_MODULE_1__.Ay.autoRoute.routes.length),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.autoRoute.remainingRoute.length>0&&(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.autoRoute.remainingRoute[0].step-=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.autoRoute.movedSteps)),(0,_autoroute__WEBPACK_IMPORTED_MODULE_8__.Di)();var a=30;if(o){var i=e.replace("Door","Key");if(console.log("need key:",i),console.log("has key:",_core__WEBPACK_IMPORTED_MODULE_1__.Ay.hasItem(i)),!_core__WEBPACK_IMPORTED_MODULE_1__.Ay.hasItem(i))return"specialKey"!=i?(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Qx)(_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("have_no")+(0,_items__WEBPACK_IMPORTED_MODULE_9__.gt)(i).name):(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Qx)(_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("open_door_failed")),void(0,_autoroute__WEBPACK_IMPORTED_MODULE_8__.u9)();autosave(!0),removeItem(i)}_sound__WEBPACK_IMPORTED_MODULE_11__.A.play("door.ogg");var r=0,s=e;"Door"!=s.substring(s.length-4)&&(s+="Door",a=100);var l=_icons__WEBPACK_IMPORTED_MODULE_13__.P.animates[s];openDoorInterval=setInterval((function(){if(4==++r)return clearInterval(openDoorInterval),openDoorInterval=null,removeBlock(t,_),void postOpenDoorHandler(e,t,_,n);(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.qO)("event",32*t,32*_,32,32),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Yc)("event").drawImage(_images__WEBPACK_IMPORTED_MODULE_14__.zC.animates,32*r,32*l,32,32,32*t,32*_,32,32)}),a)}else(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(n)&&n()}function removeItem(e){if(!_core__WEBPACK_IMPORTED_MODULE_1__.Ay.hasItem(e))return!1;var t=(0,_items__WEBPACK_IMPORTED_MODULE_9__.gt)(e).cls,_=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.items[t];return"yellowKey"===e?_.yellowKey--:"blueKey"===e?_.blueKey--:"redKey"===e?_.redKey--:"greenKey"===e?_.greenKey--:_[t]--,_status_bar__WEBPACK_IMPORTED_MODULE_12__.A.syncPlayerStatus(),!0}function postOpenDoorHandler(e,t,_,o){var n,a,i=[];if((0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(t)&&(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(_)){var r=null===(n=_floors__WEBPACK_IMPORTED_MODULE_7__.Ay.getFloorById(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.floorId))||void 0===n?void 0:n.postOpenDoorEvent,s=t+","+_;if((0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(r)&&s in r){var l=r[s];(0,_util__WEBPACK_IMPORTED_MODULE_4__.qP)(i,l)}}i.length>0&&doOrInsertAction(i,t,_),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(null===(a=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event)||void 0===a?void 0:a.id)?(0,_autoroute__WEBPACK_IMPORTED_MODULE_8__.u9)():(0,_autoroute__WEBPACK_IMPORTED_MODULE_8__.iF)(),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(o)&&o()}function getItemHandler(e,t,_,o,n){var a;_sound__WEBPACK_IMPORTED_MODULE_11__.A.play("item.ogg");var i=(0,_items__WEBPACK_IMPORTED_MODULE_9__.gt)(e);(0,_items__WEBPACK_IMPORTED_MODULE_9__.Md)(e,t),removeBlock(_,o);var r=_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("get_item")+(0,_items__WEBPACK_IMPORTED_MODULE_9__.gt)(e).name;t>1&&(r+=" x "+t),"items"===i.cls&&(r+=(0,_items__WEBPACK_IMPORTED_MODULE_9__.Ro)(e)),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Qx)(r,_icons__WEBPACK_IMPORTED_MODULE_13__.P.items[e]),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.qO)("event",32*_,32*o,32,32),_status_bar__WEBPACK_IMPORTED_MODULE_12__.A.syncPlayerStatus();var s=_+","+o,l=null===(a=_floors__WEBPACK_IMPORTED_MODULE_7__.Ay.getFloorById(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.floorId))||void 0===a?void 0:a.postGetItemEvent;(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(l)&&s in l?doEvents(l[s],_,o,n):(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(n)&&n()}function postBattleHandler(e,t,_,o){var n;if(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.hp-=(0,_enemys__WEBPACK_IMPORTED_MODULE_10__.Ug)(e),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.hp<=0)return _core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.hp=0,void handleGameover("battle");var a=(0,_enemys__WEBPACK_IMPORTED_MODULE_10__.DD)(e),i=a.money;_core__WEBPACK_IMPORTED_MODULE_1__.Ay.hasItem("coin")&&(i*=2),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.getFlag("curse",!1)&&(i=0),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.money+=i;var r=a.experience;_core__WEBPACK_IMPORTED_MODULE_1__.Ay.getFlag("curse",!1)&&(r=0),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.exp+=r,(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(t)&&(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(_)&&(removeBlock(t,_),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.qO)("event",32*t,32*_,32,32));var s=_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("battle_success")+a.name;s+=", "+_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("money")+" + "+i,s+=", "+_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("exp")+" + "+r,(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Qx)(s);var l=a.special;(0,_enemys__WEBPACK_IMPORTED_MODULE_10__.MD)(l,12)&&!_core__WEBPACK_IMPORTED_MODULE_1__.Ay.getFlag("poison",!1)&&_core__WEBPACK_IMPORTED_MODULE_1__.Ay.setFlag("poison",!0),(0,_enemys__WEBPACK_IMPORTED_MODULE_10__.MD)(l,13)&&!_core__WEBPACK_IMPORTED_MODULE_1__.Ay.getFlag("weak",!1)&&(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.setFlag("weak",!0),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.attack-=_config__WEBPACK_IMPORTED_MODULE_0__.Z4.weakValue,_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.defense-=_config__WEBPACK_IMPORTED_MODULE_0__.Z4.weakValue),(0,_enemys__WEBPACK_IMPORTED_MODULE_10__.MD)(l,14)&&!_core__WEBPACK_IMPORTED_MODULE_1__.Ay.getFlag("curse",!1)&&_core__WEBPACK_IMPORTED_MODULE_1__.Ay.setFlag("curse",!0),(0,_enemys__WEBPACK_IMPORTED_MODULE_10__.MD)(l,19)&&(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.hp=10),(0,_enemys__WEBPACK_IMPORTED_MODULE_10__.MD)(l,21)&&_core__WEBPACK_IMPORTED_MODULE_1__.Ay.getFlag("degenerate",!1)&&(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.attack-=a.atk,_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.defense-=a.def,_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.attack<0&&(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.attack=0),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.defense<0&&(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.defense=0)),_status_bar__WEBPACK_IMPORTED_MODULE_12__.A.syncPlayerStatus();var c=[];if(!(0,_enemys__WEBPACK_IMPORTED_MODULE_10__.MD)(l,18)&&(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(t)&&(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(_)){var u=_floors__WEBPACK_IMPORTED_MODULE_7__.Ay.getFloorById(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.floorId).postBattleEvent,E=t+","+_;(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(u)&&E in u&&(0,_util__WEBPACK_IMPORTED_MODULE_4__.qP)(c,u[E])}c.length>0&&doOrInsertAction(c,t,_),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(null===(n=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event)||void 0===n?void 0:n.id)||(0,_autoroute__WEBPACK_IMPORTED_MODULE_8__.iF)(),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(o)&&o()}function battleHandler(e,t,_,o,n){var a;if(void 0===o&&(o=!1),0==_core__WEBPACK_IMPORTED_MODULE_1__.Ay.autoRoute.remainingRoute.length&&(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.autoRoute.remainingRoute=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.autoRoute.remainingRoute.slice(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.autoRoute.step-1,_core__WEBPACK_IMPORTED_MODULE_1__.Ay.autoRoute.routes.length),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.autoRoute.remainingRoute.length>0&&(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.autoRoute.remainingRoute[0].step-=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.autoRoute.movedSteps)),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.ln)(),(0,_autoroute__WEBPACK_IMPORTED_MODULE_8__.Di)(),(0,_enemys__WEBPACK_IMPORTED_MODULE_10__.Ug)(e)>=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.hp&&!o)return(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Qx)(_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("try_beat_failed")),void(0,_autoroute__WEBPACK_IMPORTED_MODULE_8__.u9)();(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(null===(a=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event)||void 0===a?void 0:a.id)||autosave(!0),_config__WEBPACK_IMPORTED_MODULE_0__.Z4.showBattleAnimate?waitPlayerToStop((function(){(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.sV)(e,(function(){postBattleHandler(e,t,_,n)}))})):(_config__WEBPACK_IMPORTED_MODULE_0__.Z4.equipmentDirectly&&"sword0"!=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.getFlag("sword","sword0")?(_sound__WEBPACK_IMPORTED_MODULE_11__.A.play("zone.ogg"),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.ap)("sword",t,_)):(_sound__WEBPACK_IMPORTED_MODULE_11__.A.play("attack.ogg"),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.ap)("hand",t,_)),postBattleHandler(e,t,_,n))}function openShopHandler(shopId,needVisited){var _a,_b,_c,_d,_e;void 0===needVisited&&(needVisited=!1);var shop=(0,_shops__WEBPACK_IMPORTED_MODULE_17__.Nx)(shopId);if(console.log("openShopHandler: ",shopId,shop),!needVisited||_core__WEBPACK_IMPORTED_MODULE_1__.Ay.shopVisitedBefore(shopId)){_core__WEBPACK_IMPORTED_MODULE_1__.Ay.setShopVisited(shopId);var selection=null===(_a=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event)||void 0===_a?void 0:_a.selection,actions=[];(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(null===(_b=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event)||void 0===_b?void 0:_b.data)&&(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.data.actions)&&(actions=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.data.actions);var fromList=void 0;(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(null===(_c=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event)||void 0===_c?void 0:_c.data)&&(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(null===(_e=null===(_d=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event)||void 0===_d?void 0:_d.data)||void 0===_e?void 0:_e.fromList)&&(fromList=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.data.fromList),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.nH)(),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.locked=!0,console.log("lock here 10\n"),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event={id:"shop",data:{list:[],id:shopId,shop,actions,fromList},selection};var content="\t[".concat(shop.name,",").concat(shop.icon,"]"),times=shop.times,need=eval(shop.need);console.log("need: ",need," times: ",times),content+=shop.text.replace(/\${([^}]+)}/g,(function(word,value){return eval(value)}));for(var use="experience"==shop.use?_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("exp"):_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("money"),choices=[],i=0;i<shop.choices.length;i++){var choice=shop.choices[i],text=choice.text;(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(choice.need)&&(text+="（"+eval(choice.need)+use+"）"),choices.push(text)}choices.push(_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("leave")),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.vz)(content,choices)}else 0==shop.times?(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Qx)(_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("shop_not_opened")):(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Qx)(_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("shop_not_available"))}function tryUseToolBarTransporter(e){if(void 0===e&&(e=!1),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.checkStatusSatisfiedAndSetEventId("fly",e,!0))return _config__WEBPACK_IMPORTED_MODULE_0__.Z4.flyNearStair&&!_core__WEBPACK_IMPORTED_MODULE_1__.Ay.isNearStair()?((0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Qx)(_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("use_transporter_neer_floor")),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.locked=!1,console.log("unlock here 13\n"),void((0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event)&&(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.data=void 0,_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.id=void 0))):(0,_items__WEBPACK_IMPORTED_MODULE_9__.DM)("fly")?void(0,_items__WEBPACK_IMPORTED_MODULE_9__.H)("fly"):((0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Qx)(_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("failed_to_use_transporter")),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.locked=!1,console.log("unlock here 14\n"),void((0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event)&&(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.data=void 0,_core__WEBPACK_IMPORTED_MODULE_1__.Ay.event.id=void 0)))}function transporterOnClickHandler(){_core__WEBPACK_IMPORTED_MODULE_1__.Ay.started&&tryUseToolBarTransporter(!0)}function restartHandler(){(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.nH)(),_menu__WEBPACK_IMPORTED_MODULE_2__.A.show()}function openQuickShopHandler(e){void 0===e&&(e=!1),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.checkStatusSatisfiedAndSetEventId("selectShop",e)&&(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.U4)()}function turnPlayerHandler(){var e=(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Yf)();"up"==e.direction?e.direction="right":"right"==e.direction?e.direction="down":"down"==e.direction?e.direction="left":"left"==e.direction&&(e.direction="up"),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.ut)(e.direction,e.x,e.y,"stop",0,0),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.qO)("ui"),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.route.push("turn")}function openToolboxHandler(e){void 0===e&&(e=!1),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.checkStatusSatisfiedAndSetEventId("toolbox",e)&&(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.iH)()}function readFileHandler(e,t){alert("暂不支持")}function decodeRoute(e){if(!(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(e))return[];for(var t=[],_=0,o=function(t){void 0===t&&(t=void 0);for(var o="";_<e.length&&!isNaN(parseInt(e.charAt(_)));)o+=e.charAt(_++);return 0==o.length&&(o="1"),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(t)?o:parseInt(o)};_<e.length;){var n=e.charAt(_++),a=o();switch(n){case"U":for(var i=0;i<a;i++)t.push("up");break;case"D":for(i=0;i<a;i++)t.push("down");break;case"L":for(i=0;i<a;i++)t.push("left");break;case"R":for(i=0;i<a;i++)t.push("right");break;case"I":t.push("item:"+(0,_items__WEBPACK_IMPORTED_MODULE_9__.ey)(a));break;case"F":t.push("fly:"+_floors__WEBPACK_IMPORTED_MODULE_7__.Ay.getFloorById(a));break;case"C":t.push("choices:"+a);break;case"S":++_,t.push("shop:"+(0,_shops__WEBPACK_IMPORTED_MODULE_17__.Dx)(a)+":"+o(!0));break;case"T":t.push("turn");break;case"G":t.push("getNext");break;case"P":t.push("input:"+a);break;case"N":t.push("no");break;case"M":++_,t.push("move:"+a+":"+o())}}return t}function encodeRoute(e){var t="",_="",o=0;return e.forEach((function(e){if("up"==e||"down"==e||"left"==e||"right"==e)e!=_&&o>0&&(t+=_.substring(0,1).toUpperCase(),o>1&&(t+=o),o=0),_=e,o++;else if(o>0&&(t+=_.substring(0,1).toUpperCase(),o>1&&(t+=o),o=0),0==e.indexOf("item:"))t+="I"+(0,_items__WEBPACK_IMPORTED_MODULE_9__.bm)(e.substring(5));else if(0==e.indexOf("fly:"))t+="F"+e.substring(4);else if(0==e.indexOf("choices:"))t+="C"+e.substring(8);else if(0==e.indexOf("shop:")){var n=e.substring(5).split(":");t+="S"+(0,_shops__WEBPACK_IMPORTED_MODULE_17__.i3)(n[0])+":"+n[1]}else"turn"==e?t+="T":"getNext"==e?t+="G":0==e.indexOf("input:")?t+="P"+e.substring(6):"no"==e?t+="N":0==e.indexOf("move:")&&(t+="M"+e.substring(5))})),o>0&&(t+=_.substring(0,1).toUpperCase(),o>1&&(t+=o)),t}function saveData(e){for(var t={isMan:_config__WEBPACK_IMPORTED_MODULE_0__.Z4.isMan,floorId:_core__WEBPACK_IMPORTED_MODULE_1__.Ay.floorId,playerData:(0,_util__WEBPACK_IMPORTED_MODULE_4__.o8)(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData),level:_core__WEBPACK_IMPORTED_MODULE_1__.Ay.level,maps:(0,_map__WEBPACK_IMPORTED_MODULE_16__.bw)(),flags:_core__WEBPACK_IMPORTED_MODULE_1__.Ay.flags,route:encodeRoute(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.route),shops:{},notes:_core__WEBPACK_IMPORTED_MODULE_1__.Ay.notes,version:_config__WEBPACK_IMPORTED_MODULE_0__.Z4.version,time:(new Date).getTime()},_=Object.keys(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.shopVisited),o=0;o<_.length;o++){var n=_[o];t.shops[n]=(0,_util__WEBPACK_IMPORTED_MODULE_4__.o8)((0,_shops__WEBPACK_IMPORTED_MODULE_17__.Nx)(n))}return console.log("saveData: ",t),(0,_util__WEBPACK_IMPORTED_MODULE_4__.ZB)(e,t)}function loadData(e,t){console.log("loadData: ",e,t),(0,_map__WEBPACK_IMPORTED_MODULE_16__.Ak)(e.maps),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.reset(e.isMan,e.playerData,e.level,e.floorId,e.flags,decodeRoute(e.route),e.notes);for(var _=Object.keys(e.shops),o=0;o<_.length;o++){var n=_[o],a=e.shops[n];a.times>0&&(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.setShopVisited(n),console.log("load shop visited: ",n)),(0,_shops__WEBPACK_IMPORTED_MODULE_17__.HE)(n,(0,_util__WEBPACK_IMPORTED_MODULE_4__.o8)(a))}_floor__WEBPACK_IMPORTED_MODULE_3__.Ay.switchFloor(e.floorId,void 0,e.playerData.loc,100,(function(){console.log("switch floor after load data!"),(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(t)&&t()}))}function doSL(e,t){if("save"==t)return"autoSave"==e?void(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Qx)("不能覆盖自动存档！"):void(saveData("save"+e)?((0,_canvas__WEBPACK_IMPORTED_MODULE_5__.nH)(),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Qx)("存档成功！"),"autoSave"!=e&&(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.saveIndex=e,(0,_util__WEBPACK_IMPORTED_MODULE_4__.ZB)("saveIndex2",_core__WEBPACK_IMPORTED_MODULE_1__.Ay.saveIndex))):(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Qx)("存储空间不足，请覆盖已有的存档或在菜单栏中进行清理"));if("load"==t){var _=(0,_util__WEBPACK_IMPORTED_MODULE_4__.Lg)("autoSave"==e?e:"save"+e);return(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(_)?_.version!=_config__WEBPACK_IMPORTED_MODULE_0__.Z4.version?void(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Qx)("存档版本不匹配"):((0,_canvas__WEBPACK_IMPORTED_MODULE_5__.nH)(),void loadData(_,(function(){(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Qx)("读档成功"),"autoSave"!=e&&(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.saveIndex=e,(0,_util__WEBPACK_IMPORTED_MODULE_4__.ZB)("saveIndex2",_core__WEBPACK_IMPORTED_MODULE_1__.Ay.saveIndex))}))):void(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Qx)("无效的存档")}}function loadGameHandler(e){void 0===e&&(e=!1);var t=(0,_util__WEBPACK_IMPORTED_MODULE_4__.Lg)("saveIndex2",1),_=(0,_util__WEBPACK_IMPORTED_MODULE_4__.RI)((t-1)/5),o=t-5*_;if(console.log("load game: ",t,_,o),!_core__WEBPACK_IMPORTED_MODULE_1__.Ay.started){console.log("load game before start");return _core__WEBPACK_IMPORTED_MODULE_1__.Ay.insertOrUpdateEvent({id:"load"}),console.log("lock here 15\n"),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.locked=!0,(0,_dom__WEBPACK_IMPORTED_MODULE_19__.Vx)("menuBox"),void(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.kQ)(10*_+o)}_core__WEBPACK_IMPORTED_MODULE_1__.Ay.checkStatusSatisfiedAndSetEventId("load",e)&&(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.kQ)(10*_+o)}function saveGameHandler(e){if(void 0===e&&(e=!1),_core__WEBPACK_IMPORTED_MODULE_1__.Ay.checkStatusSatisfiedAndSetEventId("save",e)){var t=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.saveIndex;console.log("save index:",t);var _=(0,_util__WEBPACK_IMPORTED_MODULE_4__.RI)((t-1)/5),o=t-5*_;(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.kQ)(10*_+o)}}function loadImageOnClickHandler(){_core__WEBPACK_IMPORTED_MODULE_1__.Ay.started&&loadGameHandler(!0)}function saveImageOnClickHandler(){_core__WEBPACK_IMPORTED_MODULE_1__.Ay.started&&saveGameHandler(!0)}function win(e,t){(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.nH)();var _=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.playerData.level>=200;waitPlayerToStop((function(){(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.Uc)(),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.pZ)(),(0,_canvas__WEBPACK_IMPORTED_MODULE_5__.m)([_?"\t[True End]你的攻防和分数是${status:hp}。":"\t[Normal End]你的攻防和分数是${status:hp}。\n（只有不小于200级才能达成True End）"],(function(){handleGameover(_?"True End":"Normal End")}))}))}function autosave(e){console.log("autosave: ",e);var t=void 0;e&&(t=_core__WEBPACK_IMPORTED_MODULE_1__.Ay.route.pop()),saveData("autosave"),e&&(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(t)&&_core__WEBPACK_IMPORTED_MODULE_1__.Ay.route.push(t)}function canUseQuickShop(){var e=_floors__WEBPACK_IMPORTED_MODULE_7__.Ay.getFloorById(_core__WEBPACK_IMPORTED_MODULE_1__.Ay.floorId);return(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(e)&&(0,_util__WEBPACK_IMPORTED_MODULE_4__.DQ)(e.quickShopEnabled)&&!e.quickShopEnabled?"当前不能使用快捷商店。":null}},530:(e,t,_)=>{_.d(t,{$x:()=>P,Ay:()=>A,ze:()=>o});var o,n=_(883),a=_(28),i=_(876),r=_(306),s=_(137),l=_(197),c=_(578),u=_(202),E=_(916),d=_(462),D=_(600),p=_(746),y=_(250),v=_(795),O=_(921);function P(e){if((0,p.DQ)(e))switch(e){case"upFloor":return o.UPFLOOR;case"downFloor":return o.DOWNFLOOR;default:return}}function M(e){switch(e){case o.UPFLOOR:return console.log("StairDirectionToString upFloor"),"upFloor";case o.DOWNFLOOR:return console.log("StairDirectionToString downFloor"),"downFloor";default:return console.log("StairDirectionToString unknown"),"unknown"}}!function(e){e[e.UPFLOOR=1]="UPFLOOR",e[e.DOWNFLOOR=-1]="DOWNFLOOR"}(o||(o={}));const A=function(){function e(){if(e.instance)throw new Error("Error: Instantiation failed: Use FloorEngine.getInstance() instead of new.")}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.switchFloor=function(e,t,_,o,P){var A;void 0===o&&(o=800),console.log("switchFloor",e,t,_,o);var g=s.Ay.getFloorById(e);console.log("DestFloor: ",g);var h=o/O.uE;console.log("lock here9\n"),l.Ay.locked=!0,l.Ay.playerMoving=0,(0,D.Di)(),(0,D.u9)(),(0,i.AL)("titleLabelTip",n.A.t("title")),(0,i.AL)("versionLabelTip",a.Z4.version);var f=(0,p.DQ)(g.name)?n.A.t(g.name):n.A.t(g.title);(0,i.AL)("floorNameLabelTip",f),(0,p.DQ)(t)||(0,p.DQ)(_)||(_=l.Ay.playerData.loc),console.log("switch floor playerLoc: ",_);var m=(0,d.Vv)(e);if((0,p.DQ)(t)){console.log("switch floor stairDirection: ",t,M(t)),(0,p.DQ)(_)||(_={direction:"up",x:0,y:0});var I=m.blocks;console.log("blocks for floorId: ",e,I);for(var C=0;C<I.length;C++){var R=I[C];if((null===(A=R.event)||void 0===A?void 0:A.id)==t&&(console.log("switch floor block.event!.id: ",R.event.id),console.log("cur block",R),console.log("cur block enable",R.enable)),(0,p.DQ)(R.event)&&(!(0,p.DQ)(R.enable)||R.enable)&&R.event.id==M(t)){console.log("switch floor block.x: ",R.x,"block.y: ",R.y),_.x=R.x,_.y=R.y,console.log("after switchfloor, playerLoc: ",_);break}}(0,p.DQ)(_.x)||(_.x=l.Ay.playerData.loc.x,_.y=l.Ay.playerData.loc.y)}m.transporterEnabled&&l.Ay.playerData.flyRange.indexOf(e)<0&&(e>l.Ay.floorId?l.Ay.playerData.flyRange.push(e):l.Ay.playerData.flyRange.unshift(e)),setTimeout((function(){E.A.play("switch_floor.mp3"),(0,r.v0)("floorSwitchTipBox",h/2,(function(){(0,i.AL)("floorStatusText",n.A.t(g.title));var t=function(){console.log("draw map complete"),(0,p.DQ)(null==_?void 0:_.direction)&&(l.Ay.playerData.loc.direction=_.direction),l.Ay.playerData.loc.x=_.x,l.Ay.playerData.loc.y=_.y;var t=(0,y.Yf)();console.log("draw player at: ",t),(0,y.ut)(t.direction,t.x,t.y,"stop"),c.A.syncPlayerStatus();(0,r.qr)("floorSwitchTipBox",h/4,(function(){l.Ay.locked=!1,console.log("unlock here3\n"),c.A.show(),u.A.show(),(0,v.tW)(e),(0,p.DQ)(P)&&P()}))};(0,d.J5)(e,(function(){return setTimeout(t,25)}))}))}),30)},e}().getInstance()},137:(e,t,_)=>{_.d(t,{W2:()=>x,m6:()=>k,MI:()=>w,Ay:()=>Q,ET:()=>K,xE:()=>S});var o=_(746),n={floorId:0,title:"tower_entrance",name:"dream_start",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"ground",map:[[20,13,13,13,13,13,13,13,13,13,13,13,20],[20,13,13,13,13,20,20,20,13,13,13,13,20],[20,13,13,13,13,20,87,20,13,13,13,13,20],[20,13,13,13,13,20,0,20,13,13,13,13,20],[20,13,13,13,13,20,0,20,13,13,13,13,20],[20,13,13,13,13,20,0,20,13,13,13,13,20],[20,20,20,13,20,20,81,20,20,13,20,20,20],[17,17,20,20,20,149,149,0,20,20,20,17,17],[17,17,17,17,20,20,0,20,20,17,17,17,17],[17,17,17,17,17,20,20,20,17,17,17,17,17],[16,16,17,17,17,17,17,17,17,17,17,16,16],[16,16,16,17,17,17,17,17,17,17,16,16,16],[15,15,15,15,15,15,15,15,15,15,15,15,15]],firstArriveEvents:[{type:"hide",loc:[5,7]},"\t[player]\b[up,player]……我昏倒了吗？","\t[???,leina]\b[up,6,7]你还好吗?","\t[player]\b[up,player]……你是？","\t[???,leina]\b[up,6,7]我是一个魔法师。","\t[player]\b[up,player]（这地方是...，对了，艾达在这个奇怪的地方吗？）","\t[player]\b[up,player]请问你认识多丽丝·妮娅·艾达（Doris Nia Eda吗）？我是来救她的。","\t[蕾娜,leina]\b[up,6,7]原来是公主的朋友。","\t[蕾娜,leina]\b[up,6,7]我是公主的朋友——魔法师蕾娜。","\t[player]\b[up,player]（公主的朋友蕾娜？为何从来没听说过这个名字）","\t[player]\b[up,player] 蕾娜你好，我是{player}","\t[player]\b[up,player]……我这是在哪？我的剑怎么不见了？","\t[蕾娜,leina]\b[up,6,7]{player}，你好，这是终结塔！","\t[蕾娜,leina]\b[up,6,7]我方才感应到有人来到塔里才过来看到你，你的剑我不知道去哪了，有可能是被塔里的怪物拿走了。","\t[蕾娜,leina]\b[up,6,7]这么久来你是第一个能从塔外进来的人，不过这里处处都是怪物，你现在力量还不够，尤其是魔王END，他的力量恐怖如斯。","\t[player]\b[up,player]我得救出艾达，蕾娜你能告诉我怎么才能救她？","\t[蕾娜,leina]\b[up,6,7]如你所见，现在是只剩一丝灵魂力量的灵魂体，没办法直接帮你。","\t[蕾娜,leina]\b[up,6,7]塔内强者为王，你需要尽快变强，才有可能打败魔王END，救出公主。","\t[player]\b[up,player]嗯，我会努力的。","\t[蕾娜,leina]\b[up,6,7]我有一个灵器被怪物抢走了，你如果能找回给我的话，能让你变强很多！","\t[player]\b[up,player]灵器？它长什么样？","\t[蕾娜,leina]\b[up,6,7]一个中心镶嵌着红色宝石的十字架灵器。","\t[蕾娜,leina]\b[up,6,7]不久前，魔王END突然带怪物们占领了这座塔，并把公主和我囚禁在高层。为了躲过END的追杀，我将力量注入了灵器里，隐藏气息，只有灵魂逃了出来。能拿到灵器的话，就可以回复我的力量。","\t[player]\b[up,player]原来如此（为了就出艾达，姑且相信她吧）","\t[蕾娜,leina]\b[up,6,7] {player}，要记住，只有拿到灵器后，用我的魔力才可以打开21层的门。","\t[player]\b[up,player]好，我会去找到灵器给你的。","\t[蕾娜,leina]\b[up,6,7] {player}，我这里有些开门的钥匙，你拿着吧。",{type:"setValue",name:"item:yellowKey",value:"item:yellowKey+1"},{type:"setValue",name:"item:blueKey",value:"item:blueKey+1"},{type:"setValue",name:"item:redKey",value:"item:redKey+1"},"\t[player]\b[up,player]谢谢你，蕾娜。","\t[蕾娜,leina]\b[up,6,7]前进吧，我会给你加油的！","\t[蕾娜,leina]\b[up,6,7](艾达...你或许有救了)",{type:"move",loc:[6,7],steps:["left"],time:750,immediateHide:!0},{type:"show",loc:[5,7]}],nonFirstArriveEvents:{"5,7":{enable:!1,data:[{type:"if",condition:"item:cross>0",true:[{type:"setValue",name:"flag:levelUp",value:"true"},"\t[蕾娜,leina]\b[up]这是我的灵器，感谢你，{player}，我可以助你一臂之力了","\t[蕾娜,leina]\b[up]我现在将你的全属性提升1/3！\n鸡你太美！",{type:"animate",name:"yongchang"},{type:"animate",name:"levelup",loc:"player"},{type:"setValue",name:"status:hp",value:"status:hp*4/3"},{type:"setValue",name:"status:attack",value:"status:attack*4/3"},{type:"setValue",name:"status:defense",value:"status:defense*4/3"},"\t[蕾娜,leina]\b[up]好了，祝你成功救出艾达公主！","\t[蕾娜,leina]\b[up]等等，灵器激活后好感召到一个神秘空间，哪里的入口被打开了。","\t[蕾娜,leina]\b[up]{player}，你要小心！",{type:"hide",time:500}],false:["\t[小精灵,leina]\b[up]十字架拿到了吗？"]}]}},switchFloorEvent:{"6,2":{floorId:1,stairDirection:"downFloor"}},postBattleEvent:{},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},a={floorId:1,title:"main_1",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"ground",map:[[18,18,18,18,18,18,18,18,18,18,18,18,18],[18,87,0,21,201,202,201,0,0,0,0,0,18],[18,18,18,18,18,18,18,18,18,18,18,0,18],[18,31,0,209,81,0,18,31,21,31,18,0,18],[18,21,209,27,18,0,18,31,21,31,18,0,18],[18,18,81,18,18,0,18,18,18,203,18,0,18],[18,21,210,0,18,0,81,217,201,205,18,0,18],[18,28,0,22,18,0,18,18,18,18,18,0,18],[18,18,81,18,18,0,0,0,0,0,0,0,18],[18,0,210,0,18,18,83,18,18,18,81,18,18],[18,31,45,21,18,0,0,23,18,21,213,22,18],[18,31,32,21,18,0,88,0,18,21,21,21,18],[18,18,18,18,18,18,18,18,18,18,18,18,18]],firstArriveEvents:["\t[player]\b[up,player]这就是主塔么？","\t[player]\b[up,player]先打败这些挡路的怪吧"],nonFirstArriveEvents:{},switchFloorEvent:{"1,1":{floorId:2,stairDirection:"downFloor"},"6,11":{floorId:0,stairDirection:"upFloor"}},postBattleEvent:{},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},i={floorId:2,title:"main_2",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"brownground",map:[[19,19,19,19,19,19,19,19,19,19,19,19,19],[19,88,19,0,227,0,19,27,28,21,23,0,19],[19,0,19,28,19,32,19,27,28,21,22,0,19],[19,0,19,21,19,21,19,27,28,21,21,226,19],[19,0,19,21,19,21,19,19,19,19,19,84,19],[19,0,19,0,19,0,0,0,81,0,0,0,19],[19,0,19,81,19,19,81,19,19,19,84,19,19],[19,0,85,0,0,0,0,19,0,0,226,0,19],[19,0,19,81,19,19,82,19,86,19,19,86,19],[19,0,19,21,19,32,31,19,0,19,19,0,19],[19,0,19,21,19,32,31,19,0,19,19,0,19],[19,87,19,27,19,32,31,19,121,19,19,122,19],[19,19,19,19,19,19,19,19,19,19,19,19,19]],firstArriveEvents:[],nonFirstArriveEvents:{"8,11":["\t[神秘老人,man]\b[up]谢谢你救了我！送你70攻击吧！",{type:"setValue",name:"status:attack",value:"status:attack+70"},{type:"hide",time:500}],"11,11":["\t[神秘老人,woman]\b[up]谢谢你救了我！送你30防御吧！",{type:"setValue",name:"status:defense",value:"status:defense+30"},{type:"hide",time:500}]},switchFloorEvent:{"1,1":{floorId:1,stairDirection:"upFloor"},"1,11":{floorId:3,stairDirection:"downFloor"}},postBattleEvent:{"10,7":[{type:"openDoor",loc:[8,8]},{type:"openDoor",loc:[11,8]}]},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},r={floorId:3,title:"main_3",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"ground",map:[[18,18,18,18,18,18,18,18,18,18,18,18,18],[18,35,202,21,18,7,131,8,18,0,205,0,18],[18,202,21,0,18,0,0,0,18,0,18,0,18],[18,21,209,0,18,18,81,18,18,0,18,0,18],[18,18,81,18,18,0,209,0,18,21,18,202,18],[18,0,0,0,18,18,18,0,18,21,18,205,18],[18,201,18,0,205,202,205,0,18,21,18,202,18],[18,201,18,18,18,18,18,0,0,0,18,0,18],[18,0,0,0,0,0,18,18,81,18,18,0,18],[18,18,18,18,18,205,18,202,0,202,18,0,18],[18,18,0,0,0,0,18,27,205,21,18,0,18],[18,88,0,18,18,18,18,28,32,21,18,87,18],[18,18,18,18,18,18,18,18,18,18,18,18,18]],firstArriveEvents:["\t[player]\b[up,player]这层好像有商店！"],nonFirstArriveEvents:{"6,1":[{type:"openShop",id:"moneyShop1"}]},switchFloorEvent:{"11,11":{floorId:4,stairDirection:"downFloor"},"1,11":{floorId:2,stairDirection:"upFloor"}},postBattleEvent:{},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},s={floorId:4,title:"main_4",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"ground",map:[[18,18,18,18,18,18,18,18,18,18,18,18,18],[18,0,203,0,19,0,150,0,19,0,203,0,18],[18,81,18,81,19,0,0,0,19,81,18,81,18],[18,0,18,0,19,19,86,19,19,0,18,0,18],[18,0,18,209,19,206,207,206,19,209,18,0,18],[18,205,18,31,19,28,206,28,19,31,18,205,18],[18,205,18,31,19,19,83,19,19,31,18,205,18],[18,202,18,0,19,213,221,213,19,0,18,202,18],[18,0,18,0,19,27,213,27,19,0,18,0,18],[18,0,18,0,19,19,82,19,19,0,18,0,18],[18,0,18,0,19,21,0,21,19,0,18,0,18],[18,87,18,0,203,0,0,0,203,0,18,88,18],[18,18,18,18,18,18,18,18,18,18,18,18,18]],firstArriveEvents:["\t[player]\b[up,player]有别人被囚禁在这么？","\t[player]\b[up,player]或许他知道些什么信息","\t[player]\b[up,player]不过那个红色的蝙蝠守在他前面，看起来不太好对付。"],nonFirstArriveEvents:{"6,1":[{type:"if",condition:"!flag:visitedThief",true:["\t[迈特Jay,jay]\b[down]谢谢你救了我！","\t[迈特Jay,jay]\b[down]我叫迈特Jay，是一名寻宝猎人，有一天无意中闯入了这座塔，结果被这里的魔物们发现给关在了这里。","\t[player]\b[down,player]（蕾娜不是说我是最近唯一一个来的人吗，这是有人在说谎吗？）","\t[player]\b[down,player]没事！乐于助人嘛！","\t[迈特Jay,jay]\b[down]为了感谢你，我给你把2楼的机关门打开吧。",{type:"openDoor",loc:[2,7],floorId:2},"\t[迈特Jay,jay]\b[down]另外，我有一把锄头遗失在了这座塔里，如果你能帮我找到，我就可以为你打开18楼的通路","\t[player]\b[down,player]好的，我会留意的",{type:"setValue",name:"flag:visitedThief",value:"true"}],false:[{type:"if",condition:"item:icePickaxe>0",true:["\t[迈特Jay,jay]\b[down]这就是我的锄头！\n我现在就去为你打开18楼的通路！",{type:"hide"},{type:"hide",loc:[6,9],floorId:18},{type:"hide",loc:[6,10],floorId:18}],false:["\t[迈特Jay,jay]\b[down]你找到锄头了吗？","\t[player]\b[down,player]啊还没有，我再去找找~"]}]}]},switchFloorEvent:{"1,11":{floorId:5,stairDirection:"downFloor"},"11,11":{floorId:3,stairDirection:"upFloor"}},postBattleEvent:{"6,4":[{type:"openDoor",loc:[6,3]}]},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},l={floorId:5,title:"main_5",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"ground",map:[[18,18,18,18,18,18,18,18,18,18,18,18,18],[18,26,18,31,18,32,217,0,0,217,21,22,18],[18,0,18,27,18,217,0,0,0,0,217,21,18],[18,206,18,0,18,210,0,18,18,81,18,18,18],[18,0,81,217,18,36,210,18,0,213,210,122,18],[18,206,18,0,18,18,18,18,0,0,0,210,18],[18,27,18,0,0,0,205,209,0,0,0,0,18],[18,28,18,18,203,18,18,18,18,0,0,0,18],[18,0,121,18,203,18,0,0,0,213,221,0,18],[18,18,18,18,205,18,81,18,82,18,81,18,18],[18,0,0,18,0,18,205,18,28,81,0,18,18],[18,88,0,205,0,0,0,18,21,18,87,18,18],[18,18,18,18,18,18,18,18,18,18,18,18,18]],firstArriveEvents:["\t[player]\b[up,player]这层还有老爷爷被困在怪物间","\t[player]\b[up,player]难道除了公主外还有很多人被囚禁在这终结塔里么"],nonFirstArriveEvents:{"2,8":[{type:"openShop",id:"expShop1"}],"11,4":[{type:"openShop",id:"keyShop"}]},switchFloorEvent:{"10,11":{floorId:6,stairDirection:"downFloor"},"1,11":{floorId:4,stairDirection:"upFloor"}},postBattleEvent:{},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},c={floorId:6,title:"main_6",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"ground",map:[[18,18,18,18,18,18,18,18,18,18,18,18,18],[18,50,211,18,28,18,21,204,53,18,32,32,18],[18,211,21,18,27,18,0,21,204,18,215,32,18],[18,21,207,82,0,82,207,0,21,18,0,215,18],[18,0,0,18,221,18,0,0,0,18,220,0,18],[18,18,18,18,83,18,18,18,18,18,81,18,18],[18,0,0,218,0,21,21,21,0,218,0,0,18],[18,0,18,18,18,18,18,18,18,18,18,18,18],[18,0,18,206,81,206,0,0,0,0,0,18,18],[18,0,18,81,18,81,18,18,18,18,82,18,18],[18,0,18,206,18,0,0,18,18,0,0,18,18],[18,0,0,0,18,87,0,81,81,0,88,18,18],[18,18,18,18,18,18,18,18,18,18,18,18,18]],firstArriveEvents:[],nonFirstArriveEvents:{},switchFloorEvent:{"5,11":{floorId:7,stairDirection:"downFloor"},"10,11":{floorId:5,stairDirection:"upFloor"}},postBattleEvent:{},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},u={floorId:7,title:"main_7",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"brownground",map:[[19,19,19,19,19,19,19,19,19,19,19,19,19],[19,87,0,0,0,0,0,0,0,19,19,19,19],[19,19,19,0,207,19,84,19,211,0,19,19,19],[19,19,0,207,28,19,246,19,27,211,0,19,19],[19,0,0,19,19,19,86,19,19,19,0,0,19],[19,0,0,84,246,86,55,86,246,84,0,0,19],[19,0,19,19,19,19,86,19,19,19,19,0,19],[19,0,19,31,27,19,246,19,28,31,19,0,19],[19,0,19,21,31,19,84,19,31,21,19,0,19],[19,0,19,19,22,22,32,22,22,19,19,0,19],[19,0,0,19,19,19,83,19,19,19,0,0,19],[19,19,0,0,81,88,0,0,81,0,0,19,19],[19,19,19,19,19,19,19,19,19,19,19,19,19]],firstArriveEvents:["\t[player]\b[up,player]那是灵器么？不太敢确定...","\t[player]\b[up,player]绿色的钥匙很稀有，我得小心抉择。"],nonFirstArriveEvents:{"5,5":{trigger:"action",data:[{type:"openDoor",loc:[5,5]}]}},switchFloorEvent:{"1,1":{floorId:8,stairDirection:"downFloor"},"5,11":{floorId:6,stairDirection:"upFloor"}},postBattleEvent:{},postGetItemEvent:{"6,5":["\t[player]蕾娜找的灵器是这个吗？","\t[蕾娜,leina]对，我可以提升你的力量百分比，你可以在最合适的时候过来找我给你施法。"]},postOpenDoorEvent:{},blockCannotMoveDirections:{}},E={floorId:8,title:"main_8",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"ground",map:[[18,18,18,18,18,18,18,18,18,18,18,18,18],[18,88,18,0,0,0,0,18,0,21,211,0,18],[18,0,18,0,18,18,81,18,81,18,18,0,18],[18,0,18,0,18,0,0,82,0,0,18,27,18],[18,0,18,0,18,219,18,18,18,206,18,203,18],[18,206,18,0,18,31,18,87,0,0,18,203,18],[18,207,18,28,18,31,18,18,18,18,18,0,18],[18,206,18,203,18,0,0,0,18,0,207,0,18],[18,0,18,203,18,18,18,221,18,81,18,18,18],[18,0,18,0,211,0,18,211,18,0,0,0,18],[18,0,18,18,18,81,18,0,18,18,18,0,18],[18,0,0,219,0,0,18,0,204,246,204,0,18],[18,18,18,18,18,18,18,18,18,18,18,18,18]],firstArriveEvents:[],nonFirstArriveEvents:{},switchFloorEvent:{"7,5":{floorId:9,stairDirection:"downFloor"},"1,1":{floorId:7,stairDirection:"upFloor"}},postBattleEvent:{},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},d={floorId:9,title:"main_9",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"ground",map:[[18,18,18,18,18,18,18,18,18,18,18,18,18],[18,46,21,0,18,18,18,0,0,0,18,0,18],[18,21,0,214,81,0,0,0,18,0,81,211,18],[18,18,81,18,18,0,18,18,18,0,18,21,18],[18,0,0,0,18,0,18,0,0,0,18,21,18],[18,0,0,0,83,0,18,88,18,0,18,31,18],[18,18,82,18,18,0,18,18,18,0,18,18,18],[18,28,220,27,18,219,18,87,18,0,18,31,18],[18,18,81,18,18,0,0,0,81,0,18,21,18],[18,211,31,211,18,18,82,18,18,0,18,21,18],[18,22,211,31,18,215,219,215,18,0,81,211,18],[18,39,22,211,81,32,215,32,18,0,18,0,18],[18,18,18,18,18,18,18,18,18,18,18,18,18]],firstArriveEvents:[],nonFirstArriveEvents:{},switchFloorEvent:{"7,7":{floorId:10,stairDirection:"downFloor"},"7,5":{floorId:8,stairDirection:"upFloor"}},postBattleEvent:{},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},D={floorId:10,title:"main_10",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"ground",map:[[18,18,18,18,18,18,18,18,18,18,18,18,18],[18,0,18,18,28,214,18,214,27,18,18,0,18],[18,0,0,18,18,81,18,81,18,18,0,220,18],[18,0,0,0,0,0,18,0,0,0,220,32,18],[18,0,18,0,18,18,18,18,18,0,18,18,18],[18,206,18,0,0,21,21,21,0,0,18,21,18],[18,207,18,0,18,18,18,18,81,18,18,21,18],[18,206,18,0,86,0,88,18,0,81,207,0,18],[18,0,18,18,18,18,18,18,81,18,18,0,18],[18,0,18,31,28,27,18,0,207,0,18,21,18],[18,0,18,31,28,27,83,219,18,219,18,21,18],[18,87,18,31,28,27,18,22,18,22,18,31,18],[18,18,18,18,18,18,18,18,18,18,18,18,18]],firstArriveEvents:[],nonFirstArriveEvents:{"4,7":{trigger:"action",data:[{type:"openDoor",loc:[4,7]}]}},switchFloorEvent:{"1,11":{floorId:11,stairDirection:"downFloor"},"6,7":{floorId:9,stairDirection:"upFloor"}},postBattleEvent:{},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},p={floorId:11,title:"main_11",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"ground",map:[[19,19,19,19,19,19,19,19,19,19,19,19,19],[19,31,19,21,19,22,19,23,19,32,40,32,19],[19,31,19,21,19,22,19,23,19,222,223,222,19],[19,31,19,21,19,22,19,23,19,0,222,0,19],[19,81,19,81,19,81,19,81,19,19,82,19,19],[19,0,0,0,0,0,19,0,0,0,0,0,19],[19,81,19,19,82,19,19,19,82,19,19,81,19],[19,28,19,0,222,32,224,32,222,0,19,27,19],[19,28,19,214,19,19,19,19,19,214,19,27,19],[19,28,19,214,19,7,131,8,19,214,19,27,19],[19,19,19,83,19,31,0,31,19,83,19,19,19],[19,88,0,0,0,0,0,0,0,0,0,87,19],[19,19,19,19,19,19,19,19,19,19,19,19,19]],firstArriveEvents:[],nonFirstArriveEvents:{"6,9":[{type:"openShop",id:"moneyShop2"}]},switchFloorEvent:{"11,11":{floorId:12,stairDirection:"downFloor"},"1,11":{floorId:10,stairDirection:"upFloor"}},postBattleEvent:{},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},y={floorId:12,title:"main_12",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"ground",map:[[20,20,20,20,20,20,20,20,20,20,20,20,20],[20,122,28,20,0,226,227,226,0,20,32,48,20],[20,27,0,20,0,20,81,20,0,20,0,32,20],[20,0,0,20,0,20,227,20,0,20,0,0,20],[20,0,224,20,0,20,21,20,0,20,228,0,20],[20,224,225,20,0,20,21,20,0,20,247,228,20],[20,20,82,20,0,20,31,20,0,20,82,20,20],[20,0,0,0,0,20,31,20,0,0,0,0,20],[20,20,20,20,0,20,20,20,0,20,20,20,20],[20,28,224,81,222,222,223,222,222,81,224,27,20],[20,20,20,20,20,20,82,20,20,20,20,20,20],[20,87,0,0,0,0,0,0,0,0,0,88,20],[20,20,20,20,20,20,20,20,20,20,20,20,20]],firstArriveEvents:[],nonFirstArriveEvents:{"1,1":[{type:"choices",text:"\t[神秘老人,woman]你有多余的钥匙需要出售吗？",choices:[{text:"黄钥匙（7金币）",action:[{type:"if",condition:"item:yellowKey>0",true:[{type:"setValue",name:"item:yellowKey",value:"item:yellowKey-1"},{type:"setValue",name:"status:money",value:"status:money+7"}],false:[]}]},{text:"蓝钥匙（35金币）",action:[{type:"if",condition:"item:blueKey>0",true:[{type:"setValue",name:"item:blueKey",value:"item:blueKey-1"},{type:"setValue",name:"status:money",value:"status:money+35"}],false:[]}]},{text:"红钥匙（70金币）",action:[{type:"if",condition:"item:redKey>0",true:[{type:"setValue",name:"item:redKey",value:"item:redKey-1"},{type:"setValue",name:"status:money",value:"status:money+70"}],false:[]}]},{text:"绿钥匙（110金币）",action:[{type:"if",condition:"item:greenKey>0",true:[{type:"setValue",name:"item:greenKey",value:"item:greenKey-1"},{type:"setValue",name:"status:money",value:"status:money+110"}],false:[]}]},{text:"离开",action:[{type:"exit"}]}]},{type:"revisit"}]},switchFloorEvent:{"1,11":{floorId:13,stairDirection:"downFloor"},"11,11":{floorId:11,stairDirection:"upFloor"}},postBattleEvent:{},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},v={floorId:13,title:"main_13",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"ground",map:[[69,69,69,69,69,69,69,69,69,69,69,69,69],[69,0,224,0,0,0,0,0,69,0,225,0,69],[69,0,69,69,69,69,69,81,69,0,69,0,69],[69,0,69,0,0,222,0,0,69,0,69,0,69],[69,32,69,83,69,69,69,0,69,0,69,0,69],[69,226,69,0,0,225,69,222,69,27,69,0,69],[69,227,69,0,212,86,69,223,69,27,69,0,69],[69,226,69,225,86,121,69,222,69,27,69,28,69],[69,0,69,69,69,69,69,0,69,0,69,28,69],[69,0,226,0,69,0,0,0,225,0,69,28,69],[69,69,69,0,69,32,69,69,69,69,69,0,69],[69,88,0,0,82,0,87,69,66,212,81,0,69],[69,69,69,69,69,69,69,69,69,69,69,69,69]],firstArriveEvents:[],nonFirstArriveEvents:{"5,7":[{type:"openShop",id:"expShop2"}],"4,7":{trigger:"action",data:[{type:"openDoor",loc:[4,7]}]}},switchFloorEvent:{"6,11":{floorId:14,stairDirection:"downFloor"},"1,11":{floorId:12,stairDirection:"upFloor"}},postBattleEvent:{},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},O={floorId:14,title:"main_14",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"ground",map:[[19,19,19,19,19,19,19,19,19,19,19,19,19],[19,19,0,228,26,164,87,0,0,0,0,19,19],[19,19,0,32,19,19,19,19,19,32,0,19,19],[19,19,0,19,19,19,19,19,19,19,0,19,19],[19,19,0,19,19,19,56,19,19,19,0,19,19],[19,19,0,19,19,19,86,19,19,19,0,19,19],[19,19,0,31,19,19,225,19,19,31,0,19,19],[19,19,0,4,4,19,212,19,4,4,0,19,19],[19,19,0,4,4,19,225,19,4,4,0,19,19],[19,19,0,4,4,19,82,19,4,4,0,19,19],[19,19,222,223,222,82,0,82,222,223,222,19,19],[19,19,19,19,19,19,88,19,19,19,19,19,19],[19,19,19,19,19,19,19,19,19,19,19,19,19]],firstArriveEvents:[],nonFirstArriveEvents:{"6,5":{trigger:"action",data:[{type:"openDoor",loc:[6,5]}]}},switchFloorEvent:{"6,1":{floorId:15,stairDirection:"downFloor"},"6,11":{floorId:13,stairDirection:"upFloor"}},postBattleEvent:{},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},P={floorId:15,title:"main_15",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"ground",map:[[18,18,18,18,18,18,18,18,18,18,18,18,18],[18,0,0,0,0,88,4,87,0,0,0,0,18],[18,0,4,4,4,4,4,4,4,4,4,0,18],[18,0,4,4,18,18,18,18,18,4,4,0,18],[18,0,4,18,18,121,18,122,18,18,4,0,18],[18,0,4,18,18,28,18,28,18,18,4,0,18],[18,0,4,18,18,27,18,27,18,18,4,0,18],[18,0,4,4,18,0,18,0,18,4,4,0,18],[18,0,4,4,18,81,18,81,18,4,4,0,18],[18,0,4,4,4,0,0,0,4,4,4,0,18],[18,0,4,4,4,4,83,4,4,4,4,0,18],[18,0,0,0,0,0,0,0,0,0,0,0,18],[18,18,18,18,18,18,18,18,18,18,18,18,18]],firstArriveEvents:[],nonFirstArriveEvents:{"5,4":[{type:"choices",text:"\t[神秘老人,man]500经验换120攻击，要吗？",choices:[{text:"我要",action:[{type:"if",condition:"status:exp>=500",true:[{type:"setValue",name:"status:exp",value:"status:exp-500"},{type:"setValue",name:"status:attack",value:"status:attack+120"},{type:"hide"}],false:["\t[神秘老人,man]你的经验不足！"]}]},{text:"谢谢，不用",action:[]}]}],"7,4":[{type:"choices",text:"\t[神秘老人,woman]500金币换120防御，要吗？",choices:[{text:"我要",action:[{type:"if",condition:"status:money>=500",true:[{type:"setValue",name:"status:money",value:"status:money-500"},{type:"setValue",name:"status:defense",value:"status:defense+120"},{type:"hide"}],false:["\t[神秘老人,man]你的金币不足！"]}]},{text:"谢谢，不用",action:[]}]}]},switchFloorEvent:{"7,1":{floorId:16,stairDirection:"downFloor"},"5,1":{floorId:14,stairDirection:"upFloor"}},postBattleEvent:{},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},M={floorId:16,title:"main_16",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"ground",map:[[20,20,20,20,20,20,20,20,20,20,20,20,20],[20,4,4,4,4,20,0,88,20,4,4,4,20],[20,4,4,4,4,20,0,20,20,4,4,4,20],[20,4,4,4,4,20,0,20,4,4,4,4,20],[20,4,4,4,4,20,83,20,4,4,4,4,20],[20,4,4,4,20,20,0,20,20,4,4,4,20],[20,4,4,4,20,20,245,20,20,4,4,4,20],[20,4,4,4,20,20,0,20,20,4,4,4,20],[20,4,4,4,20,20,87,20,20,4,4,4,20],[20,4,4,4,4,20,20,20,4,4,4,4,20],[20,4,4,4,4,4,4,4,4,4,4,4,20],[20,4,4,4,4,4,4,4,4,4,4,4,20],[20,20,20,20,20,20,20,20,20,20,20,20,20]],firstArriveEvents:[],nonFirstArriveEvents:{},switchFloorEvent:{"6,8":{floorId:17,stairDirection:"downFloor"},"7,1":{floorId:15,stairDirection:"upFloor"}},postBattleEvent:{"6,6":["\t[redKing]你叫{player}是吗？有点东西嘛","\t[redKing]我能告诉你的我并不是不是END，真正的挑战还在后面呢。"]},postGetItemEvent:{},postOpenDoorEvent:{"6,4":["\t[redKing]区区人类也来挑战我？"]},blockCannotMoveDirections:{}},A={floorId:17,title:"main_17",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"ground",map:[[18,18,18,18,18,18,18,18,18,18,18,18,18],[18,4,228,212,0,0,0,0,0,0,0,228,18],[18,4,212,4,4,4,4,4,4,4,4,0,18],[18,4,0,4,228,0,0,0,0,0,0,228,18],[18,4,0,4,0,4,4,4,4,4,4,4,18],[18,4,0,4,0,4,228,0,0,0,228,4,18],[18,4,0,4,228,0,0,4,4,4,0,4,18],[18,4,0,4,4,4,4,4,228,0,228,4,18],[18,4,212,4,4,4,88,4,0,4,4,4,18],[18,4,228,212,0,216,0,4,228,0,0,228,18],[18,4,4,4,4,4,4,4,4,4,4,0,18],[18,87,0,216,0,0,0,0,0,0,0,228,18],[18,18,18,18,18,18,18,18,18,18,18,18,18]],firstArriveEvents:[],nonFirstArriveEvents:{},switchFloorEvent:{"1,11":{floorId:18,stairDirection:"downFloor"},"6,8":{floorId:16,stairDirection:"upFloor"}},postBattleEvent:{},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},g={floorId:18,title:"main_18",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"ground",map:[[18,18,18,18,18,18,18,18,18,18,18,18,18],[18,4,4,4,4,4,4,4,4,4,4,4,18],[18,4,4,4,4,4,4,4,4,4,4,4,18],[18,4,4,4,4,4,4,4,4,4,4,4,18],[18,4,4,4,4,18,18,18,4,4,4,4,18],[18,4,4,4,18,18,132,18,18,4,4,4,18],[18,4,4,4,18,18,86,18,18,4,4,4,18],[18,4,4,4,18,18,83,18,18,4,4,4,18],[18,4,4,4,4,18,83,18,4,4,4,4,18],[18,4,4,4,4,4,4,4,4,4,4,4,18],[18,4,4,4,4,4,4,4,4,4,4,4,18],[18,88,0,0,0,0,0,0,0,0,0,87,18],[18,18,18,18,18,18,18,18,18,18,18,18,18]],firstArriveEvents:[{type:"hide",loc:[11,11]}],nonFirstArriveEvents:{"6,6":{trigger:"action",data:[{type:"openDoor",loc:[6,6]}]},"6,5":[{type:"if",condition:"flag:princess",true:[],false:["\t[player]\b[down,player]艾达，我来救你了！和我一起走吧","\t[艾达公主,princess]\b[up]我走不了，魔王对我施展了囚心术","\t[player]\b[down,player]刚刚我不是杀了一个红衣魔王吗？","\t[艾达公主,princess]\b[up]那不是END，真正的END还在这座塔内","\t[player]\b[down,player]艾达，我怎么才能解救你？！","\t[艾达公主,princess]\b[up]我不知道，我的头好疼！","\t[？？？]你想救她就上来吧，我会慢慢折磨你！",{type:"setValue",name:"flag:princess",value:"true"},{type:"show",loc:[11,11]}]},"\t[公主,princess]\b[up] 我想在这休息下，{player}，我在这等你"]},switchFloorEvent:{"1,11":{floorId:17,stairDirection:"upFloor"},"11,11":{floorId:19,stairDirection:"downFloor"}},postBattleEvent:{},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},h={floorId:19,title:"main_19",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"ground",map:[[18,18,18,18,18,18,18,18,18,18,18,18,18],[18,0,0,0,0,0,0,0,0,0,0,0,18],[18,0,4,0,4,4,4,4,4,0,4,0,18],[18,0,4,0,4,4,4,4,4,0,4,0,18],[18,0,4,0,4,4,87,4,4,0,4,0,18],[18,0,4,0,4,4,0,4,4,0,4,0,18],[18,0,4,275,4,4,0,4,4,275,4,0,18],[18,0,4,86,4,4,208,4,4,86,4,0,18],[18,0,4,43,4,4,0,4,4,44,4,0,18],[18,0,4,4,4,4,0,4,4,4,4,0,18],[18,0,4,4,4,4,0,4,4,4,4,0,18],[18,0,0,0,0,0,0,0,0,0,0,88,18],[18,18,18,18,18,18,18,18,18,18,18,18,18]],firstArriveEvents:[],nonFirstArriveEvents:{},switchFloorEvent:{"6,4":{floorId:20,stairDirection:"downFloor"},"11,11":{floorId:18,stairDirection:"upFloor"}},postBattleEvent:{"3,6":[{type:"openDoor",loc:[3,7]}],"9,6":[{type:"openDoor",loc:[9,7]}],"6,7":["\t[vampire]你以为这样就赢了我？END魔王不会在乎你这种小喽喽的","\t[vampire]对付你，不需要他出手！我本体在21楼等着你的到来！"]},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},f={floorId:20,title:"main_20",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"ground",map:[[18,18,18,18,18,18,18,18,18,18,18,18,18],[18,216,27,246,31,212,23,212,31,246,27,216,18],[18,32,4,21,4,22,4,22,4,21,4,32,18],[18,4,28,246,0,228,0,228,0,246,28,4,18],[18,31,4,21,4,0,88,0,4,21,4,31,18],[18,212,22,228,0,0,0,0,0,228,22,212,18],[18,23,4,0,4,0,4,0,4,0,4,23,18],[18,212,22,228,0,0,0,0,0,228,22,212,18],[18,31,4,21,4,0,87,0,4,21,4,31,18],[18,4,28,246,0,228,0,228,0,246,28,4,18],[18,32,4,21,4,22,4,22,4,21,4,32,18],[18,216,27,246,31,212,23,212,31,246,27,216,18],[18,18,18,18,18,18,18,18,18,18,18,18,18]],firstArriveEvents:[],nonFirstArriveEvents:{},switchFloorEvent:{"6,4":{floorId:19,stairDirection:"upFloor"},"6,8":{floorId:21,stairDirection:"downFloor"}},postBattleEvent:{},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},m={floorId:21,title:"main_21",transporterEnabled:!1,quickShopEnabled:!1,defaultGround:"ground",map:[[18,18,18,18,18,18,18,18,18,18,18,18,18],[18,4,4,4,4,4,87,4,4,4,4,4,18],[18,4,4,0,0,4,268,4,0,0,0,4,18],[18,4,0,0,4,4,247,4,4,0,0,4,18],[18,4,0,0,0,4,247,4,0,0,0,4,18],[18,4,4,0,0,0,0,0,0,0,4,4,18],[18,4,4,0,0,0,0,0,0,0,4,4,18],[18,4,4,4,0,0,4,0,0,4,4,4,18],[18,4,4,4,4,86,88,86,4,4,4,4,18],[18,4,4,4,4,4,4,4,4,4,4,4,18],[18,4,4,4,4,4,4,4,4,4,4,4,18],[18,4,4,4,4,4,4,4,4,4,4,4,18],[18,18,18,18,18,18,18,18,18,18,18,18,18]],firstArriveEvents:[],nonFirstArriveEvents:{"6,8":{enable:!1,data:[{type:"switchFloor",loc:[6,6],floorId:21}]}},switchFloorEvent:{"6,1":{floorId:22,stairDirection:"downFloor"},"6,8":{floorId:20,stairDirection:"upFloor"}},postBattleEvent:{"6,2":[{type:"openDoor",loc:[5,8]},{type:"openDoor",loc:[7,8]},{type:"hide",loc:[6,5],floorId:18}]},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},I={floorId:22,title:"main_22",transporterEnabled:!0,quickShopEnabled:!0,defaultGround:"ground",map:[[18,18,18,18,18,18,18,18,18,18,18,18,18],[18,4,4,4,4,4,88,4,4,4,4,4,18],[18,4,4,4,4,4,0,4,4,4,4,4,18],[18,4,4,4,4,149,0,0,4,4,4,4,18],[18,86,86,86,4,4,83,4,4,86,86,86,18],[18,27,27,86,4,4,53,4,4,86,28,28,18],[18,87,27,228,83,53,0,53,83,228,28,87,18],[18,27,27,86,4,4,53,4,4,86,28,28,18],[18,86,86,86,4,4,83,4,4,86,86,86,18],[18,4,4,4,86,86,228,86,86,4,4,4,18],[18,4,4,4,86,32,32,32,86,4,4,4,18],[18,4,4,4,86,32,87,32,86,4,4,4,18],[18,18,18,18,18,18,18,18,18,18,18,18,18]],firstArriveEvents:[],nonFirstArriveEvents:{"5,3":[{type:"if",condition:"item:wand1>0 && item:wand2>0",true:["\t[蕾娜,leina]\b[down]你已经找齐了魔杖，我可以帮你封印END的大部分力量",{type:"animate",name:"yongchang"},{type:"setBlock",loc:[5,2],number:133,floorId:"MT24"},{type:"setBlock",loc:[6,2],number:134,floorId:"MT24"},{type:"setBlock",loc:[7,2],number:135,floorId:"MT24"},{type:"setBlock",loc:[5,3],number:136,floorId:"MT24"},{type:"setBlock",loc:[6,3],number:137,floorId:"MT24"},{type:"setBlock",loc:[7,3],number:138,floorId:"MT24"},{type:"setBlock",loc:[5,4],number:139,floorId:"MT24"},{type:"setBlock",loc:[7,4],number:140,floorId:"MT24"},{type:"setBlock",loc:[6,4],number:258,floorId:"MT24"},"\t[蕾娜,leina]\b[down]看你了！加油！",{type:"hide",time:500}],false:["\t[蕾娜,leina]\b[down]我感应到下一层有END的气息，去收集剩下两根魔杖，我就能帮你封印END的部分力量！"]}]},switchFloorEvent:{"6,1":{floorId:21,stairDirection:"downFloor"},"1,6":{floorId:23,loc:[11,6]},"11,6":{floorId:24,loc:[1,6]},"6,11":{floorId:25,loc:[6,1]}},postBattleEvent:{},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},C={floorId:23,title:"main_22L",transporterEnabled:!1,quickShopEnabled:!1,defaultGround:"ground",map:[[18,18,18,18,18,18,18,18,18,18,18,18,18],[18,228,0,27,27,27,0,0,0,4,0,32,18],[18,0,4,4,4,4,4,4,0,82,0,4,18],[18,27,4,4,247,228,228,228,0,4,0,4,18],[18,27,4,4,50,4,4,4,4,4,0,4,18],[18,0,247,4,4,4,4,4,4,53,0,4,18],[18,4,83,269,86,67,4,4,53,82,0,88,18],[18,0,247,4,4,4,4,4,4,53,0,4,18],[18,27,4,4,50,4,4,4,4,4,0,4,18],[18,27,4,4,247,228,228,228,0,4,0,4,18],[18,0,4,4,4,4,4,4,0,82,0,4,18],[18,228,0,27,27,27,0,0,0,4,0,32,18],[18,18,18,18,18,18,18,18,18,18,18,18,18]],firstArriveEvents:[],nonFirstArriveEvents:{},switchFloorEvent:{"11,6":{floorId:22,loc:[6,6]}},postBattleEvent:{"3,6":[{type:"openDoor",loc:[4,6]}]},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},R={floorId:24,title:"main_22R",transporterEnabled:!1,quickShopEnabled:!1,defaultGround:"ground",map:[[18,18,18,18,18,18,18,18,18,18,18,18,18],[18,32,0,4,0,0,0,28,28,28,0,228,18],[18,4,0,82,0,4,4,4,4,4,4,0,18],[18,4,0,4,0,228,228,228,247,4,4,28,18],[18,4,0,4,4,4,4,4,50,4,4,28,18],[18,4,0,53,4,4,4,4,4,4,247,0,18],[18,88,0,82,53,4,4,68,86,269,83,4,18],[18,4,0,53,4,4,4,4,4,4,247,0,18],[18,4,0,4,4,4,4,4,50,4,4,28,18],[18,4,0,4,0,228,228,228,247,4,4,28,18],[18,4,0,82,0,4,4,4,4,4,4,0,18],[18,32,0,4,0,0,0,28,28,28,0,228,18],[18,18,18,18,18,18,18,18,18,18,18,18,18]],firstArriveEvents:[],nonFirstArriveEvents:{},switchFloorEvent:{"1,6":{floorId:22,loc:[6,6]}},postBattleEvent:{"9,6":[{type:"openDoor",loc:[8,6]}]},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},T={floorId:25,title:"main_22D",transporterEnabled:!1,quickShopEnabled:!1,defaultGround:"ground",map:[[18,18,18,18,18,18,18,18,18,18,18,18,18],[18,32,4,4,4,4,88,4,4,4,4,32,18],[18,0,0,0,0,0,0,0,0,0,0,0,18],[18,4,82,4,4,26,82,26,4,4,82,4,18],[18,0,0,0,4,4,26,4,4,0,0,0,18],[18,0,4,228,4,4,4,4,4,228,4,0,18],[18,0,4,228,4,4,4,4,4,228,4,0,18],[18,31,4,228,4,4,85,4,4,228,4,31,18],[18,31,4,247,66,4,86,4,66,247,4,31,18],[18,31,4,4,4,4,269,4,4,4,4,31,18],[18,0,4,4,4,247,83,247,4,4,4,0,18],[18,228,0,32,32,0,4,0,32,32,0,228,18],[18,18,18,18,18,18,18,18,18,18,18,18,18]],firstArriveEvents:[],nonFirstArriveEvents:{},switchFloorEvent:{"6,1":{floorId:22,loc:[6,6]},"6,7":{floorId:26,loc:[6,11]}},postBattleEvent:{"6,9":[{type:"openDoor",loc:[6,8]}]},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},L={floorId:26,title:"boss_1",transporterEnabled:!1,quickShopEnabled:!1,defaultGround:"ground",map:[[18,18,18,18,18,18,18,18,18,18,18,18,18],[18,5,5,5,86,86,86,86,86,5,5,5,18],[18,5,5,5,86,141,142,143,86,5,5,5,18],[18,5,5,5,86,144,145,146,86,5,5,5,18],[18,5,5,5,86,147,257,148,86,5,5,5,18],[18,5,5,5,86,86,0,86,86,5,5,5,18],[18,5,32,32,32,32,132,32,32,32,32,5,18],[18,5,5,5,5,5,228,5,5,5,5,5,18],[18,5,5,5,50,228,269,228,50,5,5,5,18],[18,5,5,5,5,5,228,5,5,5,5,5,18],[18,5,5,5,5,32,247,32,5,5,5,5,18],[18,5,5,5,5,5,0,5,5,5,5,5,18],[18,18,18,18,18,18,18,18,18,18,18,18,18]],firstArriveEvents:[{type:"hide",loc:[6,2]},{type:"hide",loc:[6,3]},{type:"hide",loc:[6,4]},{type:"hide",loc:[5,2]},{type:"hide",loc:[5,3]},{type:"hide",loc:[5,4]},{type:"hide",loc:[7,2]},{type:"hide",loc:[7,3]},{type:"hide",loc:[7,4]},"\t[player]\b[down,player]艾达！你怎么在这？！","\t[艾达公主,princess]\b[up]{player}，我也不知道发生了什么！我的头痛的要炸开了！","\t[player]\b[down,player]我就是来救你的，无论发生什么，我都不会放弃你的。","\t[艾达公主,princess]\b[up]{player}你快走，我能感觉到好像END要出来了！",{type:"hide",loc:[6,6]},{type:"show",loc:[6,2]},{type:"show",loc:[6,3]},{type:"show",loc:[6,4]},{type:"show",loc:[5,2]},{type:"show",loc:[5,3]},{type:"show",loc:[5,4]},{type:"show",loc:[7,2]},{type:"show",loc:[7,3]},{type:"show",loc:[7,4]},"\t[END,magicDragon]\b[up]{player}，你终于来了！","\t[player]\b[down,player]什么？！","\t[player]\b[down,player]艾达公主去哪了！","\t[END,magicDragon]\b[up]自我介绍一下，我叫END！","\t[player]\b[down,player]（END魔王居然是一条龙吗）","\t[END,magicDragon]\b[up]同时也是多丽丝·妮娅·艾达（Doris Nia Eda吗）的双生一体","\t[player]\b[down,player]END...DNE?!双生体","\t[END,magicDragon]\b[up]直到前些日子为止，我的意识还在沉睡。","\t[END,magicDragon]\b[up]艾达公主是个难缠的人，她一直压抑着我的灵魂力量，直到她某次误入这座塔的附近，我的灵魂力量才完全觉醒。","\t[END,magicDragon]\b[up]我马上就可以获得所有主导权了！","\t[player]\b[down,player]原来如此，是这家伙影响了艾达","\t[player]\b[down,player]我会打倒你，救公主出去的！","\t[END,magicDragon]\b[up]哈哈哈！凭你你做得到吗？"],nonFirstArriveEvents:{},switchFloorEvent:{},postBattleEvent:{"6,4":[{type:"show",loc:[6,6]},"\t[艾达公主,princess]\b[up]{player}，谢谢你！你帮我干掉了END！我现在感觉好多了！","\t[player]\b[down,player]太好了，你没事就好。","\t[player]\b[down,player]这一路上遇到了好多神奇的人，是他们帮助了我，我才能打败END救下你。","\t[艾达公主,princess]\b[up]谢谢你，我的挚友，{player}。","\t[艾达公主,princess]\b[up]最后，可尼小朋友，10.3生日快乐！","\t[艾达公主,princess]\b[up]祝你每天开开心心~！",{type:"setValue",name:"status:hp",value:"status:attack+status:defense"},{type:"win"}]},postGetItemEvent:{},postOpenDoorEvent:{},blockCannotMoveDirections:{}},B={};function K(){B={},B={0:(0,o.o8)(n),1:(0,o.o8)(a),2:(0,o.o8)(i),3:(0,o.o8)(r),4:(0,o.o8)(s),5:(0,o.o8)(l),6:(0,o.o8)(c),7:(0,o.o8)(u),8:(0,o.o8)(E),9:(0,o.o8)(d),10:(0,o.o8)(D),11:(0,o.o8)(p),12:(0,o.o8)(y),13:(0,o.o8)(v),14:(0,o.o8)(O),15:(0,o.o8)(P),16:(0,o.o8)(M),17:(0,o.o8)(A),18:(0,o.o8)(g),19:(0,o.o8)(h),20:(0,o.o8)(f),21:(0,o.o8)(m),22:(0,o.o8)(I),23:(0,o.o8)(C),24:(0,o.o8)(R),25:(0,o.o8)(T),26:(0,o.o8)(L)},console.log("floors inited",B)}var b=function(){function e(){if(e.instance)throw new Error("Cannot initialize FloorDB more than once")}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.getFloorById=function(e){if(e in B)return B[e]},e.prototype.getAllFloorIds=function(){return Object.keys(B).map(Number)},e.prototype.getAllFloors=function(){return B},e}(),U={1:{cls:"terrains",id:"yellowWall"},2:{cls:"terrains",id:"whiteWall"},3:{cls:"terrains",id:"blueWall"},4:{cls:"animates",id:"star",noPass:!0},5:{cls:"animates",id:"lava",noPass:!0},6:{cls:"animates",id:"ice"},7:{cls:"terrains",id:"blueShop-left"},8:{cls:"terrains",id:"blueShop-right"},9:{cls:"terrains",id:"pinkShop-left"},10:{cls:"terrains",id:"pinkShop-right"},11:{cls:"animates",id:"lavaNet",noPass:!1,trigger:"passNet"},12:{cls:"animates",id:"poisonNet",noPass:!1,trigger:"passNet"},13:{cls:"animates",id:"weakNet",noPass:!1,trigger:"passNet"},14:{cls:"animates",id:"curseNet",noPass:!1,trigger:"passNet"},15:{cls:"animates",id:"water",noPass:!0},16:{cls:"terrains",id:"grass"},17:{cls:"terrains",id:"grass2"},18:{cls:"brownwall",id:"brownwall"},19:{cls:"redwall",id:"redwall"},20:{cls:"pinkwall",id:"pinkwall"},21:{cls:"items",id:"yellowKey"},22:{cls:"items",id:"blueKey"},23:{cls:"items",id:"redKey"},24:{cls:"items",id:"greenKey"},25:{cls:"items",id:"steelKey"},26:{cls:"items",id:"bigKey"},27:{cls:"items",id:"redJewel"},28:{cls:"items",id:"blueJewel"},29:{cls:"items",id:"greenJewel"},30:{cls:"items",id:"yellowJewel"},31:{cls:"items",id:"redPotion"},32:{cls:"items",id:"bluePotion"},33:{cls:"items",id:"greenPotion"},34:{cls:"items",id:"yellowPotion"},35:{cls:"items",id:"sword1"},36:{cls:"items",id:"shield1"},37:{cls:"items",id:"sword2"},38:{cls:"items",id:"shield2"},39:{cls:"items",id:"sword3"},40:{cls:"items",id:"shield3"},41:{cls:"items",id:"sword4"},42:{cls:"items",id:"shield4"},43:{cls:"items",id:"sword5"},44:{cls:"items",id:"shield5"},45:{cls:"items",id:"book"},46:{cls:"items",id:"fly"},47:{cls:"items",id:"pickaxe"},48:{cls:"items",id:"icePickaxe"},49:{cls:"items",id:"bomb"},50:{cls:"items",id:"centerFly"},51:{cls:"items",id:"upFly"},52:{cls:"items",id:"downFly"},53:{cls:"items",id:"coin"},54:{cls:"items",id:"snow"},55:{cls:"items",id:"cross"},56:{cls:"items",id:"superPotion"},57:{cls:"items",id:"earthquake"},58:{cls:"items",id:"poisonWine"},59:{cls:"items",id:"weakWine"},60:{cls:"items",id:"curseWine"},61:{cls:"items",id:"superWine"},62:{cls:"items",id:"knife"},63:{cls:"items",id:"moneyPocket"},64:{cls:"items",id:"shoes"},65:{cls:"items",id:"hammer"},66:{cls:"items",id:"bigFly"},67:{cls:"items",id:"wand1"},68:{cls:"items",id:"wand2"},69:{cls:"greenwall",id:"greenwall"},81:{cls:"terrains",id:"yellowDoor",trigger:"openDoor"},82:{cls:"terrains",id:"blueDoor",trigger:"openDoor"},83:{cls:"terrains",id:"redDoor",trigger:"openDoor"},84:{cls:"terrains",id:"greenDoor",trigger:"openDoor"},85:{cls:"terrains",id:"specialDoor",trigger:"openDoor"},86:{cls:"terrains",id:"steelDoor",trigger:"openDoor"},87:{cls:"terrains",id:"upFloor",noPass:!1},88:{cls:"terrains",id:"downFloor",noPass:!1},89:{cls:"animates",id:"portal",noPass:!1},90:{cls:"animates",id:"starPortal",noPass:!1},91:{cls:"animates",id:"upPortal",noPass:!1},92:{cls:"animates",id:"leftPortal",noPass:!1},93:{cls:"animates",id:"downPortal",noPass:!1},94:{cls:"animates",id:"rightPortal",noPass:!1},121:{cls:"npcs",id:"man"},122:{cls:"npcs",id:"woman"},123:{cls:"npcs",id:"thief"},124:{cls:"npcs",id:"fairy"},125:{cls:"npcs",id:"magician"},126:{cls:"npcs",id:"womanMagician"},127:{cls:"npcs",id:"oldMan"},128:{cls:"npcs",id:"child"},129:{cls:"npcs",id:"wood"},130:{cls:"npcs",id:"pinkShop"},131:{cls:"npcs",id:"blueShop"},132:{cls:"npcs",id:"princess"},133:{cls:"npcs",id:"wlt"},134:{cls:"npcs",id:"wt"},135:{cls:"npcs",id:"wrt"},136:{cls:"npcs",id:"wl"},137:{cls:"npcs",id:"wc"},138:{cls:"npcs",id:"wr"},139:{cls:"npcs",id:"wlb"},140:{cls:"npcs",id:"wrb"},141:{cls:"npcs",id:"dlt"},142:{cls:"npcs",id:"dt"},143:{cls:"npcs",id:"drt"},144:{cls:"npcs",id:"dl"},145:{cls:"npcs",id:"dc"},146:{cls:"npcs",id:"dr"},147:{cls:"npcs",id:"dlb"},148:{cls:"npcs",id:"drb"},149:{cls:"leina",id:"leina"},150:{cls:"jay",id:"jay"},161:{cls:"terrains",id:"arrowUp",noPass:!1},162:{cls:"terrains",id:"arrowDown",noPass:!1},163:{cls:"terrains",id:"arrowLeft",noPass:!1},164:{cls:"terrains",id:"arrowRight",noPass:!1},165:{cls:"terrains",id:"light",trigger:"changeLight",noPass:!1},166:{cls:"terrains",id:"darkLight",noPass:!0},167:{cls:"terrains",id:"ski",trigger:"ski",noPass:!1},168:{cls:"terrains",id:"flower",noPass:!1},169:{cls:"terrains",id:"box",trigger:"pushBox",noPass:!0},170:{cls:"terrains",id:"boxed",trigger:"pushBox",noPass:!0},201:{cls:"enemys",id:"greenSlime"},202:{cls:"enemys",id:"redSlime"},203:{cls:"enemys",id:"blackSlime"},204:{cls:"enemys",id:"slimelord"},205:{cls:"enemys",id:"bat"},206:{cls:"enemys",id:"bigBat"},207:{cls:"enemys",id:"redBat"},208:{cls:"enemys",id:"vampire"},268:{cls:"enemys",id:"vampire2"},269:{cls:"enemys",id:"vampire3"},209:{cls:"enemys",id:"skeleton"},210:{cls:"enemys",id:"skeletonSoilder"},211:{cls:"enemys",id:"skeletonCaptain"},212:{cls:"enemys",id:"ghostSkeleton"},213:{cls:"enemys",id:"zombie"},214:{cls:"enemys",id:"zombieKnight"},215:{cls:"enemys",id:"rock"},216:{cls:"enemys",id:"slimeMan"},217:{cls:"enemys",id:"bluePriest"},218:{cls:"enemys",id:"redPriest"},219:{cls:"enemys",id:"brownWizard"},220:{cls:"enemys",id:"redWizard"},221:{cls:"enemys",id:"yellowGuard"},222:{cls:"enemys",id:"blueGuard"},223:{cls:"enemys",id:"redGuard"},224:{cls:"enemys",id:"swordsman"},225:{cls:"enemys",id:"soldier"},226:{cls:"enemys",id:"yellowKnight"},227:{cls:"enemys",id:"redKnight"},228:{cls:"enemys",id:"darkKnight"},229:{cls:"enemys",id:"blackKing"},230:{cls:"enemys",id:"yellowKing"},231:{cls:"enemys",id:"greenKing"},232:{cls:"enemys",id:"blueKnight"},233:{cls:"enemys",id:"goldSlime"},234:{cls:"enemys",id:"poisonSkeleton"},235:{cls:"enemys",id:"poisonBat"},236:{cls:"enemys",id:"steelRock"},237:{cls:"enemys",id:"skeletonPriest"},238:{cls:"enemys",id:"skeletonKing"},239:{cls:"enemys",id:"skeletonWizard"},240:{cls:"enemys",id:"redSkeletonCaption"},241:{cls:"enemys",id:"badplayer"},242:{cls:"enemys",id:"demon"},243:{cls:"enemys",id:"demonPriest"},244:{cls:"enemys",id:"goldHornSlime"},245:{cls:"enemys",id:"redKing"},275:{cls:"enemys",id:"redKing2"},246:{cls:"enemys",id:"whiteKing"},247:{cls:"enemys",id:"blackMagician"},248:{cls:"enemys",id:"silverSlime"},249:{cls:"enemys",id:"swordEmperor"},250:{cls:"enemys",id:"whiteHornSlime"},251:{cls:"enemys",id:"badPrincess"},252:{cls:"enemys",id:"badFairy"},253:{cls:"enemys",id:"grayPriest"},254:{cls:"enemys",id:"redSwordsman"},255:{cls:"enemys",id:"whiteGhost"},256:{cls:"enemys",id:"poisonZombie"},257:{cls:"enemys",id:"magicDragon"},258:{cls:"enemys",id:"octopus"},259:{cls:"enemys",id:"darkFairy"},260:{cls:"enemys",id:"greenKnight"}};function W(e,t,_){var n=null;(_=String(_)).length>2&&(_.endsWith(":f")?(_=_.slice(0,-2),n=!1):_.endsWith(":t")&&(_=_.slice(0,-2),n=!0));var a=parseInt(_),i={x:e,y:t,id:a};return(0,o.DQ)(n)&&(i.enable=n),a in U&&(i.event=U[a]),i}function k(e){e.event&&("enemys"===e.event.cls&&void 0===e.event.trigger&&(e.event.trigger="battle"),"items"===e.event.cls&&void 0===e.event.trigger&&(e.event.trigger="getItem"),void 0===e.event.noPass&&(["enemys","terrains","npcs","leina","jay"].includes(e.event.cls)||e.event.cls.endsWith("wall"))&&(e.event.noPass=!0),void 0===e.event.animate&&(["enemys","npcs","leina","jay"].includes(e.event.cls)&&(e.event.animate=2),"animates"===e.event.cls&&(e.event.animate=4)))}function x(e,t,_,n){if(console.log("add event for",JSON.stringify(e),t,_,JSON.stringify(n)),(0,o.DQ)(n)){(0,o.DQ)(e.event)||(console.log("no event for block, set terrains"),e.event={cls:"terrains",id:"none",noPass:!1});var a=(0,o.o8)(n);for(var i in"string"==typeof n?a={data:[n]}:Array.isArray(n)&&(a={data:n}),(0,o.DQ)(a.data)||(a.data=[]),a.noPass&&(e.event.noPass=a.noPass),!(0,o.DQ)(e.enable)&&a.enable&&(e.enable=a.enable),(0,o.DQ)(e.event.trigger)?(0,o.DQ)(a.trigger)&&"checkBlock"!=a.trigger&&(e.event.trigger=a.trigger):e.event.trigger=a.trigger?a.trigger:"action",a)if("enable"!==i&&"trigger"!==i){console.log("add event key: ",i,e.event[i],a[i]);var r=(0,o.o8)(a[i]);e.event[i]=r}e.event=(0,o.o8)(e.event)}else console.log("no event input")}function w(e,t,_,n,a){(0,o.DQ)(a)&&(console.log("add switch floor for",e,t,_,n,a),x(t,_,n,{trigger:"switchFloor",data:a}))}var F=b.getInstance();function S(e,t){var _=F.getFloorById(e);console.log("load current floor: ",e,t,_);var n={floorId:_.floorId,title:_.title,transporterEnabled:_.transporterEnabled,blocks:[]};(0,o.DQ)(t)||(t=_.map);for(var a=0;a<13;a++)for(var i=0;i<13;i++){var r=W(i,a,t[a][i]);k(r),x(r,i,a,_.nonFirstArriveEvents[i+","+a]),w(e,r,i,a,_.switchFloorEvent[i+","+a]),r.event&&n.blocks.push(r)}return n}const Q=F},883:(e,t,_)=>{_.d(t,{A:()=>ue});const o={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){console&&console[e]&&console[e].apply(console,t)}};class n{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||o,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),_=0;_<e;_++)t[_]=arguments[_];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),_=0;_<e;_++)t[_]=arguments[_];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),_=0;_<e;_++)t[_]=arguments[_];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),_=0;_<e;_++)t[_]=arguments[_];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,_,o){return o&&!this.debug?null:("string"==typeof e[0]&&(e[0]=`${_}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new n(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new n(this.logger,e)}}var a=new n;class i{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach((e=>{this.observers[e]||(this.observers[e]=new Map);const _=this.observers[e].get(t)||0;this.observers[e].set(t,_+1)})),this}off(e,t){this.observers[e]&&(t?this.observers[e].delete(t):delete this.observers[e])}emit(e){for(var t=arguments.length,_=new Array(t>1?t-1:0),o=1;o<t;o++)_[o-1]=arguments[o];if(this.observers[e]){Array.from(this.observers[e].entries()).forEach((e=>{let[t,o]=e;for(let e=0;e<o;e++)t(..._)}))}if(this.observers["*"]){Array.from(this.observers["*"].entries()).forEach((t=>{let[o,n]=t;for(let t=0;t<n;t++)o.apply(o,[e,..._])}))}}}const r=()=>{let e,t;const _=new Promise(((_,o)=>{e=_,t=o}));return _.resolve=e,_.reject=t,_},s=e=>null==e?"":""+e,l=/###/g,c=e=>e&&e.indexOf("###")>-1?e.replace(l,"."):e,u=e=>!e||"string"==typeof e,E=(e,t,_)=>{const o="string"!=typeof t?t:t.split(".");let n=0;for(;n<o.length-1;){if(u(e))return{};const t=c(o[n]);!e[t]&&_&&(e[t]=new _),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++n}return u(e)?{}:{obj:e,k:c(o[n])}},d=(e,t,_)=>{const{obj:o,k:n}=E(e,t,Object);if(void 0!==o||1===t.length)return void(o[n]=_);let a=t[t.length-1],i=t.slice(0,t.length-1),r=E(e,i,Object);for(;void 0===r.obj&&i.length;)a=`${i[i.length-1]}.${a}`,i=i.slice(0,i.length-1),r=E(e,i,Object),r&&r.obj&&void 0!==r.obj[`${r.k}.${a}`]&&(r.obj=void 0);r.obj[`${r.k}.${a}`]=_},D=(e,t)=>{const{obj:_,k:o}=E(e,t);if(_)return _[o]},p=(e,t,_)=>{for(const o in t)"__proto__"!==o&&"constructor"!==o&&(o in e?"string"==typeof e[o]||e[o]instanceof String||"string"==typeof t[o]||t[o]instanceof String?_&&(e[o]=t[o]):p(e[o],t[o],_):e[o]=t[o]);return e},y=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var v={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const O=e=>"string"==typeof e?e.replace(/[&<>"'\/]/g,(e=>v[e])):e;const P=[" ",",","?","!",";"],M=new class{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(void 0!==t)return t;const _=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,_),this.regExpQueue.push(e),_}}(20),A=function(e,t){let _=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(!e)return;if(e[t])return e[t];const o=t.split(_);let n=e;for(let e=0;e<o.length;){if(!n||"object"!=typeof n)return;let t,a="";for(let i=e;i<o.length;++i)if(i!==e&&(a+=_),a+=o[i],t=n[a],void 0!==t){if(["string","number","boolean"].indexOf(typeof t)>-1&&i<o.length-1)continue;e+=i-e+1;break}n=t}return n},g=e=>e&&e.indexOf("_")>0?e.replace("_","-"):e;class h extends i{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,_){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const n=void 0!==o.keySeparator?o.keySeparator:this.options.keySeparator,a=void 0!==o.ignoreJSONStructure?o.ignoreJSONStructure:this.options.ignoreJSONStructure;let i;e.indexOf(".")>-1?i=e.split("."):(i=[e,t],_&&(Array.isArray(_)?i.push(..._):"string"==typeof _&&n?i.push(..._.split(n)):i.push(_)));const r=D(this.data,i);return!r&&!t&&!_&&e.indexOf(".")>-1&&(e=i[0],t=i[1],_=i.slice(2).join(".")),r||!a||"string"!=typeof _?r:A(this.data&&this.data[e]&&this.data[e][t],_,n)}addResource(e,t,_,o){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1};const a=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator;let i=[e,t];_&&(i=i.concat(a?_.split(a):_)),e.indexOf(".")>-1&&(i=e.split("."),o=t,t=i[1]),this.addNamespaces(t),d(this.data,i,o),n.silent||this.emit("added",e,t,_,o)}addResources(e,t,_){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(const o in _)("string"==typeof _[o]||Array.isArray(_[o]))&&this.addResource(e,t,o,_[o],{silent:!0});o.silent||this.emit("added",e,t,_)}addResourceBundle(e,t,_,o,n){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1,skipCopy:!1},i=[e,t];e.indexOf(".")>-1&&(i=e.split("."),o=_,_=t,t=i[1]),this.addNamespaces(t);let r=D(this.data,i)||{};a.skipCopy||(_=JSON.parse(JSON.stringify(_))),o?p(r,_,n):r={...r,..._},d(this.data,i,r),a.silent||this.emit("added",e,t,_)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?{...this.getResource(e,t)}:this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find((e=>t[e]&&Object.keys(t[e]).length>0))}toJSON(){return this.data}}var f={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,_,o,n){return e.forEach((e=>{this.processors[e]&&(t=this.processors[e].process(t,_,o,n))})),t}};const m={};class I extends i{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),((e,t,_)=>{e.forEach((e=>{t[e]&&(_[e]=t[e])}))})(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=a.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;const _=this.resolve(e,t);return _&&void 0!==_.res}extractFromKey(e,t){let _=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===_&&(_=":");const o=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator;let n=t.ns||this.options.defaultNS||[];const a=_&&e.indexOf(_)>-1,i=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||((e,t,_)=>{t=t||"",_=_||"";const o=P.filter((e=>t.indexOf(e)<0&&_.indexOf(e)<0));if(0===o.length)return!0;const n=M.getRegExp(`(${o.map((e=>"?"===e?"\\?":e)).join("|")})`);let a=!n.test(e);if(!a){const t=e.indexOf(_);t>0&&!n.test(e.substring(0,t))&&(a=!0)}return a})(e,_,o));if(a&&!i){const t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:n};const a=e.split(_);(_!==o||_===o&&this.options.ns.indexOf(a[0])>-1)&&(n=a.shift()),e=a.join(o)}return"string"==typeof n&&(n=[n]),{key:e,namespaces:n}}translate(e,t,_){if("object"!=typeof t&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof t&&(t={...t}),t||(t={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);const o=void 0!==t.returnDetails?t.returnDetails:this.options.returnDetails,n=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,{key:a,namespaces:i}=this.extractFromKey(e[e.length-1],t),r=i[i.length-1],s=t.lng||this.language,l=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(s&&"cimode"===s.toLowerCase()){if(l){const e=t.nsSeparator||this.options.nsSeparator;return o?{res:`${r}${e}${a}`,usedKey:a,exactUsedKey:a,usedLng:s,usedNS:r,usedParams:this.getUsedParamsDetails(t)}:`${r}${e}${a}`}return o?{res:a,usedKey:a,exactUsedKey:a,usedLng:s,usedNS:r,usedParams:this.getUsedParamsDetails(t)}:a}const c=this.resolve(e,t);let u=c&&c.res;const E=c&&c.usedKey||a,d=c&&c.exactUsedKey||a,D=Object.prototype.toString.apply(u),p=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,y=!this.i18nFormat||this.i18nFormat.handleAsObject;if(y&&u&&("string"!=typeof u&&"boolean"!=typeof u&&"number"!=typeof u)&&["[object Number]","[object Function]","[object RegExp]"].indexOf(D)<0&&("string"!=typeof p||!Array.isArray(u))){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(E,u,{...t,ns:i}):`key '${a} (${this.language})' returned an object instead of string.`;return o?(c.res=e,c.usedParams=this.getUsedParamsDetails(t),c):e}if(n){const e=Array.isArray(u),_=e?[]:{},o=e?d:E;for(const e in u)if(Object.prototype.hasOwnProperty.call(u,e)){const a=`${o}${n}${e}`;_[e]=this.translate(a,{...t,joinArrays:!1,ns:i}),_[e]===a&&(_[e]=u[e])}u=_}}else if(y&&"string"==typeof p&&Array.isArray(u))u=u.join(p),u&&(u=this.extendTranslation(u,e,t,_));else{let o=!1,i=!1;const l=void 0!==t.count&&"string"!=typeof t.count,E=I.hasDefaultValue(t),d=l?this.pluralResolver.getSuffix(s,t.count,t):"",D=t.ordinal&&l?this.pluralResolver.getSuffix(s,t.count,{ordinal:!1}):"",p=l&&!t.ordinal&&0===t.count&&this.pluralResolver.shouldUseIntlApi(),y=p&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${d}`]||t[`defaultValue${D}`]||t.defaultValue;!this.isValidLookup(u)&&E&&(o=!0,u=y),this.isValidLookup(u)||(i=!0,u=a);const v=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&i?void 0:u,O=E&&y!==u&&this.options.updateMissing;if(i||o||O){if(this.logger.log(O?"updateKey":"missingKey",s,r,a,O?y:u),n){const e=this.resolve(a,{...t,keySeparator:!1});e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[];const _=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&_&&_[0])for(let t=0;t<_.length;t++)e.push(_[t]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(t.lng||this.language):e.push(t.lng||this.language);const o=(e,_,o)=>{const n=E&&o!==u?o:v;this.options.missingKeyHandler?this.options.missingKeyHandler(e,r,_,n,O,t):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(e,r,_,n,O,t),this.emit("missingKey",e,r,_,u)};this.options.saveMissing&&(this.options.saveMissingPlurals&&l?e.forEach((e=>{const _=this.pluralResolver.getSuffixes(e,t);p&&t[`defaultValue${this.options.pluralSeparator}zero`]&&_.indexOf(`${this.options.pluralSeparator}zero`)<0&&_.push(`${this.options.pluralSeparator}zero`),_.forEach((_=>{o([e],a+_,t[`defaultValue${_}`]||y)}))})):o(e,a,y))}u=this.extendTranslation(u,e,t,c,_),i&&u===a&&this.options.appendNamespaceToMissingKey&&(u=`${r}:${a}`),(i||o)&&this.options.parseMissingKeyHandler&&(u="v1"!==this.options.compatibilityAPI?this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${r}:${a}`:a,o?u:void 0):this.options.parseMissingKeyHandler(u))}return o?(c.res=u,c.usedParams=this.getUsedParamsDetails(t),c):u}extendTranslation(e,t,_,o,n){var a=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,..._},_.lng||this.language||o.usedLng,o.usedNS,o.usedKey,{resolved:o});else if(!_.skipInterpolation){_.interpolation&&this.interpolator.init({..._,interpolation:{...this.options.interpolation,..._.interpolation}});const i="string"==typeof e&&(_&&_.interpolation&&void 0!==_.interpolation.skipOnVariables?_.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let r;if(i){const t=e.match(this.interpolator.nestingRegexp);r=t&&t.length}let s=_.replace&&"string"!=typeof _.replace?_.replace:_;if(this.options.interpolation.defaultVariables&&(s={...this.options.interpolation.defaultVariables,...s}),e=this.interpolator.interpolate(e,s,_.lng||this.language||o.usedLng,_),i){const t=e.match(this.interpolator.nestingRegexp);r<(t&&t.length)&&(_.nest=!1)}!_.lng&&"v1"!==this.options.compatibilityAPI&&o&&o.res&&(_.lng=this.language||o.usedLng),!1!==_.nest&&(e=this.interpolator.nest(e,(function(){for(var e=arguments.length,o=new Array(e),i=0;i<e;i++)o[i]=arguments[i];return n&&n[0]===o[0]&&!_.context?(a.logger.warn(`It seems you are nesting recursively key: ${o[0]} in key: ${t[0]}`),null):a.translate(...o,t)}),_)),_.interpolation&&this.interpolator.reset()}const i=_.postProcess||this.options.postProcess,r="string"==typeof i?[i]:i;return null!=e&&r&&r.length&&!1!==_.applyPostProcessor&&(e=f.handle(r,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...o,usedParams:this.getUsedParamsDetails(_)},..._}:_,this)),e}resolve(e){let t,_,o,n,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=[e]),e.forEach((e=>{if(this.isValidLookup(t))return;const r=this.extractFromKey(e,i),s=r.key;_=s;let l=r.namespaces;this.options.fallbackNS&&(l=l.concat(this.options.fallbackNS));const c=void 0!==i.count&&"string"!=typeof i.count,u=c&&!i.ordinal&&0===i.count&&this.pluralResolver.shouldUseIntlApi(),E=void 0!==i.context&&("string"==typeof i.context||"number"==typeof i.context)&&""!==i.context,d=i.lngs?i.lngs:this.languageUtils.toResolveHierarchy(i.lng||this.language,i.fallbackLng);l.forEach((e=>{this.isValidLookup(t)||(a=e,!m[`${d[0]}-${e}`]&&this.utils&&this.utils.hasLoadedNamespace&&!this.utils.hasLoadedNamespace(a)&&(m[`${d[0]}-${e}`]=!0,this.logger.warn(`key "${_}" for languages "${d.join(", ")}" won't get resolved as namespace "${a}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),d.forEach((_=>{if(this.isValidLookup(t))return;n=_;const a=[s];if(this.i18nFormat&&this.i18nFormat.addLookupKeys)this.i18nFormat.addLookupKeys(a,s,_,e,i);else{let e;c&&(e=this.pluralResolver.getSuffix(_,i.count,i));const t=`${this.options.pluralSeparator}zero`,o=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(c&&(a.push(s+e),i.ordinal&&0===e.indexOf(o)&&a.push(s+e.replace(o,this.options.pluralSeparator)),u&&a.push(s+t)),E){const _=`${s}${this.options.contextSeparator}${i.context}`;a.push(_),c&&(a.push(_+e),i.ordinal&&0===e.indexOf(o)&&a.push(_+e.replace(o,this.options.pluralSeparator)),u&&a.push(_+t))}}let r;for(;r=a.pop();)this.isValidLookup(t)||(o=r,t=this.getResource(_,e,r,i))})))}))})),{res:t,usedKey:_,exactUsedKey:o,usedLng:n,usedNS:a}}isValidLookup(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}getResource(e,t,_){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,_,o):this.resourceStore.getResource(e,t,_,o)}getUsedParamsDetails(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],_=e.replace&&"string"!=typeof e.replace;let o=_?e.replace:e;if(_&&void 0!==e.count&&(o.count=e.count),this.options.interpolation.defaultVariables&&(o={...this.options.interpolation.defaultVariables,...o}),!_){o={...o};for(const e of t)delete o[e]}return o}static hasDefaultValue(e){const t="defaultValue";for(const _ in e)if(Object.prototype.hasOwnProperty.call(e,_)&&t===_.substring(0,12)&&void 0!==e[_])return!0;return!1}}const C=e=>e.charAt(0).toUpperCase()+e.slice(1);class R{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=a.create("languageUtils")}getScriptPartFromCode(e){if(!(e=g(e))||e.indexOf("-")<0)return null;const t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}getLanguagePartFromCode(e){if(!(e=g(e))||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if("string"==typeof e&&e.indexOf("-")>-1){const t=["hans","hant","latn","cyrl","cans","mong","arab"];let _=e.split("-");return this.options.lowerCaseLng?_=_.map((e=>e.toLowerCase())):2===_.length?(_[0]=_[0].toLowerCase(),_[1]=_[1].toUpperCase(),t.indexOf(_[1].toLowerCase())>-1&&(_[1]=C(_[1].toLowerCase()))):3===_.length&&(_[0]=_[0].toLowerCase(),2===_[1].length&&(_[1]=_[1].toUpperCase()),"sgn"!==_[0]&&2===_[2].length&&(_[2]=_[2].toUpperCase()),t.indexOf(_[1].toLowerCase())>-1&&(_[1]=C(_[1].toLowerCase())),t.indexOf(_[2].toLowerCase())>-1&&(_[2]=C(_[2].toLowerCase()))),_.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach((e=>{if(t)return;const _=this.formatLanguageCode(e);this.options.supportedLngs&&!this.isSupportedCode(_)||(t=_)})),!t&&this.options.supportedLngs&&e.forEach((e=>{if(t)return;const _=this.getLanguagePartFromCode(e);if(this.isSupportedCode(_))return t=_;t=this.options.supportedLngs.find((e=>e===_?e:e.indexOf("-")<0&&_.indexOf("-")<0?void 0:e.indexOf("-")>0&&_.indexOf("-")<0&&e.substring(0,e.indexOf("-"))===_||0===e.indexOf(_)&&_.length>1?e:void 0))})),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),"string"==typeof e&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let _=e[t];return _||(_=e[this.getScriptPartFromCode(t)]),_||(_=e[this.formatLanguageCode(t)]),_||(_=e[this.getLanguagePartFromCode(t)]),_||(_=e.default),_||[]}toResolveHierarchy(e,t){const _=this.getFallbackCodes(t||this.options.fallbackLng||[],e),o=[],n=e=>{e&&(this.isSupportedCode(e)?o.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return"string"==typeof e&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&n(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&n(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&n(this.getLanguagePartFromCode(e))):"string"==typeof e&&n(this.formatLanguageCode(e)),_.forEach((e=>{o.indexOf(e)<0&&n(this.formatLanguageCode(e))})),o}}let T=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],L={1:e=>Number(e>1),2:e=>Number(1!=e),3:e=>0,4:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2),5:e=>Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5),6:e=>Number(1==e?0:e>=2&&e<=4?1:2),7:e=>Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2),8:e=>Number(1==e?0:2==e?1:8!=e&&11!=e?2:3),9:e=>Number(e>=2),10:e=>Number(1==e?0:2==e?1:e<7?2:e<11?3:4),11:e=>Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3),12:e=>Number(e%10!=1||e%100==11),13:e=>Number(0!==e),14:e=>Number(1==e?0:2==e?1:3==e?2:3),15:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2),16:e=>Number(e%10==1&&e%100!=11?0:0!==e?1:2),17:e=>Number(1==e||e%10==1&&e%100!=11?0:1),18:e=>Number(0==e?0:1==e?1:2),19:e=>Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3),20:e=>Number(1==e?0:0==e||e%100>0&&e%100<20?1:2),21:e=>Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0),22:e=>Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)};const B=["v1","v2","v3"],K=["v4"],b={zero:0,one:1,two:2,few:3,many:4,other:5};class U{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=a.create("pluralResolver"),this.options.compatibilityJSON&&!K.includes(this.options.compatibilityJSON)||"undefined"!=typeof Intl&&Intl.PluralRules||(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=(()=>{const e={};return T.forEach((t=>{t.lngs.forEach((_=>{e[_]={numbers:t.nr,plurals:L[t.fc]}}))})),e})(),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.shouldUseIntlApi())try{const _=g("dev"===e?"en":e),o=t.ordinal?"ordinal":"cardinal",n=JSON.stringify({cleanedCode:_,type:o});if(n in this.pluralRulesCache)return this.pluralRulesCache[n];const a=new Intl.PluralRules(_,{type:o});return this.pluralRulesCache[n]=a,a}catch(e){return}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}needsPlural(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const _=this.getRule(e,t);return this.shouldUseIntlApi()?_&&_.resolvedOptions().pluralCategories.length>1:_&&_.numbers.length>1}getPluralFormsOfKey(e,t){let _=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,_).map((e=>`${t}${e}`))}getSuffixes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const _=this.getRule(e,t);return _?this.shouldUseIntlApi()?_.resolvedOptions().pluralCategories.sort(((e,t)=>b[e]-b[t])).map((e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`)):_.numbers.map((_=>this.getSuffix(e,_,t))):[]}getSuffix(e,t){let _=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=this.getRule(e,_);return o?this.shouldUseIntlApi()?`${this.options.prepend}${_.ordinal?`ordinal${this.options.prepend}`:""}${o.select(t)}`:this.getSuffixRetroCompatible(o,t):(this.logger.warn(`no plural rule found for: ${e}`),"")}getSuffixRetroCompatible(e,t){const _=e.noAbs?e.plurals(t):e.plurals(Math.abs(t));let o=e.numbers[_];this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]&&(2===o?o="plural":1===o&&(o=""));const n=()=>this.options.prepend&&o.toString()?this.options.prepend+o.toString():o.toString();return"v1"===this.options.compatibilityJSON?1===o?"":"number"==typeof o?`_plural_${o.toString()}`:n():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]?n():this.options.prepend&&_.toString()?this.options.prepend+_.toString():_.toString()}shouldUseIntlApi(){return!B.includes(this.options.compatibilityJSON)}}const W=function(e,t,_){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".",n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=((e,t,_)=>{const o=D(e,_);return void 0!==o?o:D(t,_)})(e,t,_);return!a&&n&&"string"==typeof _&&(a=A(e,_,o),void 0===a&&(a=A(t,_,o))),a},k=e=>e.replace(/\$/g,"$$$$");class x{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=a.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||(e=>e),this.init(e)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:_,useRawValueToEscape:o,prefix:n,prefixEscaped:a,suffix:i,suffixEscaped:r,formatSeparator:s,unescapeSuffix:l,unescapePrefix:c,nestingPrefix:u,nestingPrefixEscaped:E,nestingSuffix:d,nestingSuffixEscaped:D,nestingOptionsSeparator:p,maxReplaces:v,alwaysFormat:P}=e.interpolation;this.escape=void 0!==t?t:O,this.escapeValue=void 0===_||_,this.useRawValueToEscape=void 0!==o&&o,this.prefix=n?y(n):a||"{{",this.suffix=i?y(i):r||"}}",this.formatSeparator=s||",",this.unescapePrefix=l?"":c||"-",this.unescapeSuffix=this.unescapePrefix?"":l||"",this.nestingPrefix=u?y(u):E||y("$t("),this.nestingSuffix=d?y(d):D||y(")"),this.nestingOptionsSeparator=p||",",this.maxReplaces=v||1e3,this.alwaysFormat=void 0!==P&&P,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(e,t)=>e&&e.source===t?(e.lastIndex=0,e):new RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,_,o){let n,a,i;const r=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},l=e=>{if(e.indexOf(this.formatSeparator)<0){const n=W(t,r,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(n,void 0,_,{...o,...t,interpolationkey:e}):n}const n=e.split(this.formatSeparator),a=n.shift().trim(),i=n.join(this.formatSeparator).trim();return this.format(W(t,r,a,this.options.keySeparator,this.options.ignoreJSONStructure),i,_,{...o,...t,interpolationkey:a})};this.resetRegExp();const c=o&&o.missingInterpolationHandler||this.options.missingInterpolationHandler,u=o&&o.interpolation&&void 0!==o.interpolation.skipOnVariables?o.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>k(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?k(this.escape(e)):k(e)}].forEach((t=>{for(i=0;n=t.regex.exec(e);){const _=n[1].trim();if(a=l(_),void 0===a)if("function"==typeof c){const t=c(e,n,o);a="string"==typeof t?t:""}else if(o&&Object.prototype.hasOwnProperty.call(o,_))a="";else{if(u){a=n[0];continue}this.logger.warn(`missed to pass in variable ${_} for interpolating ${e}`),a=""}else"string"==typeof a||this.useRawValueToEscape||(a=s(a));const r=t.safeValue(a);if(e=e.replace(n[0],r),u?(t.regex.lastIndex+=a.length,t.regex.lastIndex-=n[0].length):t.regex.lastIndex=0,i++,i>=this.maxReplaces)break}})),e}nest(e,t){let _,o,n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=(e,t)=>{const _=this.nestingOptionsSeparator;if(e.indexOf(_)<0)return e;const o=e.split(new RegExp(`${_}[ ]*{`));let a=`{${o[1]}`;e=o[0],a=this.interpolate(a,n);const i=a.match(/'/g),r=a.match(/"/g);(i&&i.length%2==0&&!r||r.length%2!=0)&&(a=a.replace(/'/g,'"'));try{n=JSON.parse(a),t&&(n={...t,...n})}catch(t){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,t),`${e}${_}${a}`}return n.defaultValue&&n.defaultValue.indexOf(this.prefix)>-1&&delete n.defaultValue,e};for(;_=this.nestingRegexp.exec(e);){let r=[];n={...a},n=n.replace&&"string"!=typeof n.replace?n.replace:n,n.applyPostProcessor=!1,delete n.defaultValue;let l=!1;if(-1!==_[0].indexOf(this.formatSeparator)&&!/{.*}/.test(_[1])){const e=_[1].split(this.formatSeparator).map((e=>e.trim()));_[1]=e.shift(),r=e,l=!0}if(o=t(i.call(this,_[1].trim(),n),n),o&&_[0]===e&&"string"!=typeof o)return o;"string"!=typeof o&&(o=s(o)),o||(this.logger.warn(`missed to resolve ${_[1]} for nesting ${e}`),o=""),l&&(o=r.reduce(((e,t)=>this.format(e,t,a.lng,{...a,interpolationkey:_[1].trim()})),o.trim())),e=e.replace(_[0],o),this.regexp.lastIndex=0}return e}}const w=e=>{const t={};return(_,o,n)=>{let a=n;n&&n.interpolationkey&&n.formatParams&&n.formatParams[n.interpolationkey]&&n[n.interpolationkey]&&(a={...a,[n.interpolationkey]:void 0});const i=o+JSON.stringify(a);let r=t[i];return r||(r=e(g(o),n),t[i]=r),r(_)}};class F{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=a.create("formatter"),this.options=e,this.formats={number:w(((e,t)=>{const _=new Intl.NumberFormat(e,{...t});return e=>_.format(e)})),currency:w(((e,t)=>{const _=new Intl.NumberFormat(e,{...t,style:"currency"});return e=>_.format(e)})),datetime:w(((e,t)=>{const _=new Intl.DateTimeFormat(e,{...t});return e=>_.format(e)})),relativetime:w(((e,t)=>{const _=new Intl.RelativeTimeFormat(e,{...t});return e=>_.format(e,t.range||"day")})),list:w(((e,t)=>{const _=new Intl.ListFormat(e,{...t});return e=>_.format(e)}))},this.init(e)}init(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}}).interpolation;this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=w(t)}format(e,t,_){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const n=t.split(this.formatSeparator);if(n.length>1&&n[0].indexOf("(")>1&&n[0].indexOf(")")<0&&n.find((e=>e.indexOf(")")>-1))){const e=n.findIndex((e=>e.indexOf(")")>-1));n[0]=[n[0],...n.splice(1,e)].join(this.formatSeparator)}return n.reduce(((e,t)=>{const{formatName:n,formatOptions:a}=(e=>{let t=e.toLowerCase().trim();const _={};if(e.indexOf("(")>-1){const o=e.split("(");t=o[0].toLowerCase().trim();const n=o[1].substring(0,o[1].length-1);"currency"===t&&n.indexOf(":")<0?_.currency||(_.currency=n.trim()):"relativetime"===t&&n.indexOf(":")<0?_.range||(_.range=n.trim()):n.split(";").forEach((e=>{if(e){const[t,...o]=e.split(":"),n=o.join(":").trim().replace(/^'+|'+$/g,""),a=t.trim();_[a]||(_[a]=n),"false"===n&&(_[a]=!1),"true"===n&&(_[a]=!0),isNaN(n)||(_[a]=parseInt(n,10))}}))}return{formatName:t,formatOptions:_}})(t);if(this.formats[n]){let t=e;try{const i=o&&o.formatParams&&o.formatParams[o.interpolationkey]||{},r=i.locale||i.lng||o.locale||o.lng||_;t=this.formats[n](e,r,{...a,...o,...i})}catch(e){this.logger.warn(e)}return t}return this.logger.warn(`there was no format function for ${n}`),e}),e)}}class S extends i{constructor(e,t,_){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=_,this.languageUtils=_.languageUtils,this.options=o,this.logger=a.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=o.maxParallelReads||10,this.readingCalls=0,this.maxRetries=o.maxRetries>=0?o.maxRetries:5,this.retryTimeout=o.retryTimeout>=1?o.retryTimeout:350,this.state={},this.queue=[],this.backend&&this.backend.init&&this.backend.init(_,o.backend,o)}queueLoad(e,t,_,o){const n={},a={},i={},r={};return e.forEach((e=>{let o=!0;t.forEach((t=>{const i=`${e}|${t}`;!_.reload&&this.store.hasResourceBundle(e,t)?this.state[i]=2:this.state[i]<0||(1===this.state[i]?void 0===a[i]&&(a[i]=!0):(this.state[i]=1,o=!1,void 0===a[i]&&(a[i]=!0),void 0===n[i]&&(n[i]=!0),void 0===r[t]&&(r[t]=!0)))})),o||(i[e]=!0)})),(Object.keys(n).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:o}),{toLoad:Object.keys(n),pending:Object.keys(a),toLoadLanguages:Object.keys(i),toLoadNamespaces:Object.keys(r)}}loaded(e,t,_){const o=e.split("|"),n=o[0],a=o[1];t&&this.emit("failedLoading",n,a,t),!t&&_&&this.store.addResourceBundle(n,a,_,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&_&&(this.state[e]=0);const i={};this.queue.forEach((_=>{((e,t,_)=>{const{obj:o,k:n}=E(e,t,Object);o[n]=o[n]||[],o[n].push(_)})(_.loaded,[n],a),((e,t)=>{void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)})(_,e),t&&_.errors.push(t),0!==_.pendingCount||_.done||(Object.keys(_.loaded).forEach((e=>{i[e]||(i[e]={});const t=_.loaded[e];t.length&&t.forEach((t=>{void 0===i[e][t]&&(i[e][t]=!0)}))})),_.done=!0,_.errors.length?_.callback(_.errors):_.callback())})),this.emit("loaded",i),this.queue=this.queue.filter((e=>!e.done))}read(e,t,_){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,a=arguments.length>5?arguments[5]:void 0;if(!e.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:_,tried:o,wait:n,callback:a});this.readingCalls++;const i=(i,r)=>{if(this.readingCalls--,this.waitingReads.length>0){const e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}i&&r&&o<this.maxRetries?setTimeout((()=>{this.read.call(this,e,t,_,o+1,2*n,a)}),n):a(i,r)},r=this.backend[_].bind(this.backend);if(2!==r.length)return r(e,t,i);try{const _=r(e,t);_&&"function"==typeof _.then?_.then((e=>i(null,e))).catch(i):i(null,_)}catch(e){i(e)}}prepareLoading(e,t){let _=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),o&&o();"string"==typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]);const n=this.queueLoad(e,t,_,o);if(!n.toLoad.length)return n.pending.length||o(),null;n.toLoad.forEach((e=>{this.loadOne(e)}))}load(e,t,_){this.prepareLoading(e,t,{},_)}reload(e,t,_){this.prepareLoading(e,t,{reload:!0},_)}loadOne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const _=e.split("|"),o=_[0],n=_[1];this.read(o,n,"read",void 0,void 0,((_,a)=>{_&&this.logger.warn(`${t}loading namespace ${n} for language ${o} failed`,_),!_&&a&&this.logger.log(`${t}loaded namespace ${n} for language ${o}`,a),this.loaded(e,_,a)}))}saveMissing(e,t,_,o,n){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:()=>{};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t))this.logger.warn(`did not save key "${_}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");else if(null!=_&&""!==_){if(this.backend&&this.backend.create){const r={...a,isUpdate:n},s=this.backend.create.bind(this.backend);if(s.length<6)try{let n;n=5===s.length?s(e,t,_,o,r):s(e,t,_,o),n&&"function"==typeof n.then?n.then((e=>i(null,e))).catch(i):i(null,n)}catch(e){i(e)}else s(e,t,_,o,i,r)}e&&e[0]&&this.store.addResource(e[0],t,_,o)}}}const Q=()=>({debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if("object"==typeof e[1]&&(t=e[1]),"string"==typeof e[1]&&(t.defaultValue=e[1]),"string"==typeof e[2]&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){const _=e[3]||e[2];Object.keys(_).forEach((e=>{t[e]=_[e]}))}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),N=e=>("string"==typeof e.ns&&(e.ns=[e.ns]),"string"==typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"==typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs&&e.supportedLngs.indexOf("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e),V=()=>{};class q extends i{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;var _;if(super(),this.options=N(e),this.services={},this.logger=a,this.modules={external:[]},_=this,Object.getOwnPropertyNames(Object.getPrototypeOf(_)).forEach((e=>{"function"==typeof _[e]&&(_[e]=_[e].bind(_))})),t&&!this.isInitialized&&!e.isClone){if(!this.options.initImmediate)return this.init(e,t),this;setTimeout((()=>{this.init(e,t)}),0)}}init(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,"function"==typeof t&&(_=t,t={}),!t.defaultNS&&!1!==t.defaultNS&&t.ns&&("string"==typeof t.ns?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const o=Q();this.options={...o,...this.options,...N(t)},"v1"!==this.options.compatibilityAPI&&(this.options.interpolation={...o.interpolation,...this.options.interpolation}),void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator);const n=e=>e?"function"==typeof e?new e:e:null;if(!this.options.isClone){let t;this.modules.logger?a.init(n(this.modules.logger),this.options):a.init(null,this.options),this.modules.formatter?t=this.modules.formatter:"undefined"!=typeof Intl&&(t=F);const _=new R(this.options);this.store=new h(this.options.resources,this.options);const i=this.services;i.logger=a,i.resourceStore=this.store,i.languageUtils=_,i.pluralResolver=new U(_,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),!t||this.options.interpolation.format&&this.options.interpolation.format!==o.interpolation.format||(i.formatter=n(t),i.formatter.init(i,this.options),this.options.interpolation.format=i.formatter.format.bind(i.formatter)),i.interpolator=new x(this.options),i.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},i.backendConnector=new S(n(this.modules.backend),i.resourceStore,i,this.options),i.backendConnector.on("*",(function(t){for(var _=arguments.length,o=new Array(_>1?_-1:0),n=1;n<_;n++)o[n-1]=arguments[n];e.emit(t,...o)})),this.modules.languageDetector&&(i.languageDetector=n(this.modules.languageDetector),i.languageDetector.init&&i.languageDetector.init(i,this.options.detection,this.options)),this.modules.i18nFormat&&(i.i18nFormat=n(this.modules.i18nFormat),i.i18nFormat.init&&i.i18nFormat.init(this)),this.translator=new I(this.services,this.options),this.translator.on("*",(function(t){for(var _=arguments.length,o=new Array(_>1?_-1:0),n=1;n<_;n++)o[n-1]=arguments[n];e.emit(t,...o)})),this.modules.external.forEach((e=>{e.init&&e.init(this)}))}if(this.format=this.options.interpolation.format,_||(_=V),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined");["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach((t=>{this[t]=function(){return e.store[t](...arguments)}}));["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach((t=>{this[t]=function(){return e.store[t](...arguments),e}}));const i=r(),s=()=>{const e=(e,t)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),i.resolve(t),_(e,t)};if(this.languages&&"v1"!==this.options.compatibilityAPI&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initImmediate?s():setTimeout(s,0),i}loadResources(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:V;const _="string"==typeof e?e:this.language;if("function"==typeof e&&(t=e),!this.options.resources||this.options.partialBundledLanguages){if(_&&"cimode"===_.toLowerCase()&&(!this.options.preload||0===this.options.preload.length))return t();const e=[],o=t=>{if(!t)return;if("cimode"===t)return;this.services.languageUtils.toResolveHierarchy(t).forEach((t=>{"cimode"!==t&&e.indexOf(t)<0&&e.push(t)}))};if(_)o(_);else{this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach((e=>o(e)))}this.options.preload&&this.options.preload.forEach((e=>o(e))),this.services.backendConnector.load(e,this.options.ns,(e=>{e||this.resolvedLanguage||!this.language||this.setResolvedLanguage(this.language),t(e)}))}else t(null)}reloadResources(e,t,_){const o=r();return"function"==typeof e&&(_=e,e=void 0),"function"==typeof t&&(_=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),_||(_=V),this.services.backendConnector.reload(e,t,(e=>{o.resolve(),_(e)})),o}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&f.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(let e=0;e<this.languages.length;e++){const t=this.languages[e];if(!(["cimode","dev"].indexOf(t)>-1)&&this.store.hasLanguageSomeTranslations(t)){this.resolvedLanguage=t;break}}}changeLanguage(e,t){var _=this;this.isLanguageChangingTo=e;const o=r();this.emit("languageChanging",e);const n=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},a=(e,a)=>{a?(n(a),this.translator.changeLanguage(a),this.isLanguageChangingTo=void 0,this.emit("languageChanged",a),this.logger.log("languageChanged",a)):this.isLanguageChangingTo=void 0,o.resolve((function(){return _.t(...arguments)})),t&&t(e,(function(){return _.t(...arguments)}))},i=t=>{e||t||!this.services.languageDetector||(t=[]);const _="string"==typeof t?t:this.services.languageUtils.getBestMatchFromCodes(t);_&&(this.language||n(_),this.translator.language||this.translator.changeLanguage(_),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage&&this.services.languageDetector.cacheUserLanguage(_)),this.loadResources(_,(e=>{a(e,_)}))};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(i):this.services.languageDetector.detect(i):i(e):i(this.services.languageDetector.detect()),o}getFixedT(e,t,_){var o=this;const n=function(e,t){let a;if("object"!=typeof t){for(var i=arguments.length,r=new Array(i>2?i-2:0),s=2;s<i;s++)r[s-2]=arguments[s];a=o.options.overloadTranslationOptionHandler([e,t].concat(r))}else a={...t};a.lng=a.lng||n.lng,a.lngs=a.lngs||n.lngs,a.ns=a.ns||n.ns,""!==a.keyPrefix&&(a.keyPrefix=a.keyPrefix||_||n.keyPrefix);const l=o.options.keySeparator||".";let c;return c=a.keyPrefix&&Array.isArray(e)?e.map((e=>`${a.keyPrefix}${l}${e}`)):a.keyPrefix?`${a.keyPrefix}${l}${e}`:e,o.t(c,a)};return"string"==typeof e?n.lng=e:n.lngs=e,n.ns=t,n.keyPrefix=_,n}t(){return this.translator&&this.translator.translate(...arguments)}exists(){return this.translator&&this.translator.exists(...arguments)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const _=t.lng||this.resolvedLanguage||this.languages[0],o=!!this.options&&this.options.fallbackLng,n=this.languages[this.languages.length-1];if("cimode"===_.toLowerCase())return!0;const a=(e,t)=>{const _=this.services.backendConnector.state[`${e}|${t}`];return-1===_||0===_||2===_};if(t.precheck){const e=t.precheck(this,a);if(void 0!==e)return e}return!!this.hasResourceBundle(_,e)||(!(this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages))||!(!a(_,e)||o&&!a(n,e)))}loadNamespaces(e,t){const _=r();return this.options.ns?("string"==typeof e&&(e=[e]),e.forEach((e=>{this.options.ns.indexOf(e)<0&&this.options.ns.push(e)})),this.loadResources((e=>{_.resolve(),t&&t(e)})),_):(t&&t(),Promise.resolve())}loadLanguages(e,t){const _=r();"string"==typeof e&&(e=[e]);const o=this.options.preload||[],n=e.filter((e=>o.indexOf(e)<0&&this.services.languageUtils.isSupportedCode(e)));return n.length?(this.options.preload=o.concat(n),this.loadResources((e=>{_.resolve(),t&&t(e)})),_):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";const t=this.services&&this.services.languageUtils||new R(Q());return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(t.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){return new q(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)}cloneInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:V;const _=e.forkResourceStore;_&&delete e.forkResourceStore;const o={...this.options,...e,isClone:!0},n=new q(o);void 0===e.debug&&void 0===e.prefix||(n.logger=n.logger.clone(e));return["store","services","language"].forEach((e=>{n[e]=this[e]})),n.services={...this.services},n.services.utils={hasLoadedNamespace:n.hasLoadedNamespace.bind(n)},_&&(n.store=new h(this.store.data,o),n.services.resourceStore=n.store),n.translator=new I(n.services,o),n.translator.on("*",(function(e){for(var t=arguments.length,_=new Array(t>1?t-1:0),o=1;o<t;o++)_[o-1]=arguments[o];n.emit(e,..._)})),n.init(o,t),n.translator.options=o,n.translator.backendConnector.services.utils={hasLoadedNamespace:n.hasLoadedNamespace.bind(n)},n}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const H=q.createInstance();H.createInstance=q.createInstance;H.createInstance,H.dir,H.init,H.loadResources,H.reloadResources,H.use,H.changeLanguage,H.getFixedT,H.t,H.exists,H.setDefaultNamespace,H.hasLoadedNamespace,H.loadNamespaces,H.loadLanguages;const{slice:j,forEach:Z}=[];const z=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,$={create(e,t,_,o){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{path:"/",sameSite:"strict"};_&&(n.expires=new Date,n.expires.setTime(n.expires.getTime()+60*_*1e3)),o&&(n.domain=o),document.cookie=((e,t,_)=>{const o=_||{};o.path=o.path||"/";let n=`${e}=${encodeURIComponent(t)}`;if(o.maxAge>0){const e=o.maxAge-0;if(Number.isNaN(e))throw new Error("maxAge should be a Number");n+=`; Max-Age=${Math.floor(e)}`}if(o.domain){if(!z.test(o.domain))throw new TypeError("option domain is invalid");n+=`; Domain=${o.domain}`}if(o.path){if(!z.test(o.path))throw new TypeError("option path is invalid");n+=`; Path=${o.path}`}if(o.expires){if("function"!=typeof o.expires.toUTCString)throw new TypeError("option expires is invalid");n+=`; Expires=${o.expires.toUTCString()}`}if(o.httpOnly&&(n+="; HttpOnly"),o.secure&&(n+="; Secure"),o.sameSite)switch("string"==typeof o.sameSite?o.sameSite.toLowerCase():o.sameSite){case!0:n+="; SameSite=Strict";break;case"lax":n+="; SameSite=Lax";break;case"strict":n+="; SameSite=Strict";break;case"none":n+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return n})(e,encodeURIComponent(t),n)},read(e){const t=`${e}=`,_=document.cookie.split(";");for(let e=0;e<_.length;e++){let o=_[e];for(;" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return null},remove(e){this.create(e,"",-1)}};var G={name:"cookie",lookup(e){let{lookupCookie:t}=e;if(t&&"undefined"!=typeof document)return $.read(t)||void 0},cacheUserLanguage(e,t){let{lookupCookie:_,cookieMinutes:o,cookieDomain:n,cookieOptions:a}=t;_&&"undefined"!=typeof document&&$.create(_,e,o,n,a)}},J={name:"querystring",lookup(e){let t,{lookupQuerystring:_}=e;if("undefined"!=typeof window){let{search:e}=window.location;!window.location.search&&window.location.hash?.indexOf("?")>-1&&(e=window.location.hash.substring(window.location.hash.indexOf("?")));const o=e.substring(1).split("&");for(let e=0;e<o.length;e++){const n=o[e].indexOf("=");if(n>0){o[e].substring(0,n)===_&&(t=o[e].substring(n+1))}}}return t}};let Y=null;const X=()=>{if(null!==Y)return Y;try{Y="undefined"!==window&&null!==window.localStorage;const e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch(e){Y=!1}return Y};var ee={name:"localStorage",lookup(e){let{lookupLocalStorage:t}=e;if(t&&X())return window.localStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupLocalStorage:_}=t;_&&X()&&window.localStorage.setItem(_,e)}};let te=null;const _e=()=>{if(null!==te)return te;try{te="undefined"!==window&&null!==window.sessionStorage;const e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch(e){te=!1}return te};var oe={name:"sessionStorage",lookup(e){let{lookupSessionStorage:t}=e;if(t&&_e())return window.sessionStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupSessionStorage:_}=t;_&&_e()&&window.sessionStorage.setItem(_,e)}},ne={name:"navigator",lookup(e){const t=[];if("undefined"!=typeof navigator){const{languages:e,userLanguage:_,language:o}=navigator;if(e)for(let _=0;_<e.length;_++)t.push(e[_]);_&&t.push(_),o&&t.push(o)}return t.length>0?t:void 0}},ae={name:"htmlTag",lookup(e){let t,{htmlTag:_}=e;const o=_||("undefined"!=typeof document?document.documentElement:null);return o&&"function"==typeof o.getAttribute&&(t=o.getAttribute("lang")),t}},ie={name:"path",lookup(e){let{lookupFromPathIndex:t}=e;if("undefined"==typeof window)return;const _=window.location.pathname.match(/\/([a-zA-Z-]*)/g);if(!Array.isArray(_))return;const o="number"==typeof t?t:0;return _[o]?.replace("/","")}},re={name:"subdomain",lookup(e){let{lookupFromSubdomainIndex:t}=e;const _="number"==typeof t?t+1:1,o="undefined"!=typeof window&&window.location?.hostname?.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(o)return o[_]}};class se{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,t)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},_=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=e||{languageUtils:{}},this.options=function(e){return Z.call(j.call(arguments,1),(t=>{if(t)for(const _ in t)void 0===e[_]&&(e[_]=t[_])})),e}(t,this.options||{},{order:["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"],lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:e=>e}),"string"==typeof this.options.convertDetectedLanguage&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=e=>e.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=_,this.addDetector(G),this.addDetector(J),this.addDetector(ee),this.addDetector(oe),this.addDetector(ne),this.addDetector(ae),this.addDetector(ie),this.addDetector(re)}addDetector(e){return this.detectors[e.name]=e,this}detect(e){e||(e=this.options.order);let t=[];return e.forEach((e=>{if(this.detectors[e]){let _=this.detectors[e].lookup(this.options);_&&"string"==typeof _&&(_=[_]),_&&(t=t.concat(_))}})),t=t.map((e=>this.options.convertDetectedLanguage(e))),this.services.languageUtils.getBestMatchFromCodes?t:t.length>0?t[0]:null}cacheUserLanguage(e,t){t||(t=this.options.caches),t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach((t=>{this.detectors[t]&&this.detectors[t].cacheUserLanguage(e,this.options)})))}}se.type="languageDetector";const le=JSON.parse('{"title":"END Tower","full_name":"Damien Noella Eda","loading":"Please wait...","loading_resources":"Resources are loading...","start_game":"Start","load_game":"Load","easy_level":"Easy","normal_level":"Normal","hard_level":"Hard","level":"Level","hp":"HP","attack":"Attack","defense":"Defense","money":"Money","exp":"EXP","monster":"Monster","loading_core_js":"Loading core JS files...","loading_floors":"Loading floor files...","tower_entrance":"Tower Entrance","dream_start":"The Starting Point of Dreams","submit":"submit","input_name_tip":"Please enter your name","main_1":"Main Tower Floor 1","main_2":"Main Tower Floor 2","main_3":"Main Tower Floor 3","main_4":"Main Tower Floor 4","main_5":"Main Tower Floor 5","main_6":"Main Tower Floor 6","main_7":"Main Tower Floor 7","main_8":"Main Tower Floor 8","main_9":"Main Tower Floor 9","main_10":"Main Tower Floor 10","main_11":"Main Tower Floor 11","main_12":"Main Tower Floor 12","main_13":"Main Tower Floor 13","main_14":"Main Tower Floor 14","main_15":"Main Tower Floor 15","main_16":"Main Tower Floor 16","main_17":"Main Tower Floor 17","main_18":"Main Tower Floor 18","main_19":"Main Tower Floor 19","main_20":"Main Tower Floor 20","main_21":"Main Tower Floor 21","main_22":"Main Tower Floor 22","main_22L":"Floor 22 Left","main_22R":"Floor 22 Right","main_22D":"Floor 22 Down","main_23":"Main Tower Floor 23","main_24":"Main Tower Floor 24","main_25":"Main Tower Floor 25","boss_1":"Boss Floor","get_item":"Get item: ","have_no":"You have no ","open_door_failed":"You can\'t open this door.","try_beat_failed":"You can\'t beat this one.","battle_success":"You have defeated ","not_enough":"You have not enough ","gameover_ending1":"You are died!","gameover_ending2":"You win the game!","posion":"You have been poisoned and died.","zone":"You have been attacked by zone and died.","damaged":"You have been damaged and died.","battle":"You have been defeated and died.","True End: ":"True End","Normal End: ":"Normal End","blocking_attack_half_hp":"been blocked and lost half of your HP","blocking_attack":"been blocked and lost HP","zone_attack":"been attacked by a zone and lost HP","shop_not_opened":"Shop is not opened","shop_not_available":"Shop is not available","confirm":"confirm","cancel":"cancel","leave":"leave","return":"return","last_page":"Previous","next_page":"Next","remove_item":"Remove item ","yes":"是","no":"否","empty":"Empty","no_enemy":"No enemy here","no_special":"No special attribute","click_anywhere_to_continue":"Click anywhere to continue","stop_move":"Stop moving and continue","use_item":"Use item successfully","use_item_failed":"Use item failed ","show_battle_animate_confirm":"Do you want to enable battle animation? \\n(You can change it later in the system settings.)","choose_sex":"Choose your sex","show_sex_confirm":"Are you a boy?","use_transporter_neer_floor":"You can only use the transporter on the staircase.","failed_to_use_transporter":"Failed to use transporter","transport_floor":"transport to floor","center_fly_failed":"failed to center fly","unimplemented":"This feature is not implemented yet."}'),ce=JSON.parse('{"title":"终结塔","full_name":"达米安·诺拉·艾达","loading":"请稍后...","loading_resources":"资源即将开始加载...","start_game":"启动","load_game":"载入","easy_level":"简单","normal_level":"普通","hard_level":"困难","level":"等级","hp":"血量","attack":"攻击","defense":"防御","money":"金币","exp":"经验","monster":"怪物","loading_core_js":"正在加载核心JS文件...","loading_floors":"正在加载楼层文件...","tower_entrance":"塔入口","dream_start":"梦的起点","submit":"提交","input_name_tip":"请输入您的名字","main_1":"主塔1层","main_2":"主塔2层","main_3":"主塔3层","main_4":"主塔4层","main_5":"主塔5层","main_6":"主塔6层","main_7":"主塔7层","main_8":"主塔8层","main_9":"主塔9层","main_10":"主塔10层","main_11":"主塔11层","main_12":"主塔12层","main_13":"主塔13层","main_14":"主塔14层","main_15":"主塔15层","main_16":"主塔16层","main_17":"主塔17层","main_18":"主塔18层","main_19":"主塔19层","main_20":"主塔20层","main_21":"主塔21层","main_22":"主塔22层","main_22L":"22层左层","main_22R":"22层右区","main_22D":"22层下区","main_23":"主塔23层","main_24":"主塔24层","main_25":"主塔25层","boss_1":"决战之巅","get_item":"获得物品：","have_no":"你没有 ","open_door_failed":"打不开这扇门","try_beat_failed":"打不过。","battle_success":"打赢","not_enough":"你没有足够的","gameover_ending1":"你死了！","gameover_ending2":"你赢了！","posion":"中毒而死","zone":"领域伤害致死","damaged":"受伤而死","battle":"战败而死","True End: ":"真结局","Normal End: ":"普通结局","blocking_attack_half_hp":"受到夹击，生命变成一半","blocking_attack":"受到阻击伤害","zone_attack":"受到领域伤害","shop_not_opened":"商店尚未开启","shop_not_available":"商店不可用","confirm":"确认","cancel":"取消","leave":"离开","return":"返回","last_page":"上一页","next_page":"下一页","remove_item":"移除物品 ","yes":"是","no":"否","empty":"空","no_enemy":"这里没有敌人","no_special":"没有特殊属性","click_anywhere_to_continue":"点击任意位置继续","stop_move":"先停下来再操作","use_item":"使用道具成功","use_item_failed":"当前无法使用","show_battle_animate_confirm":"需要开启战斗动画吗？\\n（也可后续在系统设置更改）。","choose_sex":"选择性别","show_sex_confirm":"您是男孩子吗？","use_transporter_neer_floor":"只有在楼梯边才能用用传送器","failed_to_use_transporter":"使用传送器失败","transport_floor":"楼层传送","center_fly_failed":"中心飞行失败","unimplemented":"功能暂未实现"}');H.use(se).init({lng:"zh",debug:!0,resources:{en:{translation:le},zh:{translation:ce}},fallbackLng:"zh",detection:{order:["querystring","cookie","localStorage","navigator","htmlTag"],caches:["localStorage","cookie"]}});const ue=H},958:(e,t,_)=>{_.d(t,{P:()=>o});var o={player:{down:{loc:0,stop:0,leftFoot:1,rightFoot:3},left:{loc:1,stop:0,leftFoot:1,rightFoot:3},right:{loc:2,stop:0,leftFoot:1,rightFoot:3},up:{loc:3,stop:0,leftFoot:1,rightFoot:3}},terrains:{ground:0,grass:1,grass2:2,yellowWall:3,whiteWall:4,blueWall:5,snowGround:6,ground2:7,ground3:8,ground4:9,sand:10,ground5:11,yellowWall2:12,whiteWall2:13,blueWall2:14,blockWall:15,grayWall:16,white:17,ground6:18,soil:19,star:20,lava:21,ice:22,downFloor:23,upFloor:24,yellowDoor:25,blueDoor:26,redDoor:27,greenDoor:28,specialDoor:29,steelDoor:30,"blueShop-left":31,"blueShop-right":32,"pinkShop-left":33,"pinkShop-right":34,arrowUp:35,arrowDown:36,arrowLeft:37,arrowRight:38,light:39,darkLight:40,ski:41,flower:42,box:43,boxed:44},redwall:{redwall:0},greenwall:{greenwall:0},pinkwall:{pinkwall:0},brownwall:{brownwall:0},animates:{star:0,lava:1,waterWall:2,yellowDoor:3,blueDoor:4,redDoor:5,greenDoor:6,specialDoor:7,blueWallDoor:8,yellowWallDoor:9,whiteWallDoor:10,steelDoor:11,lavaDoor:12,grayLavaDoor:13,starDoor:14,mockBlueWallDoor:15,mockYellowWallDoor:16,mockWhiteWallDoor:17,iceYellowWallDoor:18,starPortal:19,exclamation:20,portal:21,switch:22,lavaNet:23,poisonNet:24,weakNet:25,curseNet:26,downPortal:27,leftPortal:28,rightPortal:29,upPortal:30,water:31},npcs:{man:0,woman:1,thief:2,fairy:3,magician:4,womanMagician:5,oldMan:6,child:7,wood:8,pinkShop:9,blueShop:10,princess:11,wlt:12,wt:13,wrt:14,wl:15,wc:16,wr:17,wlb:18,wrb:19,dlt:20,dt:21,drt:22,dl:23,dc:24,dr:25,dlb:26,drb:27},leina:{leina:0},jay:{jay:0},enemys:{greenSlime:0,redSlime:1,blackSlime:2,slimelord:3,bat:4,bigBat:5,redBat:6,vampire:7,vampire2:7,vampire3:7,skeleton:8,skeletonSoilder:9,skeletonCaptain:10,ghostSkeleton:11,zombie:12,zombieKnight:13,rock:14,slimeMan:15,bluePriest:16,redPriest:17,brownWizard:18,redWizard:19,yellowGuard:20,blueGuard:21,redGuard:22,swordsman:23,soldier:24,yellowKnight:25,redKnight:26,darkKnight:27,blackKing:28,yellowKing:29,greenKing:30,blueKnight:31,goldSlime:32,poisonSkeleton:33,poisonBat:34,steelRock:35,skeletonPriest:36,skeletonKing:37,skeletonWizard:38,redSkeletonCaption:39,badHero:40,demon:41,demonPriest:42,goldHornSlime:43,redKing:44,redKing2:44,whiteKing:45,blackMagician:46,silverSlime:47,swordEmperor:48,whiteHornSlime:49,badPrincess:50,badFairy:51,grayPriest:52,redSwordsman:53,whiteGhost:54,poisonZombie:55,magicDragon:56,octopus:57,darkFairy:58,greenKnight:59},items:{yellowKey:0,blueKey:1,redKey:2,greenKey:3,steelKey:4,bigKey:6,redJewel:16,blueJewel:17,greenJewel:18,yellowJewel:19,redPotion:20,bluePotion:21,greenPotion:22,yellowPotion:23,sword0:60,sword1:50,sword2:51,sword3:52,sword4:53,sword5:54,shield0:61,shield1:55,shield2:56,shield3:57,shield4:58,shield5:59,book:9,fly:12,pickaxe:45,icePickaxe:44,bomb:43,centerFly:13,upFly:15,downFly:14,coin:11,snow:41,cross:40,superPotion:29,earthquake:8,poisonWine:24,weakWine:25,curseWine:27,superWine:28,knife:42,moneyPocket:46,shoes:47,hammer:48,bigFly:35,wand1:30,wand2:31},autotile:{autotile:0,autotile1:0,autotile2:0,autotile3:0}}},636:(e,t,_)=>{_.d(t,{BT:()=>l,Ht:()=>s,Px:()=>c,zC:()=>r});var o=_(197),n=["animates","enemys","player","player-man","player-woman","items","npcs","terrains","redwall","greenwall","pinkwall","brownwall","leina","jay"],a="images";function i(e,t){try{console.log("loading image: ".concat(e," ..."));var _=e;_.indexOf(".png")<0&&(_+=".png");var o=new Image;if(o.src="".concat(a,"/").concat(_),o.complete)return console.log("loaded image: ".concat(e),o),void t(e,o);o.onload=function(){console.log("loaded image: ".concat(e),o),t(e,o)}}catch(e){alert(e)}}var r={};function s(){var e=new Image;r.ground=e,e.src="".concat(a,"/ground.png");var t=new Image;r.brownground=t,t.src="".concat(a,"/brownground.png");for(var _=0;_<n.length;_++)i(n[_],(function(e,t){console.log("loaded image: ".concat(e),t),r[e]=t,"player"==e&&(o.Ay.playerHeight=t.height/4)}))}function l(){console.log("setPlayerManImage"),r.player.src="".concat(a,"/player-man.png"),o.Ay.playerHeight=r.player.height/4}function c(){console.log("setPlayerWomanImage"),r.player.src="".concat(a,"/player-woman.png"),o.Ay.playerHeight=r.player.height/4}},475:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{DB:()=>noteBookOnClickHandler,J_:()=>bookOnClickHandler,P6:()=>keyUpHandler,Pf:()=>toolBoxOnClickHandler,Wx:()=>onTouchMoveHandler,bc:()=>mouseUpHandler,cV:()=>keyDownHandler,ib:()=>onMouseMoveHandler,k9:()=>touchStartHandler,nE:()=>touchEndHandler,qg:()=>mouseDownHandler,zf:()=>settingsOnClickHandler});var _dom__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(876),_window__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(654),_util__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(746),_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(197),_canvas__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(250),_events__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(795),_autoroute__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(600),_i18n__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(883),_status_bar__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(578),_config__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(28),_items__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(224),_floor__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(530),_menu__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(417),_shops__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(505);function getClickLoc(e,t){var _={x:0,y:0},o=32;switch(o*=_window__WEBPACK_IMPORTED_MODULE_0__.A.getScale(),_window__WEBPACK_IMPORTED_MODULE_0__.A.getScreenMode()){case _window__WEBPACK_IMPORTED_MODULE_0__.Q.MOBILE_VERTICAL:_.x=0,_.y=(0,_dom__WEBPACK_IMPORTED_MODULE_13__.J6)("statusBar").offsetHeight+3;break;case _window__WEBPACK_IMPORTED_MODULE_0__.Q.MOBILE_HORIZONTAL:case _window__WEBPACK_IMPORTED_MODULE_0__.Q.PC:_.x=(0,_dom__WEBPACK_IMPORTED_MODULE_13__.J6)("statusBar").offsetWidth+3,_.y=0}return{x:e-((0,_dom__WEBPACK_IMPORTED_MODULE_13__.J6)("screenBox").offsetLeft+_.x),y:t-((0,_dom__WEBPACK_IMPORTED_MODULE_13__.J6)("screenBox").offsetTop+_.y),size:o}}function onDown(e,t){if(console.log("on down",e,t),!_core__WEBPACK_IMPORTED_MODULE_2__.Ay.started||_core__WEBPACK_IMPORTED_MODULE_2__.Ay.locked)return console.log("game not started or locked, use onclick instead"),void onClick(e,t);_core__WEBPACK_IMPORTED_MODULE_2__.Ay.downTime=new Date,(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.e0)("ui"),(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.qO)("ui"),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.stepPostFix=[];var _={x:e,y:t};console.log("on down push to stepPostfix: ",_),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.stepPostFix.push(_),(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.SM)(_)}function onUp(){if(console.log("on up"),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.stepPostFix.length>0){for(var e=[],t={0:{1:"down","-1":"up"},"-1":{0:"left"},1:{0:"right"}},_=1;_<_core__WEBPACK_IMPORTED_MODULE_2__.Ay.stepPostFix.length;_++){var o=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.stepPostFix[_-1],n=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.stepPostFix[_];console.log("on up tmp stepPostfix push",{direction:t[n.x-o.x][n.y-o.y],x:n.x,y:n.y}),e.push({direction:t[n.x-o.x][n.y-o.y],x:n.x,y:n.y})}var a=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.stepPostFix[0].x,i=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.stepPostFix[0].y;_core__WEBPACK_IMPORTED_MODULE_2__.Ay.stepPostFix=[],_core__WEBPACK_IMPORTED_MODULE_2__.Ay.locked||((0,_canvas__WEBPACK_IMPORTED_MODULE_3__.qO)("ui"),(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.vZ)("ui")),console.log("on up call onclick",a,i,e),onClick(a,i,e),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.downTime=null}}function mouseDownHandler(e){try{if(e.stopPropagation(),1==e.button)return;var t=getClickLoc(e.clientX,e.clientY);if(!(0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(t))return;onDown((0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)(t.x/t.size),(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)(t.y/t.size))}catch(e){console.error(e)}}function mouseUpHandler(e){try{onUp()}catch(e){console.error(e)}}function touchStartHandler(e){try{e.preventDefault();var t=getClickLoc(e.targetTouches[0].clientX,e.targetTouches[0].clientY);if(!(0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(t))return;onDown((0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)(t.x/t.size),(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)(t.y/t.size))}catch(e){console.error(e)}}function touchEndHandler(e){try{onUp()}catch(e){console.error(e)}}function keyDownCtrl(){var e,t;"text"!=(null===(e=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===e?void 0:e.id)?"action"!=(null===(t=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===t?void 0:t.id)||"text"!=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.type||(0,_events__WEBPACK_IMPORTED_MODULE_4__.Eo)():(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.m)()}function keyDownAction(e){var t,_,o;if("choices"==(null===(o=null===(_=null===(t=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===t?void 0:t.data)||void 0===_?void 0:_.current)||void 0===o?void 0:o.type)&&_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.current.choices.length>0){if(38==e){_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection--;var n=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui;(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.vz)(n.text,n.choices)}if(40==e){_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection++;n=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui;(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.vz)(n.text,n.choices)}}}function keyDownShop(e){if(38==e){_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection--;var t=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui;(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.vz)(t.text,t.choices)}if(40==e){_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection++;t=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui;(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.vz)(t.text,t.choices)}}function keyDownBook(e){console.log("key down book: ",e,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event),37==e&&(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.ME)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.index-6),38==e&&(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.ME)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.index-1),39==e&&(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.ME)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.index+6),40==e&&(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.ME)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.index+1),33==e&&(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.ME)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.index-6),34==e&&(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.ME)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.index+6)}function keyUpBook(e){var t,_,o;if(console.log("key up book: ",e,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event),27!=e&&88!=e)if(13!=e&&32!=e&&67!=e);else{var n=null===(o=null===(_=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===_?void 0:_.data)||void 0===o?void 0:o.index;(0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(n)&&clickBook(6,n%6*2)}else(0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(null===(t=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===t?void 0:t.selection)?(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.boxAnimateObjs=[],(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.SE)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection)):(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.nH)()}function clickBook(e,t){var _;console.log("click book: "+e+","+t);var o=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.index;if(3!=e&&4!=e||12!=t)if(8!=e&&9!=e||12!=t){if(e>=10&&e<=12&&12==t)(0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(null===(_=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===_?void 0:_.selection)?(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.boxAnimateObjs=[],(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.SE)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection)):(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.nH)();else if((0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(o)&&t<12){var n=6*(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)(o/6)+(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)(t/2);(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.ME)(n),(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.Pg)(n)}}else(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.ME)(o+6);else(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.ME)(o-6)}function clickBookDetail(){(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.qO)("data"),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.id="book"}function keyDownFly(e){console.log("key down fly: ",e),[37,38].includes(e)?(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.sD)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.page+1):[39,40].includes(e)&&(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.sD)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.page-1)}function keyDownImpl(e){var t;if(console.log("key down: "+e),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.locked){if(17==e)return void keyDownCtrl();var _=null===(t=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===t?void 0:t.id;if(console.log("keyDownImpl locked and eventId:",_),"action"==_)return void keyDownAction(e);if("book"==_)return void keyDownBook(e);if("fly"==_)return void keyDownFly(e);if("viewMaps"==_)return void keyDownViewMaps(e);if("shop"==_)return void keyDownShop(e);if("selectShop"==_)return void keyDownQuickShop(e);if("toolbox"==_)return void keyDownToolBox(e);if("save"==_||"load"==_)return void keyDownSL(e);if("switchs"==_)return void keyDownSwitchs(e);if("settings"==_)return void keyDownSettings(e);if("syncSave"==_)return void keyDownSyncSave(e);if("syncSelect"==_)return;return"localSaveSelect"==_?void keyDownLocalSaveSelect(e):"cursor"==_?void keyDownCursor(e):void 0}if(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.started){switch(e){case 37:(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.T1)("left");break;case 38:(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.T1)("up");break;case 39:(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.T1)("right");break;case 40:(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.T1)("down")}if(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.usingCenterFly&&51!=e){var o=(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.Yf)();(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.qO)("ui",32*(12-o.x),32*(12-o.y),32,32),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.usingCenterFly=!1}}}function pressKey(e){console.log("press key: "+e),e===_core__WEBPACK_IMPORTED_MODULE_2__.Ay.holdingKeys.slice(-1)[0]&&(console.log("key hold: "+e),keyDownImpl(e),setTimeout((function(){pressKey(e)}),30))}function keyDownHandler(e){if(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.started){console.log("key down keycode: "+e.keyCode),console.log("key down str: "+e.key),(0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.holdingKeys)||(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.holdingKeys=[]);var t=e.keyCode;if({37:!0,38:!0,39:!0,40:!0}[t]&&!_core__WEBPACK_IMPORTED_MODULE_2__.Ay.locked){console.log("is arrow and not locked");for(var _=0;_<_core__WEBPACK_IMPORTED_MODULE_2__.Ay.holdingKeys.length;_++)if(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.holdingKeys[_]===t)return;_core__WEBPACK_IMPORTED_MODULE_2__.Ay.holdingKeys.push(t),pressKey(t)}else console.log("not arrow or locked"),keyDownImpl(t)}}function keyUpAction(e){var t,_,o,n,a,i,r,s=null===(o=null===(_=null===(t=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===t?void 0:t.data)||void 0===_?void 0:_.current)||void 0===o?void 0:o.type;if(console.log("key up action type: "+s),console.log("key up action keyCode: "+e),console.log("key up action event: ",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event),"text"==s&&[13,32,67].includes(e))(0,_events__WEBPACK_IMPORTED_MODULE_4__.Eo)();else if("choices"==s){var l=null===(a=null===(n=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===n?void 0:n.data)||void 0===a?void 0:a.current,c=null==l?void 0:l.choices;console.log("key up choices : ",c),(0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(c)&&c.length>0&&[13,32,67].includes(e)&&(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.route.push("choices:"+(null===(i=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===i?void 0:i.selection)),(0,_events__WEBPACK_IMPORTED_MODULE_4__.qB)(c[null===(r=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===r?void 0:r.selection].action),(0,_events__WEBPACK_IMPORTED_MODULE_4__.Eo)())}}function keyUpConfirmBox(e){var t,_,o,n,a;console.log("key up confirm box: ",e),37==e&&(console.log("set selection to 0 here1\n"),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection=0,(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.UC)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.yes,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.no)),39==e&&(console.log("set selection to 1 here1\n"),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection=1,(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.UC)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.yes,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.no)),console.log("coreStatus.event?.selection: "+(null===(t=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===t?void 0:t.selection)),[13,32,67].includes(e)&&(0==(null===(_=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===_?void 0:_.selection)&&(0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(null===(o=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data)||void 0===o?void 0:o.yes)&&(console.log("confirm yes"),console.log("set selection to undefined here1\n"),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection=void 0,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.yes()),1==(null===(n=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===n?void 0:n.selection)&&(0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(null===(a=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data)||void 0===a?void 0:a.no)&&(console.log("confirm false"),console.log("set selection to undefined here2\n"),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection=void 0,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.no()))}function doEffect(e){console.log("do effect",e);var t=e.split("+=");if(2==t.length){var _=t[0],o=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.evalValue(t[1]);if(_.startsWith("status:")){var n=_.substring(7);_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerData[n]+=o}else if(_.startsWith("item:")){var a=_.substring(5);(0,_items__WEBPACK_IMPORTED_MODULE_9__.B5)(a,o)}}}function clickShop(x,y){console.log("click shop",x,y);var shop=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.shop;console.log("shop",shop);var choices=shop.choices;if(console.log("shop choices",choices),x>=5&&x<=7){var topIndex=6-(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)(choices.length/2);if(y>=topIndex&&y<topIndex+choices.length){console.log("set selection to y - topindx here",y-topIndex),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection=y-topIndex;var money=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerData.money,experience=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerData.exp,times=shop.times,need=eval(shop.need),use=shop.use,use_text="money"==use?_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("money"):_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("experience"),choice=choices[y-topIndex];if((0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(choice.need)&&(need=eval(choice.need)),need>eval(use))return(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.Qx)("".concat(_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("not_enough")).concat(use_text)),!1;_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.actions.push(y-topIndex),eval(use+"-="+need),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerData.money=money,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerData.exp=experience,choice.effect.split(";").forEach((function(e){doEffect(e)})),_status_bar__WEBPACK_IMPORTED_MODULE_7__.A.syncPlayerStatus(),shop.times++,(0,_events__WEBPACK_IMPORTED_MODULE_4__.zO)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.id)}else{if(y!=topIndex+choices.length)return!1;_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.actions.length>0&&_core__WEBPACK_IMPORTED_MODULE_2__.Ay.route.push("shop:"+_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.id+":"+_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.actions.join("")),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.actions=[],_core__WEBPACK_IMPORTED_MODULE_2__.Ay.boxAnimateObjs=[],(0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.fromList)?(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.U4)():(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.nH)()}}return!0}function keyUpShop(e){var t;if([27,88].includes(e))return(null===(t=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data)||void 0===t?void 0:t.actions.length)>0&&_core__WEBPACK_IMPORTED_MODULE_2__.Ay.route.push("shop:"+_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.id+":"+_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.actions.join("")),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.actions=[],_core__WEBPACK_IMPORTED_MODULE_2__.Ay.boxAnimateObjs=[],void((0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.fromList)?(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.U4)():(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.nH)());var _=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.shop.choices;[13,32,67].includes(e)&&clickShop(6,6-(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)(_.length/2)+_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection)}function clickFly(e,t){if(console.log("click fly",e,t),10!=e&&11!=e||9!=t||(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.sD)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.page-1),10!=e&&11!=e||5!=t||(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.sD)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.page+1),e>=5&&e<=7&&12==t&&(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.nH)(),e>=0&&e<=9&&t>=3&&t<=11){var _=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.page,o=_<_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerData.flyRange.indexOf(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.floorId)?_floor__WEBPACK_IMPORTED_MODULE_10__.ze.UPFLOOR:_floor__WEBPACK_IMPORTED_MODULE_10__.ze.DOWNFLOOR,n=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerData.flyRange[_];_core__WEBPACK_IMPORTED_MODULE_2__.Ay.route.push("fly:"+n),(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.nH)(),_floor__WEBPACK_IMPORTED_MODULE_10__.Ay.switchFloor(n,o)}}function keyUpFly(e){console.log("key up fly",e),[71,27,88].includes(e)&&(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.nH)(),[13,32,67].includes(e)&&clickFly(5,5)}function openSettings(e){void 0===e&&(e=!1),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.checkStatusSatisfiedAndSetEventId("settings",e)&&(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.IC)()}function keyDownSettings(e){console.log("key down settings",e),38==e&&(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection--,(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.vz)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.text,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.choices)),40==e&&(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection++,(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.vz)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.text,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.choices))}function keyUpSettings(e){if(console.log("key up settings",e),[27,88].includes(e))(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.nH)();else{var t=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.choices;if([13,32,67].includes(e))clickSettings(6,6-(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)((t.length-1)/2)+_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection)}}function keyDownSwitchs(e){console.log("key down switchs",e),console.log("key down switch event: ",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event),38==e&&(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection--,(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.vz)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.text,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.choices)),40==e&&(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection++,(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.vz)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.text,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.choices))}function keyUpSwitchs(e){if(console.log("key up switchs",e),console.log("key up switch event: ",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event),[27,88].includes(e))return _core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection=0,void(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.IC)();var t=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.choices;if([13,32,67].includes(e)){var _=6-(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)((t.length-1)/2);console.log("keyup switches topIndex",_),clickSwitchs(6,_+_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection)}}function clickSwitchs(e,t){if(console.log("click switchs",e,t),!(e<5||e>7)){var _=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.choices,o=6-(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)((_.length-1)/2);if(console.log("topIndex",o),t>=o&&t<o+_.length){var n=t-o;switch(console.log("selection",n),n){case 0:break;case 1:_config__WEBPACK_IMPORTED_MODULE_8__.Z4.showBattleAnimate=!_config__WEBPACK_IMPORTED_MODULE_8__.Z4.showBattleAnimate,(0,_util__WEBPACK_IMPORTED_MODULE_1__.ZB)("battleAnimate",_config__WEBPACK_IMPORTED_MODULE_8__.Z4.showBattleAnimate),(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.QX)();break;case 2:_config__WEBPACK_IMPORTED_MODULE_8__.Z4.displayEnemyDamage=!_config__WEBPACK_IMPORTED_MODULE_8__.Z4.displayEnemyDamage,(0,_events__WEBPACK_IMPORTED_MODULE_4__.H8)(),(0,_util__WEBPACK_IMPORTED_MODULE_1__.ZB)("enemyDamage",_config__WEBPACK_IMPORTED_MODULE_8__.Z4.displayEnemyDamage),(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.QX)();break;case 3:_config__WEBPACK_IMPORTED_MODULE_8__.Z4.displayExtraDamage=!_config__WEBPACK_IMPORTED_MODULE_8__.Z4.displayExtraDamage,(0,_events__WEBPACK_IMPORTED_MODULE_4__.H8)(),(0,_util__WEBPACK_IMPORTED_MODULE_1__.ZB)("extraDamage",_config__WEBPACK_IMPORTED_MODULE_8__.Z4.displayExtraDamage),(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.QX)();break;case 4:_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection=0,(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.IC)()}}}}function clickSettings(e,t){if(!(e<5||e>7)){var _=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.choices,o=6-(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)((_.length-1)/2);if(t>=o&&t<o+_.length)switch(t-o){case 0:_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection=0,(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.QX)();break;case 1:_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection=0,(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.U4)();break;case 2:_config__WEBPACK_IMPORTED_MODULE_8__.Z4.enableViewMaps?(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.m)("\t[系统提示]即将进入浏览地图模式。\n\n点击地图上半部分，或按[↑]键可查看前一张地图\n点击地图下半部分，或按[↓]键可查看后一张地图\n点击地图中间，或按[ESC]键可离开浏览地图模式\n此模式下可以打开怪物手册以查看某层楼的怪物属性",(function(){(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.SE)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.floorId)})):(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.Qx)("本塔不允许浏览地图！");break;case 3:case 5:(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.m)(_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("unimplemented"));break;case 4:_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection=1,(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.UC)("你确定要重新开始吗？",(function(){(0,_events__WEBPACK_IMPORTED_MODULE_4__.GG)()}),(function(){_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection=3,(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.IC)()}));break;case 6:(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.kX)();break;case 7:(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.EB)();break;case 8:(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.nH)()}}}function keyUp(e){var t;console.log("key up locked: "+_core__WEBPACK_IMPORTED_MODULE_2__.Ay.locked);var _=null===(t=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===t?void 0:t.id;if(console.log("key up event id: "+_),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.locked)return console.log("key up clear holding keys"),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.holdingKeys=[],"text"==_&&[13,32,67].includes(e)?void(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.m)():"confirmBox"==_?void keyUpConfirmBox(e):"shop"==_?void keyUpShop(e):"action"==_?void keyUpAction(e):"book"==_?void keyUpBook(e):"fly"==_?void keyUpFly(e):"switchs"==_?void keyUpSwitchs(e):"syncSave"==_?void keyUpSyncSave(e):"about"==_&&[13,32,67].includes(e)?void clickAbout():"localSaveSelect"==_?void keyUpLocalSaveSelect(e):"toolbox"==_?void keyUpToolBox(e):"settings"==_?void keyUpSettings(e):"viewMaps"==_?void keyUpViewMaps(e):"save"==_||"load"==_?void keyUpSL(e):"selectShop"==_?void keyUpQuickShop(e):"cursor"==_?void keyUpCursor(e):void 0;if(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.started){switch(e){case 27:_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerStop&&openSettings(!0);break;case 71:_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerStop&&(0,_events__WEBPACK_IMPORTED_MODULE_4__.yj)(!0);break;case 88:_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerStop&&(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.Ce)(!0);break;case 65:(0,_events__WEBPACK_IMPORTED_MODULE_4__.X4)("autoSave","load");break;case 83:_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerStop&&(0,_events__WEBPACK_IMPORTED_MODULE_4__.co)(!0);break;case 68:_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerStop&&(0,_events__WEBPACK_IMPORTED_MODULE_4__.zz)(!0);break;case 69:_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerData&&(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.tW)();break;case 84:_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerStop&&(0,_events__WEBPACK_IMPORTED_MODULE_4__._c)(!0);break;case 90:_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerStop&&(0,_events__WEBPACK_IMPORTED_MODULE_4__.X9)();break;case 75:_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerStop&&(0,_events__WEBPACK_IMPORTED_MODULE_4__.YL)(!0);break;case 72:!_core__WEBPACK_IMPORTED_MODULE_2__.Ay.locked&&_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerStop&&(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.kX)()}(0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.autoRoute)&&_core__WEBPACK_IMPORTED_MODULE_2__.Ay.autoRoute.enabled&&(0,_autoroute__WEBPACK_IMPORTED_MODULE_5__.Di)(),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerStop=!0}}function onKeyUp(e){console.log("on key up",e),console.log("on key up locked",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.locked),console.log("coreStatus.holdingKeys",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.holdingKeys);var t=e.keyCode;if([37,38,39,40].includes(t)&&!_core__WEBPACK_IMPORTED_MODULE_2__.Ay.locked){for(var _=0;_<_core__WEBPACK_IMPORTED_MODULE_2__.Ay.holdingKeys.length;_++){if(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.holdingKeys[_]==t&&(console.log("remove holding key: ",t),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.holdingKeys=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.holdingKeys.slice(0,_).concat(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.holdingKeys.slice(_+1)),console.log("after remove holding keys: ",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.holdingKeys),_==_core__WEBPACK_IMPORTED_MODULE_2__.Ay.holdingKeys.length&&0!==_core__WEBPACK_IMPORTED_MODULE_2__.Ay.holdingKeys.length)){var o=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.holdingKeys.slice(-1)[0];console.log("slice holding key: ",o),pressKey(o);break}}keyUp(t)}else keyUp(t)}function keyUpHandler(e){(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.started||_core__WEBPACK_IMPORTED_MODULE_2__.Ay.locked)&&onKeyUp(e)}function clickConfirmBox(e,t){var _,o,n,a;console.log("click confirm box",e,t),4!=e&&5!=e||7!=t||!(0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(null===(o=null===(_=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===_?void 0:_.data)||void 0===o?void 0:o.yes)||_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.yes(),7!=e&&8!=e||7!=t||!(0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(null===(a=null===(n=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===n?void 0:n.data)||void 0===a?void 0:a.no)||_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.no()}function onClick(e,t,_){var o,n,a,i,r,s,l,c,u,E,d,D,p,y,v,O,P,M,A,g;if(void 0===_&&(_=[]),console.log("on click: ("+e+","+t+")",_),console.log("current event: ",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event),!(e<0||t<0||e>12||t>12)){if(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.usingCenterFly){var h=(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.Yf)();if(e!=12-h.x||t!=12-h.y)(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.qO)("ui",32*(12-h.x),32*(12-h.y),32,32);else{if((0,_items__WEBPACK_IMPORTED_MODULE_9__.DM)("centerFly"))return(0,_items__WEBPACK_IMPORTED_MODULE_9__.H)("centerFly"),void(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.qO)("ui",32*(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.Yf)().x,32*(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.Yf)().y,32,32);(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.Qx)("当前不能使用中心对称飞行器"),(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.qO)("ui",32*(12-(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.Yf)().x),32*(12-(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.Yf)().y),32,32)}_core__WEBPACK_IMPORTED_MODULE_2__.Ay.usingCenterFly=!1}if(!_core__WEBPACK_IMPORTED_MODULE_2__.Ay.locked)return console.log("onclick control unlocked"),void(0,_autoroute__WEBPACK_IMPORTED_MODULE_5__.Jc)(e,t,_);console.log("onclick control locked"),"book"!=(null===(o=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===o?void 0:o.id)?"book-detail"!=(null===(n=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===n?void 0:n.id)?"fly"!=(null===(a=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===a?void 0:a.id)?"viewMaps"!=(null===(i=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===i?void 0:i.id)?"switchs"!=(null===(r=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===r?void 0:r.id)?"settings"!=(null===(s=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===s?void 0:s.id)?"shop"!=(null===(l=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===l?void 0:l.id)?"selectShop"!=(null===(c=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===c?void 0:c.id)?"toolbox"!=(null===(u=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===u?void 0:u.id)?"save"!=(null===(E=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===E?void 0:E.id)&&"load"!=(null===(d=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===d?void 0:d.id)?"confirmBox"!=(null===(D=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===D?void 0:D.id)?"keyBoard"!=(null===(p=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===p?void 0:p.id)&&("about"!=(null===(y=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===y?void 0:y.id)?"action"!=(null===(v=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===v?void 0:v.id)?"text"!=(null===(O=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===O?void 0:O.id)?"syncSave"!=(null===(P=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===P?void 0:P.id)?"syncSelect"!=(null===(M=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===M?void 0:M.id)&&("localSaveSelect"!=(null===(A=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===A?void 0:A.id)?"cursor"!=(null===(g=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===g?void 0:g.id)||clickCursor(e,t):clickLocalSaveSelect(e,t)):alert("暂不支持"):(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.m)():clickAction(e,t):clickAbout(e,t)):clickConfirmBox(e,t):clickSL(e,t):clickToolbox(e,t):clickQuickShop(e,t):clickShop(e,t):clickSettings(e,t):clickSwitchs(e,t):clickViewMaps(e,t):clickFly(e,t):clickBookDetail():clickBook(e,t)}}function clickAction(e,t){var _,o,n,a,i;if(console.log("clickAction: ("+e+","+t+")"),console.log("clickAction event",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event),"text"==(null===(o=null===(_=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===_?void 0:_.data)||void 0===o?void 0:o.type))return console.log("clickAction find event text, do action"),void(0,_events__WEBPACK_IMPORTED_MODULE_4__.Eo)();if("choices"==(null===(i=null===(a=null===(n=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===n?void 0:n.data)||void 0===a?void 0:a.current)||void 0===i?void 0:i.type)){var r=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.current.choices;if(0==r.length)return;if(console.log("clickAction find event choices",r),e>=5&&e<=7){t=(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)(t);var s=6-(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)((r.length-1)/2);t>=s&&t<s+r.length&&(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.route.push("choices:"+(t-s)),console.log("y - topIndex: ",t-s),(0,_events__WEBPACK_IMPORTED_MODULE_4__.qB)(r[t-s].action),(0,_events__WEBPACK_IMPORTED_MODULE_4__.Eo)())}}}function bookOnClickHandler(){console.log("bookOnClickHandler"),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.started&&(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.Ce)(!0)}function keyDownSyncSave(e){38==e&&(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection--,(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.vz)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.text,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.choices)),40==e&&(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection++,(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.vz)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.text,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.choices))}function keyUpSyncSave(e){if([27,88].includes(e))return _core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection=2,void(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.IC)();var t=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.choices;[13,32,67].includes(e)&&clickSyncSave(6,6-(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)((t.length-1)/2)+_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection)}function clickSyncSave(e,t){if(!(e<5||e>7)){var _=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.choices,o=6-(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)((_.length-1)/2);if(t>=o&&t<o+_.length)switch(t-o){case 0:_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection=0,(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.xz)();break;case 1:(0,_events__WEBPACK_IMPORTED_MODULE_4__.pi)((function(e){if(e.name==_config__WEBPACK_IMPORTED_MODULE_8__.Z4.name)if(e.version==_config__WEBPACK_IMPORTED_MODULE_8__.Z4.version)if((0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(e.data)){var t=e.data;if(t instanceof Array)(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.UC)("所有本地存档都将被覆盖，确认？",(function(){for(var e=1;e<=150;e++)e<=t.length?(0,_util__WEBPACK_IMPORTED_MODULE_1__.ZB)("save"+e,t[e-1]):(0,_util__WEBPACK_IMPORTED_MODULE_1__.$1)("save"+e);(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.m)("读取成功！\n你的本地所有存档均已被覆盖。")}),(function(){_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection=0,(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.vf)()}));else{for(var _=150,o=150;o>=1&&!(0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)((0,_util__WEBPACK_IMPORTED_MODULE_1__.Lg)("save"+o,void 0));o--)_=o;(0,_util__WEBPACK_IMPORTED_MODULE_1__.ZB)("save"+_,t),(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.m)("同步成功！\n单存档已覆盖至存档"+_)}}else alert("无效的存档！");else alert("游戏版本不一致！");else alert("存档和游戏不一致！")}));break;case 6:_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection=3,(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.IC)()}}}function clickAbout(e,t){_core__WEBPACK_IMPORTED_MODULE_2__.Ay.started?(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.nH)():_menu__WEBPACK_IMPORTED_MODULE_11__.A.show()}function keyDownLocalSaveSelect(e){}function keyUpLocalSaveSelect(e){}function clickLocalSaveSelect(e,t){}function toolBoxOnClickHandler(){_core__WEBPACK_IMPORTED_MODULE_2__.Ay.started&&(0,_events__WEBPACK_IMPORTED_MODULE_4__._c)(!0)}function keyDownToolBox(e){var t,_;if(console.log("keyDownToolBox",e),console.log("keyDownToolBox event",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event),(0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(null===(_=null===(t=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===t?void 0:t.data)||void 0===_?void 0:_.id)){var o=Object.keys(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerData.items.tools).sort(),n=Object.keys(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerData.items.constants).sort(),a=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection;if(console.log("tool box index: ",a),37==e){if(a>0&&a<100||a>100)return void clickToolboxIndex(a-1);if(100==a&&o.length>0)return void clickToolboxIndex(o.length-1)}if(38==e){if(a>5&&a<100||a>105)return void clickToolboxIndex(a-6);if(a>=100&&a<=105)return void(o.length>6?clickToolboxIndex(Math.min(o.length-1,a-100+6)):o.length>0&&clickToolboxIndex(Math.min(o.length-1,a-100)))}if(39==e){if(a<o.length-1||a>=100&&a<n.length+100)return void clickToolboxIndex(a+1);if(a==o.length-1&&n.length>0)return void clickToolboxIndex(100)}if(40==e){if(a<=5)return void(o.length>6?clickToolboxIndex(Math.min(o.length-1,a+6)):n.length>0&&clickToolboxIndex(100+Math.min(n.length-1,a)));if(a>5&&a<100&&n.length>0)return void clickToolboxIndex(100+Math.min(n.length-1,a-6));if(a>=100&&a<=105&&n.length>6)return void clickToolboxIndex(Math.min(100+n.length-1,a+6))}}}function keyUpToolBox(e){var t,_,o,n;if(console.log("keyUpToolBox",e),console.log("keyUpToolBox event",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event),[27,84,88].includes(e))(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.nH)();else if((0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(null===(_=null===(t=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===t?void 0:t.data)||void 0===_?void 0:_.id))if([13,32,67].includes(e))clickToolboxIndex(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection);else if(46==e){if(!(0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(null===(n=null===(o=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===o?void 0:o.data)||void 0===n?void 0:n.id))return;return(0,_items__WEBPACK_IMPORTED_MODULE_9__.Ai)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.id),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.id=void 0,void(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.iH)()}}function clickToolbox(e,t){var _,o;if(e>=10&&e<=12&&12==t)(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.nH)();else{if(e>=10&&e<=12&&t<=1){if(!(0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(null===(o=null===(_=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===_?void 0:_.data)||void 0===o?void 0:o.id))return;return(0,_items__WEBPACK_IMPORTED_MODULE_9__.Ai)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.id),_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.id=void 0,void(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.iH)()}var n=0;n=4==t||5==t||9==t||10==t?(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)(e/2):6+(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)(e/2),t>=9&&(n+=100),clickToolboxIndex(n)}}function clickToolboxIndex(e){var t,_;console.log("clickToolboxIndex",e);var o=void 0,n=e;if(n<100?o=Object.keys(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerData.items.tools).sort():(n-=100,o=Object.keys(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.playerData.items.constants).sort()),console.log("items",o),null!=o&&!(n>=o.length)){var a=o[n];a==(null===(_=null===(t=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===t?void 0:t.data)||void 0===_?void 0:_.id)?(0,_items__WEBPACK_IMPORTED_MODULE_9__.So)(a):(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.iH)(e)}}function settingsOnClickHandler(){_core__WEBPACK_IMPORTED_MODULE_2__.Ay.started&&openSettings(!0)}function keyUpViewMaps(e){console.log("keyUpViewMaps",e),console.log("keyUpViewMaps event",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event),[13,27,32,67].includes(e)&&((0,_canvas__WEBPACK_IMPORTED_MODULE_3__.qO)("data"),(0,_dom__WEBPACK_IMPORTED_MODULE_13__.Ko)("data",1),(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.nH)()),88==e&&(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.Ce)(!1)}function keyDownViewMaps(e){console.log("keyDownViewMaps",e),console.log("keyDownViewMaps event",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event),[33,37,38].includes(e)?(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.SE)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.index+1):[34,39,40].includes(e)&&(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.SE)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.index-1)}function clickViewMaps(e,t){console.log("clickViewMaps",e,t),console.log("clickViewMaps event",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event),t<=4?(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.SE)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.index+1):t>=8?(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.SE)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.index-1):((0,_canvas__WEBPACK_IMPORTED_MODULE_3__.qO)("data"),(0,_dom__WEBPACK_IMPORTED_MODULE_13__.Ko)("data",1),(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.nH)())}function keyDownSL(e){console.log("keyDownSL",e),console.log("keyDownSL event",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event);var t=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.index,_=(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)(t/10),o=t%10;37!=e?38!=e?39!=e?40!=e?33!=e?34!=e||(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.kQ)(10*(_+1)+o):(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.kQ)(10*(_-1)+o):o>=3?(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.kQ)(10*(_+1)+o-3):(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.kQ)(t+3):5==o?(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.kQ)(10*(_+1)+1):(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.kQ)(t+1):o<3?(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.kQ)(10*(_-1)+o+3):(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.kQ)(t-3):0==o?(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.kQ)(10*(_-1)+5):(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.kQ)(t-1)}function keyUpSL(e){console.log("keyUpSL",e),console.log("keyUpSL event",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event);var t=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.index,_=(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)(t/10),o=t%10;if([27,88].includes(e)||"save"==_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.id&&83==e||"load"==_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.id&&68==e)return(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.nH)(),void(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.started||_menu__WEBPACK_IMPORTED_MODULE_11__.A.show());[13,32,67].includes(e)&&(0==o?(0,_events__WEBPACK_IMPORTED_MODULE_4__.X4)("autoSave",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.id):(0,_events__WEBPACK_IMPORTED_MODULE_4__.X4)(5*_+o,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.id))}function clickSL(e,t){console.log("clickSL",e,t),console.log("clickSL event",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event);var _=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.index,o=(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)(_/10),n=_%10;if(3!=e&&4!=e||12!=t||(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.kQ)(10*(o-1)+n),8!=e&&9!=e||12!=t||(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.kQ)(10*(o+1)+n),e>=10&&e<=12&&12==t)return(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.nH)(),void(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.started||_menu__WEBPACK_IMPORTED_MODULE_11__.A.show());_=6*o+1,t>=1&&t<=4&&(e>=1&&e<=3&&(0,_events__WEBPACK_IMPORTED_MODULE_4__.X4)("autoSave",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.id),e>=5&&e<=7&&(0,_events__WEBPACK_IMPORTED_MODULE_4__.X4)(5*o+1,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.id),e>=9&&e<=11&&(0,_events__WEBPACK_IMPORTED_MODULE_4__.X4)(5*o+2,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.id)),t>=7&&t<=10&&(e>=1&&e<=3&&(0,_events__WEBPACK_IMPORTED_MODULE_4__.X4)(5*o+3,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.id),e>=5&&e<=7&&(0,_events__WEBPACK_IMPORTED_MODULE_4__.X4)(5*o+4,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.id),e>=9&&e<=11&&(0,_events__WEBPACK_IMPORTED_MODULE_4__.X4)(5*o+5,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.id))}function keyDownQuickShop(e){console.log("keyDownQuickShop",e),console.log("keyDownQuickShop event",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event),38==e&&(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection--,(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.vz)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.text,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.choices)),40==e&&(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection++,(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.vz)(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.text,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.ui.choices))}function keyUpQuickShop(e){if(console.log("keyUpQuickShop",e),console.log("keyUpQuickShop event",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event),[27,75,88].includes(e))(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.nH)();else{var t=(0,_shops__WEBPACK_IMPORTED_MODULE_12__.TW)();if([13,32,67].includes(e))clickQuickShop(6,6-(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)(t.length/2)+_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.selection)}}function clickQuickShop(e,t){var _;console.log("clickQuickShop",e,t),console.log("clickQuickShop event",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event);var o=(0,_shops__WEBPACK_IMPORTED_MODULE_12__.TW)();if(e>=5&&e<=7){var n=6-(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)(o.length/2);if(t>=n&&t<n+o.length){var a=(0,_events__WEBPACK_IMPORTED_MODULE_4__.BV)();if((0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(a))return void(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.m)(a);(0,_events__WEBPACK_IMPORTED_MODULE_4__.zO)(o[t-n],!0),"shop"==(null===(_=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event)||void 0===_?void 0:_.id)&&(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event.data.fromList=!0)}else t==n+o.length&&(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.nH)()}}function onmove(e,t){if(0!=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.stepPostFix.length){for(var _={x:e,y:t},o=_core__WEBPACK_IMPORTED_MODULE_2__.Ay.stepPostFix[_core__WEBPACK_IMPORTED_MODULE_2__.Ay.stepPostFix.length-1],n=[_.y-o.y,o.x-_.x,o.y-_.y,_.x-o.x],a=0,i=4,r=0;r<4;r++)n[r]>a&&(i=r,a=n[r]);_=[{x:0,y:1},{x:-1,y:0},{x:0,y:-1},{x:1,y:0},void 0][i],(0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(_)&&(_.x+=o.x,_.y+=o.y,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.stepPostFix.push(_),(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.SM)(_))}}function onMouseMoveHandler(e){console.log("onmousemove started: ",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.started),console.log("onmousemove event: ",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event);try{e.stopPropagation();var t=getClickLoc(e.clientX,e.clientY);if(!(0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(t))return;onmove((0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)(t.x/t.size),(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)(t.y/t.size))}catch(e){console.error(e)}}function onTouchMoveHandler(e){try{e.preventDefault();var t=getClickLoc(e.targetTouches[0].clientX,e.targetTouches[0].clientY);if(!(0,_util__WEBPACK_IMPORTED_MODULE_1__.DQ)(t))return;onmove((0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)(t.x/t.size),(0,_util__WEBPACK_IMPORTED_MODULE_1__.RI)(t.y/t.size))}catch(e){console.error(e)}}function noteBookOnClickHandler(){_core__WEBPACK_IMPORTED_MODULE_2__.Ay.started&&(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.m)(_i18n__WEBPACK_IMPORTED_MODULE_6__.A.t("unimplemented"))}function keyDownCursor(e){return 37==e?(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.autoRoute.cursorX--,void(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.tW)()):38==e?(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.autoRoute.cursorY--,void(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.tW)()):39==e?(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.autoRoute.cursorX++,void(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.tW)()):40==e?(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.autoRoute.cursorY++,void(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.tW)()):void 0}function keyUpCursor(e){if(![27,88].includes(e))return[13,32,67,69].includes(e)?((0,_canvas__WEBPACK_IMPORTED_MODULE_3__.nH)(),void onClick(_core__WEBPACK_IMPORTED_MODULE_2__.Ay.autoRoute.cursorX,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.autoRoute.cursorY,[])):void 0;(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.nH)()}function clickCursor(e,t){if(console.log("clickCursor",e,t),console.log("clickCursor event",_core__WEBPACK_IMPORTED_MODULE_2__.Ay.event),e==_core__WEBPACK_IMPORTED_MODULE_2__.Ay.autoRoute.cursorX&&t==_core__WEBPACK_IMPORTED_MODULE_2__.Ay.autoRoute.cursorY)return(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.nH)(),void onClick(e,t,[]);_core__WEBPACK_IMPORTED_MODULE_2__.Ay.autoRoute.cursorX=e,_core__WEBPACK_IMPORTED_MODULE_2__.Ay.autoRoute.cursorY=t,(0,_canvas__WEBPACK_IMPORTED_MODULE_3__.tW)()}},224:(e,t,_)=>{_.d(t,{Ai:()=>g,B5:()=>O,DB:()=>p,DM:()=>A,H:()=>f,H9:()=>C,Md:()=>P,Ro:()=>v,SO:()=>M,So:()=>h,bm:()=>m,ey:()=>I,gt:()=>y});var o=_(28),n=_(197),a=_(250),i=_(462),r=_(883),s=_(746),l=_(578),c=_(530),u=_(795),E=_(137),d=_(571),D={};function p(){D={yellowKey:{cls:"keys",name:"黄钥匙"},blueKey:{cls:"keys",name:"蓝钥匙"},redKey:{cls:"keys",name:"红钥匙"},greenKey:{cls:"keys",name:"绿钥匙"},redJewel:{cls:"items",name:"红宝石"},blueJewel:{cls:"items",name:"蓝宝石"},greenJewel:{cls:"items",name:"绿宝石"},yellowJewel:{cls:"items",name:"黄宝石"},redPotion:{cls:"items",name:"红血瓶"},bluePotion:{cls:"items",name:"蓝血瓶"},yellowPotion:{cls:"items",name:"黄血瓶"},greenPotion:{cls:"items",name:"绿血瓶"},sword1:{cls:"items",name:"铁剑"},sword2:{cls:"items",name:"银剑"},sword3:{cls:"items",name:"骑士剑"},sword4:{cls:"items",name:"圣剑"},sword5:{cls:"items",name:"神圣剑"},shield1:{cls:"items",name:"铁盾"},shield2:{cls:"items",name:"银盾"},shield3:{cls:"items",name:"骑士盾"},shield4:{cls:"items",name:"圣盾"},shield5:{cls:"items",name:"神圣盾"},superPotion:{cls:"items",name:"圣水"},moneyPocket:{cls:"items",name:"金钱袋"},sword0:{cls:"constants",name:"折断的剑",text:"没有任何作用的剑，相当于脱掉装备。"},shield0:{cls:"constants",name:"残破的盾",text:"没有任何作用的盾，相当于脱掉装备。"},book:{cls:"constants",name:"怪物手册",text:"可以查看当前楼层各怪物属性"},fly:{cls:"constants",name:"楼层传送器",text:"可以自由往来去过的楼层"},coin:{cls:"items",name:"幸运金币"},snow:{cls:"constants",name:"冰冻徽章",text:"可以将四周的熔岩变成平地"},cross:{cls:"constants",name:"十字架",text:"仙子所需要的十字架"},knife:{cls:"constants",name:"屠龙匕首",text:"该道具尚未被定义"},shoes:{cls:"constants",name:"绿鞋",text:"持有时无视负面地形"},wand1:{cls:"constants",name:"火之法杖",text:"封印Boss需要的物品之一"},wand2:{cls:"constants",name:"冰之法杖",text:"封印Boss需要的物品之一"},bigKey:{cls:"tools",name:"大黄门钥匙",text:"可以开启当前层所有黄门"},steelKey:{cls:"tools",name:"铁门钥匙",text:"可以打开一扇铁门"},pickaxe:{cls:"tools",name:"破墙镐",text:"可以破坏勇士面前的墙"},icePickaxe:{cls:"constants",name:"锄头",text:"小偷需要的锄头"},bomb:{cls:"tools",name:"炸弹",text:"可以炸掉勇士面前的怪物"},centerFly:{cls:"items",name:"小飞羽"},bigFly:{cls:"items",name:"大飞羽"},upFly:{cls:"tools",name:"上楼器",text:"可以飞往楼上的相同位置"},downFly:{cls:"tools",name:"下楼器",text:"可以飞往楼下的相同位置"},earthquake:{cls:"tools",name:"地震卷轴",text:"可以破坏当前层的所有墙"},poisonWine:{cls:"tools",name:"解毒药水",text:"可以解除中毒状态"},weakWine:{cls:"tools",name:"解衰药水",text:"可以解除衰弱状态"},curseWine:{cls:"tools",name:"解咒药水",text:"可以解除诅咒状态"},superWine:{cls:"tools",name:"万能药水",text:"可以解除所有不良状态"},hammer:{cls:"tools",name:"圣锤",text:"可以炸掉勇士面前的怪物"}},o.Z4.bigKeyIsBox&&(D.bigKey={cls:"items",name:"钥匙盒"}),o.Z4.pickaxeFourDirections&&(D.pickaxe.text="可以破坏勇士四周的墙"),o.Z4.bombFourDirections&&(D.bomb.text="可以炸掉勇士四周的怪物"),o.Z4.equipmentDirectly||(D.sword1={cls:"constants",name:"铁剑",text:"一把很普通的铁剑，攻击+"+o.Z4.sword1},D.sword2={cls:"constants",name:"银剑",text:"一把很普通的银剑，攻击+"+o.Z4.sword2},D.sword3={cls:"constants",name:"骑士剑",text:"一把很普通的骑士剑，攻击+"+o.Z4.sword3},D.sword4={cls:"constants",name:"圣剑",text:"一把很普通的圣剑，攻击+"+o.Z4.sword4},D.sword5={cls:"constants",name:"神圣剑",text:"一把很普通的神圣剑，攻击+"+o.Z4.sword5},D.shield1={cls:"constants",name:"铁盾",text:"一个很普通的铁盾，防御+"+o.Z4.shield1},D.shield2={cls:"constants",name:"银盾",text:"一个很普通的银盾，防御+"+o.Z4.shield2},D.shield3={cls:"constants",name:"骑士盾",text:"一个很普通的骑士盾，防御+"+o.Z4.shield3},D.shield4={cls:"constants",name:"圣盾",text:"一个很普通的圣盾，防御+"+o.Z4.shield4},D.shield5={cls:"constants",name:"神圣盾",text:"一个很普通的神圣盾，防御+"+o.Z4.shield5})}function y(e){return D[e]}function v(e){return"redJewel"==e?"，攻击+"+o.Z4.redJewel:"blueJewel"==e?"，防御+"+o.Z4.blueJewel:"greenJewel"==e?"，魔防+"+o.Z4.greenJewel:"yellowJewel"==e?"，全属性提升":"redPotion"==e?"，生命+"+o.Z4.redPotion:"bluePotion"==e?"，生命+"+o.Z4.bluePotion:"yellowPotion"==e?"，生命+"+o.Z4.yellowPotion:"greenPotion"==e?"，生命+"+o.Z4.greenPotion:"centerFly"==e?"，等级+1":"bigFly"==e?"，等级+3":o.Z4.equipmentDirectly||"sword1"!=e?o.Z4.equipmentDirectly||"sword2"!=e?o.Z4.equipmentDirectly||"sword3"!=e?o.Z4.equipmentDirectly||"sword4"!=e?o.Z4.equipmentDirectly||"sword5"!=e?o.Z4.equipmentDirectly||"shield1"!=e?o.Z4.equipmentDirectly||"shield2"!=e?o.Z4.equipmentDirectly||"shield3"!=e?o.Z4.equipmentDirectly||"shield4"!=e?o.Z4.equipmentDirectly||"shield5"!=e?"bigKey"===e?"，全钥匙+1":"superPotion"===e?"，生命值翻倍":"coin"==e?"，金币+"+o.Z4.moneyPocket:"":"，防御+"+o.Z4.shield5:"，防御+"+o.Z4.shield4:"，防御+"+o.Z4.shield3:"，防御+"+o.Z4.shield2:"，防御+"+o.Z4.shield1:"，攻击+"+o.Z4.sword5:"，攻击+"+o.Z4.sword4:"，攻击+"+o.Z4.sword3:"，攻击+"+o.Z4.sword2:"，攻击+"+o.Z4.sword1}function O(e,t){void 0===t&&(t=1),console.log("addItem ".concat(e," ").concat(t));var _=D[e],o=_.cls;console.log("add item:",_),console.log("add itemCls:",o),"items"!=o&&("yellowKey"===e?n.Ay.playerData.items.keys.yellowKey+=t:"blueKey"===e?n.Ay.playerData.items.keys.blueKey+=t:"redKey"===e?n.Ay.playerData.items.keys.redKey+=t:"greenKey"===e?n.Ay.playerData.items.keys.greenKey+=t:(console.log("addItem nonkeys"),e in n.Ay.playerData.items[o]?n.Ay.playerData.items[o][e]+=t:n.Ay.playerData.items[o][e]=1))}function P(e,t){void 0===t&&(t=1),console.log("useItemEffectDirectly ".concat(e," ").concat(t));var _=D[e].cls;console.log("item",D[e]),console.log("itemCls",_),"items"===_?("redJewel"===e&&(n.Ay.playerData.attack+=o.Z4.redJewel),"blueJewel"===e&&(n.Ay.playerData.defense+=o.Z4.blueJewel),"greenJewel"===e&&(n.Ay.playerData.money+=o.Z4.greenJewel),"yellowJewel"===e&&(n.Ay.playerData.hp+=1e3,n.Ay.playerData.attack+=10,n.Ay.playerData.defense+=10),"redPotion"===e&&(n.Ay.playerData.hp+=o.Z4.redPotion),"bluePotion"===e&&(n.Ay.playerData.hp+=o.Z4.bluePotion),"yellowPotion"===e&&(n.Ay.playerData.hp+=o.Z4.yellowPotion),"greenPotion"===e&&(n.Ay.playerData.hp+=o.Z4.greenPotion),"sword1"==e&&(console.log("sword1 add to attack",o.Z4.sword1),n.Ay.playerData.attack+=o.Z4.sword1),"sword2"==e&&(n.Ay.playerData.attack+=o.Z4.sword2),"sword3"==e&&(n.Ay.playerData.attack+=o.Z4.sword3),"sword4"==e&&(n.Ay.playerData.attack+=o.Z4.sword4),"sword5"==e&&(n.Ay.playerData.attack+=o.Z4.sword5),"shield1"==e&&(n.Ay.playerData.defense+=o.Z4.shield1),"shield2"==e&&(n.Ay.playerData.defense+=o.Z4.shield2),"shield3"==e&&(n.Ay.playerData.defense+=o.Z4.shield3),"shield4"==e&&(n.Ay.playerData.defense+=o.Z4.shield4),"shield5"==e&&(n.Ay.playerData.defense+=o.Z4.shield5),"centerFly"==e&&(n.Ay.playerData.level++,n.Ay.playerData.hp+=1e3,n.Ay.playerData.attack+=10,n.Ay.playerData.defense+=10),"bigFly"==e&&(n.Ay.playerData.level+=3,n.Ay.playerData.hp+=3e3,n.Ay.playerData.attack+=35,n.Ay.playerData.defense+=35),"bigKey"===e&&(n.Ay.playerData.items.keys.yellowKey++,n.Ay.playerData.items.keys.blueKey++,n.Ay.playerData.items.keys.redKey++,n.Ay.playerData.items.keys.greenKey++),"superPotion"==e&&(n.Ay.playerData.hp*=2),"coin"==e&&(n.Ay.playerData.money+=o.Z4.moneyPocket)):O(e,t)}function M(e,t){console.log("setItem ".concat(e," ").concat(t));var _=D[e].cls;if("items"!=_)if(_){var o=n.Ay.playerData.items[_];o[e]=t}else console.error("itemCls ".concat(_," is not a valid key of PlayerItems"))}function A(e){var t,_,i,r,l,c,u,D,p,y,v;if(console.log("canUseItem ".concat(e)),!n.Ay.hasItem(e))return!1;if("book"==e)return!0;if("fly"==e)return n.Ay.playerData.flyRange.indexOf(n.Ay.floorId)>=0;if("pickaxe"==e){for(var O=[],P=0;P<n.Ay.mapData.blocks.length;P++){var M=n.Ay.mapData.blocks[P];!(0,s.DQ)(M.event)||(0,s.DQ)(M.enable)&&!M.enable||"yellowWall"!=(null===(t=M.event)||void 0===t?void 0:t.id)&&"whiteWall"!=(null===(_=M.event)||void 0===_?void 0:_.id)&&"blueWall"!=(null===(i=M.event)||void 0===i?void 0:i.id)||(o.Z4.pickaxeFourDirections?Math.abs(M.x-(0,a.Yf)().x)+Math.abs(M.y-(0,a.Yf)().y)<=1&&O.push(P):M.x==n.Ay.nextX()&&M.y==n.Ay.nextY()&&O.push(P))}return O.length>0&&(n.Ay.event.data.ids=O,!0)}if("icePickaxe"==e){for(P=0;P<n.Ay.mapData.blocks.length;P++){M=n.Ay.mapData.blocks[P];if((0,s.DQ)(M.event)&&(!(0,s.DQ)(M.enable)||M.enable)&&M.x==n.Ay.nextX()&&M.y==n.Ay.nextY()&&"ice"==(null===(r=M.event)||void 0===r?void 0:r.id))return n.Ay.event.data.ids=[P],!0}return!1}if("bomb"==e){for(O=[],P=0;P<n.Ay.mapData.blocks.length;P++){M=n.Ay.mapData.blocks[P];if((0,s.DQ)(M.event)&&(!(0,s.DQ)(M.enable)||M.enable)&&"enemys"==(null===(l=M.event)||void 0===l?void 0:l.cls)&&Math.abs(M.x-(0,a.Yf)().x)+Math.abs(M.y-(0,a.Yf)().y)<=1){var A=(0,d.DD)(M.event.id);if((0,s.DQ)(A.bomb)&&!A.bomb)continue;(o.Z4.bombFourDirections||M.x==n.Ay.nextX()&&M.y==n.Ay.nextY())&&O.push(P)}}return O.length>0&&(n.Ay.event.data.ids=O,!0)}if("hammer"==e){for(P=0;P<n.Ay.mapData.blocks.length;P++){M=n.Ay.mapData.blocks[P];if((0,s.DQ)(M.event)&&(!(0,s.DQ)(M.enable)||M.enable)&&"enemys"==(null===(c=M.event)||void 0===c?void 0:c.cls)&&M.x==n.Ay.nextX()&&M.y==n.Ay.nextY()){A=(0,d.DD)(M.event.id);if((0,s.DQ)(A.bomb)&&!A.bomb)continue;return n.Ay.event.data.ids=[P],!0}}return!1}if("earthquake"==e){for(O=[],P=0;P<n.Ay.mapData.blocks.length;P++){M=n.Ay.mapData.blocks[P];!(0,s.DQ)(M.event)||(0,s.DQ)(M.enable)&&!M.enable||"yellowWall"!=(null===(u=M.event)||void 0===u?void 0:u.id)&&"blueWall"!=(null===(D=M.event)||void 0===D?void 0:D.id)&&"whiteWall"!=(null===(p=M.event)||void 0===p?void 0:p.id)||O.push(P)}return O.length>0&&(n.Ay.event.data.ids=O,!0)}if("centerFly"==e){var g=12-(0,a.Yf)().x,h=12-(0,a.Yf)().y;M=(0,a.gd)(g,h);return!(0,s.DQ)(M)&&(n.Ay.event.data={list:[],x:g,y:h},!0)}if("upFly"==e){if((m=n.Ay.floorId)==E.Ay.getAllFloorIds().length-1)return!1;var f=m+1;g=(0,a.Yf)().x,h=(0,a.Yf)().y,M=(0,a.gd)(g,h,f);return!(0,s.DQ)(M)&&(n.Ay.event.data={list:[],id:f.toString(),x:g,y:h},!0)}if("downFly"==e){var m;if(0==(m=n.Ay.floorId))return!1;f=m-1,g=(0,a.Yf)().x,h=(0,a.Yf)().y,M=(0,a.gd)(g,h,f);return!(0,s.DQ)(M)&&(n.Ay.event.data={list:[],id:f.toString(),x:g,y:h},!0)}if("snow"==e){for(O=[],P=0;P<n.Ay.mapData.blocks.length;P++){M=n.Ay.mapData.blocks[P];(0,s.DQ)(M.event)&&(!(0,s.DQ)(M.enable)||M.enable)&&"lava"==(null===(y=M.event)||void 0===y?void 0:y.id)&&Math.abs(M.x-n.Ay.playerData.loc.x)+Math.abs(M.y-n.Ay.playerData.loc.y)<=1&&O.push(P)}return O.length>0&&(n.Ay.event.data.ids=O,!0)}if("bigKey"==e){for(O=[],P=0;P<n.Ay.mapData.blocks.length;P++){M=n.Ay.mapData.blocks[P];!(0,s.DQ)(M.event)||(0,s.DQ)(M.enable)&&!M.enable||"yellowDoor"!=(null===(v=M.event)||void 0===v?void 0:v.id)||O.push(P)}return O.length>0&&(n.Ay.event.data.ids=O,!0)}return"poisonWine"==e?n.Ay.hasFlag("poison"):"weakWine"==e?n.Ay.hasFlag("weak"):"curseWine"==e?n.Ay.hasFlag("curse"):"superWine"==e&&(n.Ay.hasFlag("poison")||n.Ay.hasFlag("weak")||n.Ay.hasFlag("curse"))}function g(e){if(!n.Ay.hasItem(e))return!1;var t=D[e].cls;return n.Ay.playerData.items[t][e]--,l.A.syncPlayerStatus(),!0}function h(e){if((0,a.nH)(),"book"!=e)if("fly"!=e){if("centerFly"==e){n.Ay.usingCenterFly=!0;var t="rgba(255,0,0,0.5)";return A("centerFly")&&(t="rgba(0,255,0,0.5)"),(0,a.GZ)("ui",32*(12-(0,a.Yf)().x),32*(12-(0,a.Yf)().y),32,32,t),void(0,a.Qx)(r.A.t("center_fly_failed"))}A(e)?f(e):(0,a.Qx)(r.A.t("use_item_failed")+D[e].name)}else(0,u.yj)(!1);else(0,a.Ce)(!1)}function f(e,t){if(console.log("useItem ".concat(e)),!A(e))return console.log("can not use item ".concat(e)),void((0,s.DQ)(t)&&t());var _=D[e].cls;if(console.log("item",D[e]),console.log("item cls",_),"book"==e&&(0,a.ME)(0),"fly"==e&&(0,a.sD)(n.Ay.playerData.flyRange.indexOf(n.Ay.floorId)),"earthquake"!=e&&"bomb"!=e&&"pickaxe"!=e&&"icePickaxe"!=e&&"snow"!=e&&"hammer"!=e&&"bigKey"!=e||((0,a.H_)(n.Ay.floorId,n.Ay.event.data.ids),(0,i.J5)(n.Ay.floorId,(function(){var t=(0,a.Yf)();(0,a.ut)(t.direction,t.x,t.y,"stop"),(0,u.H8)(),(0,a.Qx)(r.A.t("use_item")+D[e].name)}))),"centerFly"==e){(0,a.qO)("player"),n.Ay.playerData.loc.x=n.Ay.event.data.x,n.Ay.playerData.loc.y=n.Ay.event.data.y;var E=(0,a.Yf)();(0,a.ut)(E.direction,E.x,E.y,"stop"),(0,a.Qx)(r.A.t("use_item")+D[e].name)}"upFly"!=e&&"downFly"!=e||c.Ay.switchFloor(parseInt(n.Ay.event.data.id),void 0,{direction:n.Ay.playerData.loc.direction,x:n.Ay.event.data.x,y:n.Ay.event.data.y},void 0,(function(){(0,a.Qx)(r.A.t("use_item")+D[e].name)})),"poisonWine"==e&&n.Ay.setFlag("poison",!1),"weakWine"==e&&(n.Ay.setFlag("weak",!1),n.Ay.playerData.attack+=o.Z4.weakValue,n.Ay.playerData.defense+=o.Z4.weakValue),"curseWine"==e&&n.Ay.setFlag("curse",!1),"superWine"==e&&(n.Ay.setFlag("poison",!1),n.Ay.getFlag("weak",!1)&&(n.Ay.setFlag("weak",!1),n.Ay.playerData.attack+=o.Z4.weakValue,n.Ay.playerData.defense+=o.Z4.weakValue),n.Ay.setFlag("curse",!1)),l.A.syncPlayerStatus(),"book"!=e&&"fly"!=e&&n.Ay.route.push("item:"+e),"tools"==_&&n.Ay.playerData.items[_][e]--,(0,s.DQ)(t)&&t()}function m(e){return Object.keys(D).sort().indexOf(e)}function I(e){Object.keys(D).sort().forEach((function(t,_){if(_==e)return D[t]}))}function C(){var e;if(n.Ay.playerStop){var t=n.Ay.nextX(),_=n.Ay.nextY(),o=(0,a.gd)(t,_);(0,s.DQ)(o)||"getItem"==(null===(e=o.block.event)||void 0===e?void 0:e.trigger)&&((0,u.sZ)(o.block.event.id,1,t,_),n.Ay.route.push("getNext"))}}},462:(e,t,_)=>{_.d(t,{Ak:()=>f,Cg:()=>y,J5:()=>v,Kb:()=>A,LF:()=>m,UQ:()=>P,Vv:()=>d,Yv:()=>p,bw:()=>g,de:()=>O,nV:()=>M,xO:()=>E});var o=_(958),n=_(306),a=_(250),i=_(197),r=_(137),s=_(636),l=_(746),c=_(28),u={};function E(e,t){u[e].blocks.push(t)}function d(e){return u[e]}function D(){return Object.keys(u).map((function(e){return parseInt(e)}))}function p(){u={};for(var e=r.Ay.getAllFloorIds(),t=0;t<e.length;t++){var _=e[t];_ in u||(u[_]=(0,l.o8)((0,r.xE)(_)),console.log("load floorId: ",_,": ",u[_]))}}function y(e){for(var t=[],_=0;_<13;_++){t[_]=[];for(var o=0;o<13;o++)t[_].push(0)}return e.forEach((function(e){(0,l.DQ)(e.enable)||e.enable||!(0,l.DQ)(e.id)||(t[e.y][e.x]=e.id)})),t}function v(e,t){var _=u[e],E=_.blocks;console.log("draw map floorId: ",e),console.log("draw map blocks: ",e),i.Ay.floorId=e,i.Ay.mapData=_,(0,a.pZ)(),(0,n.Vc)();var d=r.Ay.getFloorById(e).defaultGround||"ground",D=o.P.terrains[d],p=s.zC.terrains;d.indexOf("ground")>=0&&(D=0,p=s.zC[d]);for(var y=0;y<13;y++)for(var v=0;v<13;v++)(0,a.Yc)("bg").drawImage(p,0,32*D,32,32,32*y,32*v,32,32);for(var O=0;O<E.length;O++){var P=E[O];if((0,l.DQ)(P.event)&&(!(0,l.DQ)(P.enable)||P.enable)){var M=P.event;if((0,l.DQ)(M.id)){var A=o.P[M.cls][M.id],g=s.zC[M.cls];(0,a.Yc)("event").drawImage(g,0,32*A,32,32,32*P.x,32*P.y,32,32),(0,n.kK)(M.animate,32*P.x,32*P.y,A,g)}}}(0,n.VD)(c.Z4.animateSpeed),(0,l.DQ)(t)&&t()}function O(e,t,_,o){var n=(0,a.Yf)();(0,l.DQ)(e)||(e=n.x),(0,l.DQ)(t)||(t=n.y),(0,l.DQ)(_)||(_=n.direction),(0,l.DQ)(o)||(o=i.Ay.floorId);var s=r.Ay.getFloorById(o);if((0,l.DQ)(s.blockCannotMoveDirections)){var c=s.blockCannotMoveDirections[e+","+t];if((0,l.DQ)(c)&&c instanceof Array&&c.indexOf(_)>=0)return!1}var u=(0,a.gd)(e,t,o);if((0,l.DQ)(u)){var E=u.block.event.id;if("arrow"==E.slice(0,5).toLowerCase())if(_!=E.slice(5).toLowerCase())return!1}var d={up:{x:0,y:-1},left:{x:-1,y:0},down:{x:0,y:1},right:{x:1,y:0}},D=(0,a.gd)(e+d[_].x,t+d[_].y,o);if((0,l.DQ)(D)){var p=D.block.event.id;if("arrow"==p.slice(0,5).toLowerCase()){var y=p.slice(5).toLowerCase();if(d[_].x+d[y].x==0&&d[_].y+d[y].y==0)return!1}}return!0}function P(e,t){if(i.Ay.hasFlag("poison"))return!1;var _=(0,a.Yf)().x,o=(0,a.Yf)().y;if(_==e&&o==t)return!1;if((0,l.DQ)((0,a.gd)(_,o))||i.Ay.blockingCtx.damage[13*_+o]>0)return!1;var n=[],r=[];n[13*_+o]=!0,r.push(13*_+o);for(var s=[[-1,0],[1,0],[0,1],[0,-1]];r.length>0;){var c=r.shift(),u=(0,l.RI)(c/13),E=c%13;for(var d in s){var D=u+s[d][0],p=E+s[d][1];if(!(D<0||D>=13||p<0||p>=13)&&!(n[13*D+p]||(0,l.DQ)((0,a.gd)(D,p))||i.Ay.blockingCtx.damage[13*D+p]>0)){if(D==e&&p==t)return!0;n[13*D+p]=!0,r.push(13*D+p)}}}return!1}function M(e,t,_,o){var n,i,r,s,c=(0,a.gd)(e,t,o);return!(!(0,l.DQ)(c)||"terrains"!=(null===(i=null===(n=null==c?void 0:c.block)||void 0===n?void 0:n.event)||void 0===i?void 0:i.cls))&&(!(0,l.DQ)(_)||(null===(s=null===(r=null==c?void 0:c.block)||void 0===r?void 0:r.event)||void 0===s?void 0:s.id)==_)}function A(e,t,_){var o,n,i,r=(0,a.gd)(e,t,_);return(0,l.DQ)(r)&&"terrains"==(null===(o=r.block.event)||void 0===o?void 0:o.cls)&&("upFloor"==(null===(n=r.block.event)||void 0===n?void 0:n.id)||"downFloor"==(null===(i=r.block.event)||void 0===i?void 0:i.id))}function g(){for(var e={},t=D(),_=0;_<t.length;_++){var o=t[_];e[o]=h(o)}return e}function h(e){return JSON.stringify(u[e])}function f(e){u={};for(var t=Object.keys(e).map((function(e){return parseInt(e)})),_=0;_<t.length;_++){var o=t[_],n=e[o],a=JSON.parse(n);u[o]=a}}function m(e,t){return JSON.parse(e[t])}},417:(e,t,_)=>{_.d(t,{A:()=>v});var o=_(883),n=_(876),a=_(795),i=_(306),r=_(197),s=_(250),l=_(28),c=_(654),u=_(636),E=_(462),d=_(571),D=_(224),p=_(505),y=_(137);const v=function(){function e(){if(e.instance)throw new Error("Menu is a singleton class")}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.reload=function(){console.log("Reload menu called..."),(0,l.cW)(),r.Ay.init(),(0,s.XQ)(),(0,y.ET)(),(0,u.Ht)(),(0,d.mn)(),(0,a.SP)(),(0,E.Yv)(),(0,D.DB)(),(0,i.dZ)(),(0,p.k7)(),(0,s.Pe)()},e.prototype.show=function(){console.log("Show menu called..."),this.reload(),(0,n.C)("menuBox"),(0,n.lW)("menuBox"),(0,n.C)("loadingMenu"),(0,n.lW)("loadingMenu"),(0,n.Vx)("menuButtonsBox"),(0,n.C)("menuButtons"),(0,n.Vx)("levelButtons"),(0,n.WF)("curtain","#000000"),(0,n.Ko)("curtain",0),this.clearStatus(),(0,s.pZ)(),this.showMenuAfterLoading(),this.registerButtonsClick()},e.prototype.clearStatus=function(){(0,s.UD)(),c.A.resize()},e.prototype.showMenuAfterLoading=function(){(0,i.qr)("loadingMenu",30,(function(){(0,n.Vx)("loadingTips"),(0,n.C)("menuButtonsBox"),(0,n.AL)("menuGameTitle",o.A.t("title"))}))},e.prototype.hideMenu=function(){(0,i.qr)("menuBox",15)},e.prototype.registerButtonsClick=function(){console.log("Register buttons click..."),(0,n.J6)("startGame").onclick=a.x3,(0,n.J6)("loadGame").onclick=function(){return(0,a.zz)()},(0,n.J6)("easyLevel").onclick=function(){return(0,a.xq)("easy")},(0,n.J6)("normalLevel").onclick=function(){return(0,a.xq)("normal")},(0,n.J6)("hardLevel").onclick=function(){return(0,a.xq)("hard")}},e}().getInstance()},505:(e,t,_)=>{_.d(t,{Dx:()=>l,HE:()=>r,Nx:()=>i,TW:()=>a,i3:()=>s,k7:()=>p,uP:()=>n});var o=_(746),n={};function a(){return Object.keys(n)}function i(e){return n[e]}function r(e,t){n[e]=t}function s(e){return Object.keys(n).sort().indexOf(e)}function l(e){Object.keys(n).sort().forEach((function(t,_){if(_===e)return n[t]}))}var c={id:"moneyShop1",name:"man加油站",icon:"blueShop",textInFastList:"3Fman加油站",use:"money",need:"20+1*times",text:"勇敢的man啊，给我${need}金币就可以：",choices:[{text:"生命+800",effect:"status:hp+=800"},{text:"攻击+4",effect:"status:attack+=4"},{text:"防御+4",effect:"status:defense+=4"}],times:0},u={id:"expShop1",name:"经验老毕登",icon:"man",textInFastList:"5F经验老毕登",use:"experience",need:"-1",text:"勇敢的man啊，给我若干经验就可以：",choices:[{text:"等级+1",need:"100",effect:"status:level+=1;status:hp+=1000;status:attack+=8;status:defense+=8"},{text:"攻击+6",need:"33",effect:"status:attack+=6"},{text:"防御+6",need:"33",effect:"status:defense+=6"}],times:0},E={id:"keyShop",name:"钥匙老毕登",icon:"woman",textInFastList:"5F钥匙老毕登",use:"money",need:"-1",text:"勇敢的man啊，给我若干金币就可以：",choices:[{text:"黄钥匙",need:"10",effect:"item:yellowKey+=1"},{text:"蓝钥匙",need:"50",effect:"item:blueKey+=1"},{text:"红钥匙",need:"100",effect:"item:redKey+=1"},{text:"绿钥匙",need:"150",effect:"item:greenKey+=1"}],times:0},d={id:"moneyShop2",name:"man超强加油站",icon:"blueShop",textInFastList:"11Fman超强加油站",use:"money",need:"85+1*times",text:"勇敢的man啊，给我${need}金币就可以：",choices:[{text:"生命+4000",effect:"status:hp+=4000"},{text:"攻击+20",effect:"status:attack+=20"},{text:"防御+20",effect:"status:defense+=20"}],times:0},D={id:"expShop2",name:"经验超大老毕登",icon:"man",textInFastList:"13F经验超大老毕登",use:"experience",need:"-1",text:"勇敢的man啊，给我若干经验就可以：",choices:[{text:"等级+3",need:"275",effect:"status:level+=3;status:hp+=3000;status:attack+=22;status:defense+=22"},{text:"攻击+18",need:"95",effect:"status:attack+=17"},{text:"防御+18",need:"95",effect:"status:defense+=17"}],times:0};function p(){[c,u,E,d,D].forEach((function(e){n[e.id]=(0,o.o8)(e)}))}},916:(e,t,_)=>{_.d(t,{A:()=>r});var o=_(28);const n=_.p+"sounds/switch_floor.mp3";var a=function(e,t,_,o){return new(_||(_=Promise))((function(n,a){function i(e){try{s(o.next(e))}catch(e){a(e)}}function r(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof _?t:new _((function(e){e(t)}))).then(i,r)}s((o=o.apply(e,t||[])).next())}))},i=function(e,t){var _,o,n,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=r(0),i.throw=r(1),i.return=r(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function r(r){return function(s){return function(r){if(_)throw new TypeError("Generator is already executing.");for(;i&&(i=0,r[0]&&(a=0)),a;)try{if(_=1,o&&(n=2&r[0]?o.return:r[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(n=a.trys,(n=n.length>0&&n[n.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){a.label=r[1];break}if(6===r[0]&&a.label<n[1]){a.label=n[1],n=r;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(r);break}n[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],o=0}finally{_=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}};const r=function(){function e(){if(e.instance)throw new Error("Error: Instantiation failed: Use Sound.getInstance() instead of new.");this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.resources={sounds:{}}}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.isset=function(e){return null!=e},e.prototype.loadSound=function(e){return a(this,void 0,void 0,(function(){var t,_,o,n;return i(this,(function(a){switch(a.label){case 0:if(this.isset(this.resources.sounds[e]))return[2];console.log("Try to load sound: ".concat(e)),a.label=1;case 1:return a.trys.push([1,8,,9]),this.audioContext?[4,fetch(e)]:[3,5];case 2:return[4,a.sent().arrayBuffer()];case 3:return t=a.sent(),[4,this.audioContext.decodeAudioData(t)];case 4:return _=a.sent(),this.resources.sounds[e]=_,[3,7];case 5:return o=new Audio(e),[4,new Promise((function(e,t){o.addEventListener("canplaythrough",e),o.addEventListener("error",t)}))];case 6:a.sent(),this.resources.sounds[e]=o,a.label=7;case 7:return[3,9];case 8:return n=a.sent(),console.error("Failed to load sound path: ".concat(e),n),[3,9];case 9:return[2]}}))}))},e.prototype.playSwitchFloor=function(){this.play(n)},e.prototype.play=function(e){var t=this;if(o.Z4.soundEnabled){var _="".concat("./sounds/").concat(e);this.loadSound(_).then((function(){t.playSoundImpl(_)}))}},e.prototype.playSoundImpl=function(e){if(this.isset(this.resources.sounds[e]))try{if(null!=this.audioContext){var t=this.audioContext.createBufferSource();t.buffer=this.resources.sounds[e],t.connect(this.audioContext.destination);try{t.start(0),console.log("Playing sound resource for ".concat(e))}catch(e){try{t.noteOn(0)}catch(e){console.error("Error starting audio source",e)}}}else this.resources.sounds[e].play()}catch(t){console.error("cannot play sound resource for ".concat(e),t)}else console.warn("Cannot play sound resource for ".concat(e," because it is not loaded"))},e}().getInstance()},578:(e,t,_)=>{_.d(t,{A:()=>s});var o=_(795),n=_(28),a=_(197),i=_(876),r=_(883);const s=function(){function e(){if(e.instance)return e.instance;e.instance=this}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.show=function(){(0,i.C)("statusBar"),this.syncPlayerStatus()},e.prototype.syncPlayerStatus=function(){console.log("syncPlayerStatus ".concat((0,n.oX)(a.Ay.playerData))),(0,i.AL)("levelStatusText","".concat(r.A.t("level")," ").concat(a.Ay.playerData.level)),(0,i.AL)("hpStatusText","".concat(a.Ay.playerData.hp)),(0,i.AL)("attackStatusText","".concat(a.Ay.playerData.attack)),(0,i.AL)("defenseStatusText","".concat(a.Ay.playerData.defense)),(0,i.AL)("moneyStatusText","".concat(a.Ay.playerData.money)),(0,i.AL)("expStatusText","".concat(a.Ay.playerData.exp)),(0,i.AL)("yellowKey","".concat(a.Ay.playerData.items.keys.yellowKey)),(0,i.AL)("blueKey","".concat(a.Ay.playerData.items.keys.blueKey)),(0,i.AL)("redKey","".concat(a.Ay.playerData.items.keys.redKey)),(0,i.AL)("greenKey","".concat(a.Ay.playerData.items.keys.greenKey)),(0,o.H8)()},e}().getInstance()},202:(e,t,_)=>{_.d(t,{A:()=>n});var o=_(876);const n=function(){function e(){if(e.instance)return e.instance;e.instance=this}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.show=function(){(0,o.C)("toolBar")},e}().getInstance()},746:(e,t,_)=>{_.d(t,{$1:()=>u,DQ:()=>n,Lg:()=>c,RI:()=>a,Yq:()=>E,ZB:()=>l,iq:()=>s,o8:()=>i,qP:()=>r});var o=_(28);function n(e){return null!=e}function a(e){return"number"==typeof e?Math.floor(e):"string"==typeof e?parseInt(e,10):0}function i(e){return null===e||"object"!=typeof e?e:JSON.parse(JSON.stringify(e))}function r(e,t){if(e instanceof Array&&n(t))return t instanceof Array?i(t).reverse().forEach((function(t){e.unshift(t)})):e.unshift(t),e}function s(e){var t=function(e){return Math.max(0,Math.min(255,e))},_=t(e[0]||0),o=t(e[1]||0),n=t(e[2]||0);return"#".concat(((1<<24)+(_<<16)+(o<<8)+n).toString(16).slice(1))}function l(e,t){try{localStorage.setItem(o.Z4.version+"_"+e,JSON.stringify(t))}catch(e){return console.log(e),!1}return!0}function c(e,t){void 0===t&&(t=void 0);var _=localStorage.getItem(o.Z4.version+"_"+e);return n(_)?JSON.parse(_):t}function u(e){localStorage.removeItem(o.Z4.version+"_"+e)}function E(e){if(!n(e))return"";var t=e.getFullYear(),_=(e.getMonth()+1).toString().padStart(2,"0"),o=e.getDate().toString().padStart(2,"0"),a=e.getHours().toString().padStart(2,"0"),i=e.getMinutes().toString().padStart(2,"0"),r=e.getSeconds().toString().padStart(2,"0");return"".concat(t,"-").concat(_,"-").concat(o," ").concat(a,":").concat(i,":").concat(r)}},654:(e,t,_)=>{_.d(t,{A:()=>l,Q:()=>o});var o,n=_(202),a=_(921),i=_(876),r=_(578);!function(e){e[e.PC=0]="PC",e[e.MOBILE_VERTICAL=1]="MOBILE_VERTICAL",e[e.MOBILE_HORIZONTAL=2]="MOBILE_HORIZONTAL"}(o||(o={}));var s=function(){function e(){if(this.isHorizontal=!1,this.screenMode=o.PC,this.scale=1,e.instance)throw new Error("GameWindow is a singleton class")}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.getScale=function(){return this.scale},e.prototype.getScreenMode=function(){return this.screenMode},e.prototype.getIsHorizontal=function(){return this.isHorizontal},e.prototype.getClientWidth=function(){return document.body.clientWidth},e.prototype.getClientHeight=function(){return document.body.clientHeight},e.prototype.resize=function(e,t){void 0===e&&(e=this.getClientWidth()),void 0===t&&(t=this.getClientHeight()),e>t&&t<a.A3&&(this.isHorizontal=!0,e=t);var _=9.6,n=a.o$,i=a.gI;i=8*a.gI/_;var r=1-(a.A3-e)/4.22/100,s=0,l=0,c=0,u=0,E=0,d=0,D=0,p=0,y=0,v="100%",O="auto 100%",P=0,M=0,A=0,g=0,h=0,f=0,m=0;if(e<a.F3){e<a.A3?(this.scale=r,s=e):(this.scale=1,s=a.AN);var I=a.AN*this.scale;if(this.isHorizontal)this.screenMode=o.MOBILE_HORIZONTAL,c=I,u=I+a.XS*this.scale,l=0,M=d=this.scale*a.XS,E=this.scale*n*_+2*a.t6,p=D=this.scale*n,y=this.scale*a.XS,P=s-E,A=this.scale*n*_+2*a.t6,g=this.scale*a.o$*.9,h=y,f=i*this.scale,m=this.scale*a.t6*2;else{this.screenMode=o.MOBILE_VERTICAL;var C=8.6/3+1,R=this.scale*(a.o$*C+2*a.t6)+6,T=this.scale*(a.o$+4*a.t6)+6;c=I+R+T,u=I,l=R,E=R,p=D=this.scale*a.o$*1.2,this.scale*a.XS,M=d=s,P=T,A=E+s,g=this.scale*a.o$*1.2,h=this.scale*a.XS*.5,v="32.5%",O="auto 135%",f=this.scale*i,y=h,m=this.scale*a.t6*2}}else this.scale=1,this.screenMode=o.PC,c=a.AN,u=a.F3,s=a.AN,l=0,M=d=a.XS,E=n*_+2*a.t6,p=D=.98*n,y=a.XS,P=a.AN-E,A=E,g=1.1*a.o$,h=.9*a.XS,f=i,m=2*a.t6;var L=[{id_selector:"screenBox",rule:{height:c+a.p5,width:u+a.p5,top:(t-c)/2+a.p5,left:(e-u)/2+a.p5}},{class_selector:"gameCanvas",rule:{height:s+a.p5,width:s+a.p5,top:l+a.p5,right:0,border:a.BY}},{id_selector:"floorSwitchTipBox",rule:{height:c-2*a.t6+a.p5,width:s-2*a.t6+a.p5,top:a.t6+a.p5,right:a.t6+a.p5}},{id_selector:"statusBar",rule:{height:E+a.p5,width:d+a.p5,"background-size":O,top:0,left:0,borderTop:a.u7,borderLeft:a.u7,borderRight:a.u7,fontSize:f+a.p5,padding:a.t6+a.p5}},{class_selector:"statusBarItem",rule:{height:D+a.p5,width:v,maxWidth:y,margin:m/6+a.p5}},{class_selector:"statusText",rule:{lineHeight:p+a.p5,marginLeft:m/4+a.p5}},{id_selector:"toolBar",rule:{height:P+a.p5,width:M+a.p5,top:A+a.p5,left:0,borderTop:a.u7,borderLeft:a.u7,borderRight:a.u7,fontSize:f+a.p5,padding:a.t6+a.p5}},{class_selector:"toolBarItem",rule:{height:g+a.p5,maxWidth:h,marginLeft:m/2+a.p5,marginRight:m/2+a.p5}},{class_selector:"toolButtonText",rule:{lineHeight:g+a.p5,marginLeft:m+a.p5}},{id_selector:"curtain",rule:{height:s-2*a.t6+a.p5,width:s-2*a.t6+a.p5,top:l+a.t6+a.p5,right:a.t6+a.p5}}];this.render(L)},e.prototype.render=function(e){n.A.show(),r.A.show();for(var t=function(e,t){for(var _=0,o=Object.entries(t);_<o.length;_++){var n=o[_],a=n[0],i=n[1];e.style[a]=i}},_=0,o=e;_<o.length;_++){var a=o[_],s=a.rule;if(a.class_selector)for(var l=(0,i.Fe)(a.class_selector),c=0;c<l.length;c++)t(l[c],s);a.id_selector&&t((0,i.J6)(a.id_selector),s)}},e}().getInstance();window.onresize=function(){try{s.resize()}catch(e){console.error(e)}};const l=s}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var _=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](_,_.exports,__webpack_require__),_.exports}__webpack_require__.d=(e,t)=>{for(var _ in t)__webpack_require__.o(t,_)&&!__webpack_require__.o(e,_)&&Object.defineProperty(e,_,{enumerable:!0,get:t[_]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.p="/";var __webpack_exports__={},_i18n__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(883),_menu__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(417),_window__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(654),_intereact__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(475),_events__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(795),_dom__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(876),Driver=function(){function e(){}return e.run=function(){console.log("Initializing Main object..."),e.showi18n(),_menu__WEBPACK_IMPORTED_MODULE_1__.A.show(),_window__WEBPACK_IMPORTED_MODULE_2__.A.resize()},e.showi18n=function(){document.querySelectorAll("[data-i18n]").forEach((function(e){var t=e.getAttribute("data-i18n");t&&(e.textContent=_i18n__WEBPACK_IMPORTED_MODULE_0__.A.t(t))}))},e.flag=!1,e}();Driver.run(),document.body.onkeydown=_intereact__WEBPACK_IMPORTED_MODULE_3__.cV,document.body.onkeyup=_intereact__WEBPACK_IMPORTED_MODULE_3__.P6,(0,_dom__WEBPACK_IMPORTED_MODULE_5__.J6)("data").onmousedown=_intereact__WEBPACK_IMPORTED_MODULE_3__.qg,(0,_dom__WEBPACK_IMPORTED_MODULE_5__.J6)("data").onmouseup=_intereact__WEBPACK_IMPORTED_MODULE_3__.bc,(0,_dom__WEBPACK_IMPORTED_MODULE_5__.J6)("data").onmousemove=_intereact__WEBPACK_IMPORTED_MODULE_3__.ib,(0,_dom__WEBPACK_IMPORTED_MODULE_5__.J6)("data").ontouchstart=_intereact__WEBPACK_IMPORTED_MODULE_3__.k9,(0,_dom__WEBPACK_IMPORTED_MODULE_5__.J6)("data").ontouchend=_intereact__WEBPACK_IMPORTED_MODULE_3__.nE,(0,_dom__WEBPACK_IMPORTED_MODULE_5__.J6)("data").ontouchmove=_intereact__WEBPACK_IMPORTED_MODULE_3__.Wx,(0,_dom__WEBPACK_IMPORTED_MODULE_5__.J6)("encyclopediaToolImg").onclick=_intereact__WEBPACK_IMPORTED_MODULE_3__.J_,(0,_dom__WEBPACK_IMPORTED_MODULE_5__.J6)("transporterToolImg").onclick=_events__WEBPACK_IMPORTED_MODULE_4__.qY,(0,_dom__WEBPACK_IMPORTED_MODULE_5__.J6)("noteBookToolImg").onclick=_intereact__WEBPACK_IMPORTED_MODULE_3__.DB,(0,_dom__WEBPACK_IMPORTED_MODULE_5__.J6)("toolBoxToolImg").onclick=_intereact__WEBPACK_IMPORTED_MODULE_3__.Pf,(0,_dom__WEBPACK_IMPORTED_MODULE_5__.J6)("saveToolImg").onclick=_events__WEBPACK_IMPORTED_MODULE_4__.Yx,(0,_dom__WEBPACK_IMPORTED_MODULE_5__.J6)("loadToolImg").onclick=_events__WEBPACK_IMPORTED_MODULE_4__.T,(0,_dom__WEBPACK_IMPORTED_MODULE_5__.J6)("settingToolImg").onclick=_intereact__WEBPACK_IMPORTED_MODULE_3__.zf})();